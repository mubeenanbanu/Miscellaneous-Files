(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1053:function(u,D,b){function a(Y){var qa=this;Y=void 0===Y?null:Y;this.BS=0;this.XO=null;this.Gug=0;var fa=X.a.oe();this.bqg=this.deh(Y).then(function(ha){return ha?qa.P8h():(v.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",qa.Nu(),Math.floor(X.a.oe()-fa)),ha=ca.a.Fr(),void 0!==ha&&null!==ha&&(ha.set("AuthLibrary",qa.Nu()),ha=Object.assign(new ea.a,
{durationMs:Math.floor(X.a.oe()-fa),extendedProperties:ha}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",!1,!0,ha)),Promise.resolve(1))}).then(function(ha){return 0!==ha?Promise.resolve(ha):qa.vsi()})}function c(Y){this.ZOc=Y;this.oXa="UnsupportedAuthTokenStrategy Reason="+B.a[this.ZOc]}function d(){this.zs=null;this.KSb=0;this.Cjb=this.DXa=this.OEc=this.ADa=this.KL=this.Dhe=null;this.xv=new H.a(null,null);this.qXb=C.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",
!1);this.oXa="SharedAuthTokenStrategy "+(this.qXb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.ZX=G.a.Wuj;this.Efe=G.a.Vuj;this.W4d=G.a.enableConsoleLogging;this.Dng=C.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.qwg=C.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.qXb);this.Nqa={};this.mqg=new l(1500)}function e(Y,qa,fa,ha,ia,wa,Qa){var S=
N.call(this,!1,!1,!0)||this;S.l1=null;S.k4d=null;S.ZX=Y;S.Xtg=fa;S.xv=ha;S.Rxg=ia;S.ADa=wa;S.zs=document.createElement("iframe");S.zs.id="SharedAuthInteractiveFrame";S.zs.setAttribute("name","SharedAuthInteractiveFrame");S.zs.setAttribute("title","SharedAuthInteractiveFrame");S.zs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");S.zs.style.border="0";S.zs.style.height="48px";S.zs.style.width="190px";$addHandler(S.zs,"error",Object(U.a)(S,S.PRi,"onSharedAuthFrameError"));
Y=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",S.ZX,qa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",C.AFrameworkApplication.userType);Qa&&(Y+="&vnext=1");S.zs.src=Y;S.jng=new Promise(function(da){S.k4d=da});S.l4d=!1;return S}function k(){this.correlationId=this.resolve=null}function l(Y){Y=void 0===Y?0:Y;this.NB=0;this.skb=!1;this.tm=new T.a;this._timeout=Y}function m(){this.reject=this.resolve=null;this.startTime=0;this.$If=this.Dse=null}function f(){this.Eie=
null;var Y=C.AFrameworkApplication.fa.Wa(C.AFrameworkApplication.kea),qa=C.AFrameworkApplication.fa.Wa(C.AFrameworkApplication.sag);this.oXa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",Y&&""!==Y?Y:"Unspecified",qa&&""!==qa?qa:"Unspecified")}function w(Y,qa,fa,ha,ia){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=Y;this.scope=qa;this.silentLogin=fa;this.options=ha;this.correlationId=ia}function n(){}function z(Y){this.tsg=
Y}function r(){}b.r(D);u=b(0);var v=b(15),A=b(903),B=b(1130),y;(function(Y){Y[Y.external=0]="external";Y[Y.msa=1]="msa";Y[Y.aad=2]="aad"})(y||(y={}));Object(u.b)("AuthorityType",y);Object(u.a)(r,"OAuthResult",null,[]);z.prototype.initialize=function(){return Promise.resolve(0)};z.prototype.Djc=function(){return Promise.resolve(0)};z.prototype.EO=function(){v.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new r,{IsSuccess:!0,Token:this.tsg}))};
z.prototype.yAc=function(){return Promise.resolve(Object.assign(new r,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};z.prototype.Xyc=function(){return!1};z.prototype.Rvb=function(){return"MockAuthTokenStrategy"};Object(u.a)(z,"MockAuthTokenStrategy",null,[724]);var x=b(1156);n.get=function(Y,qa,fa){if(!fa)return Y;var ha=0;return Promise.race([Y,new Promise(function(ia){ha=window.setTimeout(function(){ia(qa)},
fa)})]).then(function(ia){window.clearTimeout(ha);return Promise.resolve(ia)}).catch(function(){window.clearTimeout(ha);return Promise.resolve(qa)})};Object(u.a)(n,"PromiseWithTimeout",null,[]);var C=b(4),G=b(942);Object(u.a)(w,"TokenRequestParameters",null,[798]);var E=b(25),I=b(84);f.prototype.initialize=function(){var Y=this;return new Promise(function(qa){I.a.instance.Tb("Common.App.WopiIdentity.IWopiIdentity").execute(function(fa){Y.Eie=fa;qa(0)})})};f.prototype.mi=function(Y){for(var qa=!1,
fa=Y.toLocaleUpperCase(),ha=ak(["HTTPS:","API:"]),ia=ha.next();!ia.done;ia=ha.next())if(fa.startsWith(ia.value)){qa=!0;break}return qa||this.kii(Y)?Y+"/.default":Y};f.prototype.kii=function(Y){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(Y)};f.prototype.Djc=function(){return Promise.resolve(0)};f.prototype.EO=function(Y,qa,fa,ha,ia,wa,Qa){if(E.a.Zwa){ia=G.a.BWj;if(!ia)return qa=Object.assign(new r,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",
ErrorMessage:"No app list was found."}),Promise.resolve(qa);if(!Array.contains(ia,Y))return qa=Object.assign(new r,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+Y}),Promise.resolve(qa)}Y=this.mi(fa);fa=new w(fa,Y,!ha,null,C.AFrameworkApplication.userSessionId);return this.Eie.getAccessToken(fa,qa,Qa).then(function(S){return Object.assign(new r,{IsSuccess:!0,Token:S.accessToken})},function(S){return Object.assign(new r,{IsSuccess:!1,ErrorCode:S})})};f.prototype.yAc=
function(){return Promise.resolve(Object.assign(new r,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};f.prototype.Xyc=function(){return!1};f.prototype.Rvb=function(){return this.oXa};Object(u.a)(f,"ParentFrameTokenStrategy",null,[724]);var U=b(83),M=b(1062),T=b(202);Object(u.a)(m,"PromiseWrapper",null,[]);l.prototype.enqueue=function(Y){var qa=this;return new Promise(function(fa,ha){qa.tm.add(Object.assign(new m,
{$If:Y,resolve:fa,reject:ha}));qa.process()})};l.prototype.process=function(){var Y=this;if(this.skb||this.NB===this.tm.count)return!1;var qa=this.tm.na(this.NB++);try{this.skb=!0,qa.$If().then(function(fa){Y.skb=!1;Y.s1c(qa,fa,null,!0)}).catch(function(fa){Y.skb=!1;Y.s1c(qa,null,fa,!1)})}catch(fa){this.skb=!1,this.s1c(qa,null,fa,!1)}return!0};l.prototype.s1c=function(Y,qa,fa,ha){var ia=this;ha?0<this._timeout?window.setTimeout(function(){Y.resolve(qa);ia.process()},this._timeout):(Y.resolve(qa),
ia.process()):0<this._timeout?window.setTimeout(function(){Y.reject(fa);ia.process()},this._timeout):(Y.reject(fa),ia.process())};Object(u.a)(l,"PromiseQueue",null,[]);Object(u.a)(k,"ResolveWithCorrelation",null,[]);var F=b(85),K=b(150),J=b(1030),O=b(170),N=K.a;Rk(e,N);e.prototype.lxc=function(){var Y={};Y=(Y.promptMessage=this.Xtg,Y.errorText=CommonUIStrings.l_InternalError,Y.rtl=C.AFrameworkApplication.isRtl,Y.frameLoaded=!1,Y.createFrame=Object(U.a)(this,this.s6g,"createFrame"),Y.resolveDialogStyles=
this.k4d,Y);var qa={};this.l1=(qa.id="SharedAuthConsentDialog",qa.bodyControls=Y,qa);this.Rb=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(U.a)(this,this.Uuj,"sharedAuthConsentDialogHandler"),this.l1)};e.prototype.KBc=function(Y,qa,fa){Y=void 0===Y?!1:Y;qa=void 0===qa?!1:qa;fa=void 0===fa?5:fa;this.l1&&this.l1.bodyControls&&(Y!==Object(F.a)(Object,this.l1.bodyControls).frameLoaded&&(Object(F.a)(Object,this.l1.bodyControls).frameLoaded=Y),qa!==Object(F.a)(Object,this.l1.bodyControls).frameLoadSuccess&&
(Object(F.a)(Object,this.l1.bodyControls).frameLoadSuccess=qa),fa!==this.l1.dialogButtonsOption&&(this.l1.dialogButtonsOption=null,this.Rb=fa),this.update(this.l1))};e.prototype.gBj=function(Y,qa){var fa=new J.a(O.a.Yuj),ha={};Y=(ha.signInLabel=CommonUIStrings.l_SignIn,ha.cancelLabel=CommonUIStrings.l_DialogCancel,ha.rtl=C.AFrameworkApplication.isRtl,ha.messageCorrelationId=Y,ha.dialogStyles=qa,ha);fa.Values=Y;this.xv.WQa(fa,this.zs.contentWindow,this.ZX)};e.prototype.VTe=function(){this.KBc(!0,!1,
6)};e.prototype.PRi=function(){this.VTe()};e.prototype.s6g=function(){return this.zs};e.prototype.Uuj=function(Y){0===Y&&(this.Rxg.reject(Object.assign(new r,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.ADa(null))};Af.Object.defineProperties(e.prototype,{o0f:{configurable:!0,enumerable:!0,get:function(){return this.zs}},Reh:{configurable:!0,enumerable:!0,get:function(){var Y=this;return this.jng.then(function(qa){Y.l4d=!0;return qa})}},Seh:{configurable:!0,
enumerable:!0,get:function(){return this.l4d}}});Object(u.a)(e,"SharedAuthConsentDialog",K.a,[799]);var H=b(1444),Q=b(99),ca=b(136),X=b(39),Z=b(178),ea=b(190);d.prototype.Rvb=function(){return this.oXa};d.prototype.initialize=function(){var Y=b(1053).OAuthManager;if("loadFrame"in this.Nqa)return this.Nqa.loadFrame.Dse;if(!this.ZX)return Q.Health.instance.recordKpiFailure(Y.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),v.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),
Promise.reject(1);Y=this.Dyc("loadFrame");this.KSb=X.a.oe();var qa=this.ZX+this.Efe+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+C.AFrameworkApplication.userSessionId+"&WacUserType="+C.AFrameworkApplication.userType;this.qXb&&(qa+="&vnext=1");this.zs=document.createElement("iframe");this.x$h(this.zs);this.zs.style.cssText="height:0;width:0;display:none;";this.zs.id="SharedAuthFrame";this.zs.setAttribute("name","SharedAuthFrame");this.zs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.zs.setAttribute("title","SharedAuthFrame");this.zs.src=qa;document.body.appendChild(this.zs);qa=X.a.oe()-this.KSb;v.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",qa,this.zs.src);return Y};d.prototype.Djc=function(Y){this.OEc=Y;var qa=new J.a(O.a.r0f);qa.Values=this.ese(Y);Y=this.Dyc("initFrame");this.xv.WQa(qa,this.zs.contentWindow,this.ZX);v.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");
return Y};d.prototype.EO=function(Y,qa,fa,ha,ia,wa){var Qa=this,S=new J.a(O.a.Zuj),da=this.R0e();S.Values=this.N$f(Y,qa,fa,ha,ia,wa,da);Y=this.Dyc(da);ha&&C.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.mqg.enqueue(function(){return new Promise(function(xa){Qa.fNj(wa,S,xa,da)})}):(this.xv.WQa(S,this.zs.contentWindow,this.ZX),v.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",
qa));return Y};d.prototype.fNj=function(Y,qa,fa,ha){var ia=this.Nqa[ha];ia&&(this.DXa=qa,this.ADa=Object.assign(new k,{resolve:fa,correlationId:ha}),this.KL=new e(this.ZX,this.Efe,Y,this.xv,ia,fa,this.qXb),this.KL.lxc())};d.prototype.R0e=function(){return Z.a.create().toString()};d.prototype.N$f=function(Y,qa,fa,ha,ia,wa,Qa){var S={};S.appName=Y;S.appId=qa;S.target=fa;S.withPopup=ha;S.claims=ia;S.promptMessage=wa;S.messageCorrelationId=Qa;return S};d.prototype.x$h=function(Y){$addHandler(Y,"load",
Object(U.a)(this,this.TMi,"onIFrameLoaded"));$addHandler(Y,"error",Object(U.a)(this,this.dnc,"onIFrameError"));this.xv.sFa(this.ZX);this.xv.Wn(O.a.u0f);this.xv.Ml(O.a.u0f,Object(U.a)(this,this.iRi,"onScriptLoaded"));this.xv.Wn(O.a.t0f);this.xv.Ml(O.a.t0f,Object(U.a)(this,this.hRi,"onScriptInitialized"));this.xv.Wn(O.a.p0f);this.xv.Ml(O.a.p0f,Object(U.a)(this,this.sMi,"onGetTokenResponse"));this.xv.Wn(O.a.v0f);this.xv.Ml(O.a.v0f,Object(U.a)(this,this.jOi,"onLoginResponse"));this.xv.Wn(O.a.s0f);this.xv.Ml(O.a.s0f,
Object(U.a)(this,this.nNi,"onInteractiveFlowReady"));this.xv.Wn(O.a.q0f);this.xv.Ml(O.a.q0f,Object(U.a)(this,this.KMi,"onHideDialog"));this.xv.Wn(O.a.n0f);this.xv.Ml(O.a.n0f,Object(U.a)(this,this.LHi,"onCloseDialog"))};d.prototype.Dyc=function(Y){var qa=new m;qa.startTime=X.a.oe();var fa=new Promise(function(ha,ia){qa.resolve=ha;qa.reject=ia});qa.Dse=fa;this.Nqa[Y]=qa;return fa};d.prototype.TMi=function(){var Y=X.a.oe()-this.KSb;v.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",
Y)};d.prototype.dnc=function(Y){var qa=b(1053).OAuthManager,fa=X.a.oe()-this.KSb,ha=Object.assign(new ea.a,{durationMs:fa});Q.Health.instance.recordKpiFailure(qa.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,ha);v.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",fa,this.W4d?JSON.stringify(Y):"")};d.prototype.iRi=function(Y){var qa=b(1053).OAuthManager,fa=this.Nqa.loadFrame,ha=X.a.oe()-fa.startTime,ia=Y.Values.AuthLibrary.toString();Y=Y.Values.Success.toString();
v.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",Y,ia,ha);ia&&(this.oXa="SharedAuthTokenStrategy "+ia);ia=Boolean.parse(Y);ia||(Y=ca.a.Fr(),void 0!==Y&&null!==Y&&(Y.set("AuthLibrary",this.Rvb()),ha=Object.assign(new ea.a,{durationMs:ha,extendedProperties:Y}),Q.Health.instance.recordKpiFailure(qa.kpiName,"SharedAuthStrategyInitFailed",!1,!0,ha)));fa.resolve(ia?0:1)};d.prototype.hRi=function(Y){var qa=this;if(Y.Values.interactive&&
this.DXa&&this.DXa.Values.messageCorrelationId){var fa=this.DXa.Values.messageCorrelationId.toString();if(Y.Values.interactive&&this.KL){this.KL.Reh.then(function(ia){qa.xv.WQa(qa.DXa,qa.KL.o0f.contentWindow,qa.ZX);qa.KL.gBj(fa,ia);qa.KL.KBc(!0,!0);qa.DXa=null});return}}Y=this.Nqa.initFrame;var ha=X.a.oe()-Y.startTime;v.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ha);Y.resolve(0)};d.prototype.sMi=function(Y){if(Y.Values.messageCorrelationId&&Y.Values.messageCorrelationId.toString()){var qa=
Y.Values.messageCorrelationId.toString(),fa=this.Nqa[qa];if(fa){var ha=X.a.oe()-fa.startTime;v.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",ha);Y.Values.isSuccess&&Y.Values.isSuccess?fa.resolve(Y.Values.response):fa.reject(Y.Values.response);this.bag(qa)}else v.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else v.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};
d.prototype.nNi=function(){if(this.KL.Seh)this.KL.VTe();else if(this.OEc&&this.KL){var Y=new J.a(O.a.r0f);Y.Values=this.ese(this.OEc,!0);this.xv.WQa(Y,this.KL.o0f.contentWindow,this.ZX)}};d.prototype.KMi=function(){this.KL&&this.KL.axb()};d.prototype.LHi=function(Y){Y.Values.cancelled&&Y.Values.cancelled&&Y.Values.messageCorrelationId&&this.bag(Y.Values.messageCorrelationId.toString());this.KL&&this.KL.hide()};d.prototype.ese=function(Y,qa){qa=void 0===qa?!1:qa;var fa={};fa.appIds=this.WHh();fa.upn=
Y.loginHint;fa.authority=Y.authority;fa.authorityType=Object(A.a)(y,Y.authorityType);fa.tenantId=Y.tenantId;fa.correlationId=C.AFrameworkApplication.userSessionId;fa.enableConsoleLogging=this.W4d;fa.enablePopupFlash=this.Dng;fa.skipUpnCheck=this.qwg;fa.interactive=qa;return fa};d.prototype.WHh=function(){var Y=[],qa=G.a.TVc,fa;for(fa in qa)Array.add(Y,qa[fa]);return Y};d.prototype.yAc=function(Y,qa,fa,ha,ia,wa){var Qa=new J.a(O.a.Xuj),S=this.R0e();Qa.Values=this.N$f(Y,qa,fa,ha,ia,wa,S);this.Dhe=Qa;
Y=this.Dyc(S);v.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",qa);this.Qyj();return Y};d.prototype.Xyc=function(){return!0};d.prototype.Qyj=function(){var Y=this;this.Cjb||(this.Cjb=new M.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Cjb.id=16,this.Cjb.ief=!1,this.Cjb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){v.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");
Y.xv.WQa(Y.Dhe,Y.zs.contentWindow,Y.ZX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),v.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};d.prototype.jOi=function(Y){if(Y.Values.messageCorrelationId&&Y.Values.messageCorrelationId.toString()){var qa=this.Nqa[Y.Values.messageCorrelationId.toString()];if(qa){var fa=X.a.oe()-qa.startTime;v.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",
fa);Y.Values.isSuccess&&Y.Values.isSuccess?qa.resolve(Y.Values.response):qa.reject(Y.Values.response)}else v.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else v.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};d.prototype.bag=function(Y){this.ADa&&this.ADa.correlationId===Y&&(this.ADa.resolve(null),this.ADa=null)};Object(u.a)(d,"SharedAuthTokenStrategy",
null,[724]);c.prototype.initialize=function(){return Promise.resolve(0)};c.prototype.Djc=function(){return Promise.resolve(0)};c.prototype.EO=function(){return Promise.resolve(Object.assign(new r,{IsSuccess:!1,ErrorCode:B.a[this.ZOc],ErrorMessage:"Unable to get a token. Reason: ["+B.a[this.ZOc]+"]"}))};c.prototype.yAc=function(){return Promise.resolve(Object.assign(new r,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};
c.prototype.Xyc=function(){return!1};c.prototype.Rvb=function(){return this.oXa};Object(u.a)(c,"UnsupportedAuthTokenStrategy",null,[724]);var ka=b(935);b.d(D,"OAuthManager",function(){return a});a.prototype.eeh=function(){var Y=G.a.MAi;Y&&0<Y.length?(this.BS=1,this.XO=new z(Y)):C.AFrameworkApplication.fa.ra("IsO365ConsumerHost")||C.AFrameworkApplication.fa.ra("IsO365CommercialHost")?C.AFrameworkApplication.fa.ra("IsAnonymousUser")?(this.BS=2,this.XO=new c(this.BS)):(Y=x.a.getAuthContext().loginHint)&&
Y.length?G.a.exb?(this.BS=1,this.XO=new f):(this.BS=1,this.XO=new d):(this.BS=3,this.XO=new c(this.BS)):(this.BS=4,this.XO=new c(this.BS))};a.prototype.Nu=function(){return this.XO?this.XO.Rvb()||"Unknown":"None"};a.prototype.deh=function(Y){var qa=this;Y=void 0===Y?null:Y;v.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var fa=X.a.oe();return C.AFrameworkApplication.fa.Jdd().then(function(ha){ha?(qa.eeh(),Y&&(qa.XO=Y),v.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
G.a.clientVersion,G.a.appVersion,G.a.ahh,qa.Nu(),Math.floor(X.a.oe()-fa))):v.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(X.a.oe()-fa));return Promise.resolve(ha)},function(){v.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(X.a.oe()-fa));return Promise.resolve(!1)})};
a.prototype.P8h=function(){var Y=this;v.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.Nu());var qa=X.a.oe();return n.get(this.XO.initialize(),2,G.a.YEd).then(function(fa){if(0===fa)v.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",Y.Nu(),Math.floor(X.a.oe()-qa));else if(1===fa){v.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",Y.Nu(),Math.floor(X.a.oe()-qa));var ha=ca.a.Fr();void 0!==
ha&&null!==ha&&(ha.set("AuthLibrary",Y.Nu()),ha=Object.assign(new ea.a,{durationMs:Math.floor(X.a.oe()-qa),extendedProperties:ha}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,ha))}else 2===fa&&(v.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",Y.Nu(),Math.floor(X.a.oe()-qa)),ha=ca.a.Fr(),void 0!==ha&&null!==ha&&(ha.set("AuthLibrary",Y.Nu()),ha=Object.assign(new ea.a,{durationMs:Math.floor(X.a.oe()-
qa),extendedProperties:ha}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,ha)));return Promise.resolve(fa)},function(){v.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",Y.Nu(),Math.floor(X.a.oe()-qa));return Promise.resolve(1)})};a.prototype.vsi=function(){var Y=this;v.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.Nu());var qa=X.a.oe();return n.get(this.XO.Djc(x.a.getAuthContext()),2,G.a.YEd).then(function(fa){if(0===
fa)v.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",Y.Nu(),Math.floor(X.a.oe()-qa));else if(1===fa){v.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",Y.Nu(),Math.floor(X.a.oe()-qa));var ha=ca.a.Fr();void 0!==ha&&null!==ha&&(ha.set("AuthLibrary",Y.Nu()),ha=Object.assign(new ea.a,{durationMs:Math.floor(X.a.oe()-qa),extendedProperties:ha}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,ha))}else 2===
fa&&(v.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",Y.Nu(),Math.floor(X.a.oe()-qa)),ha=ca.a.Fr(),void 0!==ha&&null!==ha&&(ha.set("AuthLibrary",Y.Nu()),ha=Object.assign(new ea.a,{durationMs:Math.floor(X.a.oe()-qa),extendedProperties:ha}),Q.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadTimedOut",!1,!0,ha)));return Promise.resolve(fa)},function(){v.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",
Y.Nu(),Math.floor(X.a.oe()-qa));return Promise.resolve(1)})};a.prototype.EO=function(Y,qa,fa){return this.wAc(Y,qa,!1,null,"",void 0===fa?null:fa)};a.prototype.O$f=function(Y,qa,fa,ha,ia){return this.wAc(Y,qa,!0,fa,ha,void 0===ia?null:ia)};a.prototype.wAc=function(Y,qa,fa,ha,ia,wa,Qa){Qa=void 0===Qa?0:Qa;Qa+=1;v.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",Y,this.CQa(Y,qa),this.Nu(),Qa);var S=ca.a.Fr();void 0!==S&&null!==
S&&(S.set("AuthLibrary",this.Nu()),S.set("AppName",Y),S.set("Target",this.CQa(Y,qa)),Q.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",S));if(!G.a.isEnabled){var da;return this.ntd((da=new r,da.IsSuccess=!1,da.Token=null,da.ErrorCode="NotEnabled",da.ErrorMessage="OAuthManager is disabled.",da),Y)}var xa=G.a.TVc[Y];if(void 0===xa||null===xa){v.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",Y);var ta;return this.ntd((ta=
new r,ta.IsSuccess=!1,ta.Token=null,ta.ErrorCode="DisallowedApp",ta.ErrorMessage="Disallowed appName: "+Y,ta),Y)}var ab=X.a.oe(),Na=this;S=this.bqg.then(function(ra){return Na.Fdi(Y,xa,qa,fa,ha,ia,wa,ra)});da=fa?0:G.a.YEd;var Ka;ta=(Ka=new r,Ka.IsSuccess=!1,Ka.Token=null,Ka.ErrorCode="authTokenStrategy_timeout",Ka.ErrorMessage="Auth Strategy timed out after ["+da+"] ms when fetching token",Ka);var la=this,Ea=this;return n.get(S,ta,da).then(function(ra){return Qa<=a.rzi&&(ra.ErrorCode===a.Z8f||ra.ErrorCode===
a.IFj)?(v.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Qa,Math.floor(X.a.oe()-ab)),la.wAc(Y,qa,fa,ha,ia,wa,Qa)):ra.ErrorCode===a.Jhf&&!fa&&(v.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",Qa,a.lKe),a.gkh&&la.XO.Xyc()&&la.XO.yAc(Y,xa,qa,fa,ha,ia).then(function(na){return Promise.resolve(la.Vjc(na,Y,qa,xa,ab))}).catch(function(){var na,ba=(na=new r,na.IsSuccess=!1,na.Token=null,
na.ErrorCode="authTokenStrategy_failure",na.ErrorMessage="LoginPopup failed, GetToken could not be called",na);return Promise.resolve(la.Vjc(ba,Y,qa,xa,ab))}),a.lKe)?la.wAc(Y,qa,!0,ha,ia,wa,Qa):Promise.resolve(la.Vjc(ra,Y,qa,xa,ab))}).catch(function(){var ra,na=(ra=new r,ra.IsSuccess=!1,ra.Token=null,ra.ErrorCode="authTokenStrategy_failure",ra.ErrorMessage="Auth Strategy failed with an unknown error",ra);return Promise.resolve(Ea.Vjc(na,Y,qa,xa,ab))})};a.prototype.Fdi=function(Y,qa,fa,ha,ia,wa,Qa,
S){var da=this;return 1===S||2===S?this.ntd(Object.assign(new r,{IsSuccess:!1,Token:null,ErrorCode:1===S?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),Y):this.XO.EO(Y,qa,fa,ha,ia,wa,Qa).then(function(xa){return Promise.resolve(da.qrf(xa,!0,Y))}).catch(function(xa){return Promise.resolve(da.qrf(xa,!1,Y))})};a.prototype.Vjc=function(Y,qa,fa,ha,ia){var wa={};ia=X.a.oe()-ia;wa.IsSuccess=Y.IsSuccess;wa.ErrorCode=Y.IsSuccess?"Success":Y.ErrorCode||"";wa.ErrorMessage=
Y.IsSuccess?"Success":this.CQa(qa,Y.ErrorMessage||"");wa.Target=this.CQa(qa,fa||"");wa.TimeInMS=Math.floor(ia);wa.AuthLibrary=this.Nu();wa.AppName=qa;wa.AuthorityType=Object(A.a)(y,x.a.N$b());wa.UserType=this.$Zh(x.a.getAuthContext());wa.IsAuthSupportedInSession=B.a[this.BS];wa.RequestCount=++this.Gug;wa.AppId=ha;v.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(wa));Y.IsSuccess||(fa=ca.a.Fr(),void 0!==fa&&null!==fa&&(fa.set("AppName",qa),fa.set("AuthLibrary",this.Nu()),fa.set("ErrorCode",Y.ErrorCode),
fa.set("ErrorMessage",this.CQa(qa,Y.ErrorMessage)),qa=Object.assign(new ea.a,{durationMs:ia,extendedProperties:fa}),Q.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",!1,!0,qa)));return Y};a.prototype.ntd=function(Y,qa){v.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",qa,this.CQa(qa,Y.ErrorMessage));var fa=ca.a.Fr();void 0!==fa&&null!==fa&&(fa.set("AppName",qa),fa.set("AuthLibrary",this.Nu()),fa.set("ErrorCode",Y.ErrorCode),
fa.set("ErrorMessage",this.CQa(qa,Y.ErrorMessage)),qa=Object.assign(new ea.a,{extendedProperties:fa}),Q.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",!1,!0,qa));return Promise.resolve(Y)};a.prototype.Mcf=function(Y){return Y===ka.a.Izc};a.prototype.CQa=function(Y,qa){return this.Mcf(Y)&&qa?"REDACTED":qa};a.prototype.$Zh=function(Y){return C.AFrameworkApplication.fa.ra("IsAnonymousUser")?"anonymous":!Y.loginHint||1>Y.loginHint.length?"empty":-1<Y.loginHint.indexOf("guest#")?"guest":
-1<Y.loginHint.indexOf("ext#")?"external":0>Y.upn.indexOf("@")?"no-at":"supported"};a.prototype.A5a=function(){return 1===this.BS};a.prototype.qrf=function(Y,qa,fa){var ha=null,ia=null,wa=null,Qa=null;Y?Y.ErrorCode||Y.ErrorMessage?(ia=Y.ErrorCode?Y.ErrorCode:a.sQe,wa=Y.ErrorMessage?Y.ErrorMessage:"No message"):Y.Token?qa?ha=Y.Token:(ia=a.s9i,wa="A rejected promise returned a token."):(ia=a.sQe,wa=JSON.stringify(Y)):(ia=a.oDi,wa="No result came from Auth Token Strategy");Y&&Y.Telemetry&&!this.Mcf(fa)&&
(Qa=Y.Telemetry,v.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Qa)));if(ia===a.YAi||ia===a.vKj)ia=a.Z8f,wa="Auth Library Timed Out";ia===a.BMg&&-1<wa.indexOf(a.Iyg)&&(ia=a.Jhf);if(ia||wa)ha=null;return Object.assign(new r,{IsSuccess:!!ha,Token:ha,ErrorCode:ia,ErrorMessage:wa,Telemetry:Qa})};Af.Object.defineProperties(a,{lKe:{configurable:!0,enumerable:!0,get:function(){return C.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}},
gkh:{configurable:!0,enumerable:!0,get:function(){return C.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}});a.vKj="token_renewal_error";a.sQe="Exception";a.oDi="NoResult";a.s9i="RejectToken";a.YAi="monitor_window_timeout";a.Z8f="Timeout";a.IFj="authTokenStrategy_timeout";a.BMg="login_required";a.Iyg="AADSTS50058";a.Jhf="Cookies Disabled";a.kpiName="OAuthManager";a.rzi=2;Object(u.a)(a,"OAuthManager",null,[585])},1130:function(u,D,b){b.d(D,
"a",function(){return a});u=b(0);var a;(function(c){c[c.unknown=0]="unknown";c[c.supported=1]="supported";c[c.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";c[c.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";c[c.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(u.b)("SupportStatus",a)},1433:function(u,D,b){function a(){Type.registerNamespace("Common.App.LivePersonaUtils");c.main()}function c(){}function d(n){this.tUb=n}function e(){}u=b(0);var k=b(1156),l=b(4);Object(u.a)(e,
"LokiTokenResult",null,[]);d.prototype.sed=function(){var n=this,z=this.oRh();return z?d.Eod?new Promise(function(r,v){n.tUb.continueWith(function(){n.tUb.Ch||n.tUb.Yf?v(Error.create("Error downloading auth library")):n.tUb.result.EO("Loki",z).then(function(A){A=l.AFrameworkApplication.fa.ra("ForceLokiFallbackToACLPTokenIsEnabled")?n.rRh():A.IsSuccess&&A.Token?Object.assign(new e,{isSuccess:!0,token:A.Token,errorMessage:null}):Object.assign(new e,{isSuccess:!1,token:null,errorMessage:JSON.stringify(A)});
r(A);return A})})}):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",k.a.bWe())}))};d.prototype.rRh=function(){var n=l.AFrameworkApplication.fa.Wa("LokiUserDataSignature")||"";return Object.assign(new e,{isSuccess:!0,token:n,errorMessage:null})};d.prototype.oRh=
function(){var n=null,z=k.a.N$b();2===z?n=l.AFrameworkApplication.fa.Wa("LokiAADAppId"):1===z&&(n=l.AFrameworkApplication.fa.Wa("LokiMSAAppId"));return n};Af.Object.defineProperties(d,{Eod:{configurable:!0,enumerable:!0,get:function(){return l.AFrameworkApplication.fa.ra("IsO365CommercialHost")||l.AFrameworkApplication.fa.ra("IsO365ConsumerHost")}}});Object(u.a)(d,"LokiTokenManager",null,[976]);var m=b(257),f=b(84),w=b(567);c.prototype.init=function(){f.a.instance.resolve("Common.ILokiTokenManager")};
c.prototype.dispose=function(){};c.prototype.Sh=function(n){n.register(d,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").tc().Cc(function(){return new d(w.a.Mq(n.Tb("Common.App.OAuth.IOAuthManager")))})};c.main=function(){m.a.instance.Ui(new c)};Af.Object.defineProperties(c.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(u.a)(c,"LivePersonaUtilsPackage",null,[3,4]);b.d(D,"a",function(){return a})},1456:function(u,
D,b){function a(){e.a.Fa(function(z){c.ka(z)})}function c(z){var r=n.call(this)||this;r.$=z;r.Eb();return r}function d(z){this.oAuthManager=z}var e=b(11);u=b(0);var k=b(84),l=b(232),m=b(7),f=b(15),w=b(1024);d.prototype.EO=function(z,r){return this.oAuthManager?this.oAuthManager.EO(z,r).then(function(v){v.IsSuccess||f.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+v.ErrorMessage+" Error code: "+v.ErrorCode+" App name: "+z);return Object(m.a)(new w.a,{IsSuccess:v.IsSuccess,
Token:v.Token,ErrorCode:v.ErrorCode,ErrorMessage:v.ErrorMessage})}):(f.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(m.a)(new w.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};d.prototype.A5a=function(){return this.oAuthManager?this.oAuthManager.A5a():null};Object(u.a)(d,"OAuthManagerWrapper",null,[619]);var n=l.a;Rk(c,n);c.prototype.create=function(){this.pb(this.$.da.za(349)||new d(k.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};
c.ka=function(z){z.da.Ga(350,new c(z))};Object(u.a)(c,"OAuthManagerFactory",l.a,[]);b.d(D,"a",function(){return a})},1481:function(u,D,b){function a(){Type.registerNamespace("Common.App.OAuth");c.main()}function c(){}u=b(0);var d=b(15),e=b(1053),k=b(1130),l=b(4),m=b(99),f=b(942),w=b(257),n=b(39),z=b(25),r=b(84),v=b(190);c.prototype.Sh=function(A){A.register(585,"Common.App.OAuth.IOAuthManager").tc().Cc(function(){return new e.OAuthManager})};c.prototype.init=function(){var A=r.a.instance.resolve("Common.App.OAuth.IOAuthManager");
this.QNj(A)};c.prototype.QNj=function(A){var B=l.AFrameworkApplication.fa.Wa("FileSource");if(l.AFrameworkApplication.fa.ra("IsO365ConsumerHost")||l.AFrameworkApplication.fa.ra("IsO365CommercialHost")||"WopiTest"===B){var y=f.a.YDh,x=f.a.authority;if(void 0!==y&&null!==y&&y.length&&void 0!==x&&null!==x&&x.length){var C=k.a[A.BS],G=z.a.qGa,E=A.Nu();try{var I=new Map;void 0!==I&&null!==I?(I.set("SupportStatus",C),I.set("Browser",G),I.set("AuthStrategy",E)):I=null}catch(M){I=null}m.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT",
"WacOAuthFC",I);var U=n.a.oe();A.EO("Core",y).then(function(M){var T=Math.floor(n.a.oe()-U);C=k.a[A.BS];G=z.a.qGa;E=A.Nu();d.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',T,M.IsSuccess,C,M.ErrorCode,B,G,E);I&&(I.set("SupportStatus",C),I.set("Browser",G),I.set("AuthStrategy",E));T=Object.assign(new v.a,{durationMs:T,extendedProperties:I});
M.IsSuccess?m.Health.instance.recordKpiSuccess("WacCorePFT",T):m.Health.instance.recordKpiFailure("WacCorePFT",M.ErrorCode,!1,!1,T)}).catch(function(M){var T=Math.floor(n.a.oe()-U);T=Object.assign(new v.a,{durationMs:T,extendedProperties:I});m.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+M.toString(),!1,!1,T)})}}};c.prototype.dispose=function(){};c.main=function(){w.a.instance.Ui(new c)};Af.Object.defineProperties(c.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});
Object(u.a)(c,"OAuthPackage",null,[3,4]);b.d(D,"a",function(){return a})},1666:function(u,D,b){b.r(D);u=b(1481);D=b(1433);b=b(1456);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(u.a)();Object(D.a)();Object(b.a)()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/3f31cbcd01ca9f30ec3b38536c037345/EwaDS.oauth.js.map