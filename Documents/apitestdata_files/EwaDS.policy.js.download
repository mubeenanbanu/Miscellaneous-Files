(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[59],{1637:function(u,D,b){function a(cb){return Qb.call(this,cb)||this}function c(cb){this.$=cb}function d(cb){var Xb=Qe.call(this)||this;Xb.$=cb;Xb.Eb();return Xb}function e(cb,Xb,kc,Wc,id){var Vc=Re.call(this)||this;Vc.statusBarManager=null;Vc.XXc=!1;Vc.Y9=null;Vc.QBc=!1;Vc.fNd=null;Vc.Ixa=null;Vc.YCd=!1;Vc.ko=!1;Vc.Ap=null;Vc.Uce=null;Vc.Afa=null;Vc.Nbe=null;Vc.KDa=null;Vc.iKe=function(){da.ULS.sendTraceTag(537154520,306,
50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");var td=Vc.gNf(1);da.ULS.sendTraceTag(537154519,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: {0}.",td)};Vc.ARd=function(td,rd){rd?(Vc.Ap=rd.title,Vc.Uce=rd.Kpc,Vc.Afa=rd.buttonText,Vc.Nbe=rd.Ptf,Vc.fE.Jf(27,null),da.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):da.ULS.sendTraceTag(537154510,306,15,
"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};Vc.A3f=function(td,rd){var za=Object(eb.a)(U,rd);za?za.$2f?Vc.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(da.ULS.sendTraceTag(537154508,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of {0}",za.errorType),Vc.fE.bBj(za.title,za.message,za.buttonText,function(tb){za.wY&&(Vc.fE.hC(53)&&Vc.fE.removeEntry(53),za.wY(tb))})):1===za.errorType?
(da.ULS.sendTraceTag(537154507,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),Vc.fE.Jf(48,null)):2===za.errorType?Vc.fE.Jf(49,null):3===za.errorType?Vc.fE.Jf(50,null):4===za.errorType?Vc.fE.Jf(51,null):5===za.errorType?Vc.fE.cBj(za.title,za.message,za.buttonText,function(tb){Vc.fE.hC(52)&&Vc.fE.removeEntry(52);za.wY(tb)}):Vc.fE.Jf(47,null):da.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):
(da.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),Vc.fE.Jf(47,null))};Vc.PXd=function(td,rd){Vc.w6&&(da.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),Vc.w6.MZf(),Vc.w6.eZf(),Vc.w6.rJf(),Vc.$.Bd&64&&(rd.onSuccess&&Vc.Ixa?Vc.rKg():Vc.w6.d$f()));Vc.fa.ra("SupportsOfficeClientCoauthoring")&&(td=Vc.nr.un,Vc.KDa=td.AppliedPolicyId,"null"===Vc.labelId&&(Vc.KDa=""),Vc.QBc&&(td=td.PolicyLabelAssignmentMethod&&
Va.e(td.PolicyLabelAssignmentMethod)===Va.e("standard")?4:2,Vc.applyPolicyLabel(Vc.labelId,td,!0,Vc.fNd)));Vc.FQe();Vc.xz()};Vc.cxf=function(){Vc.YCd=!0;Vc.FQe()};Vc.TBf=function(td,rd){da.ULS.sendTraceTag(42322116,306,50,"PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = {0}, ApplyLabelFlag = {1}",Ka.AFrameworkApplication.protectedFile,rd.uP);Vc.applyPolicyLabel(rd.Jpc,rd.uP,!1,null)};Vc.gGi=function(td,rd){Vc.KDa=rd.Jpc;if(fd.a.Xq(td.Errors)){var za=
fd.a.jaa(td.Errors,[2045508683]);0<za.length&&(td.Errors=fd.a.CF(td.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),Vc.$.ea.kp(td.Errors));za=fd.a.jaa(td.Errors,[2046680228]);0<za.length&&(4===rd.uP||1===rd.uP)&&(td.Errors=fd.a.CF(td.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),Vc.$.ea.kp(td.Errors));za=td=null;for(var tb=ak(Vc.nr.un.SensitivityLabels),Wb=tb.next();!Wb.done;Wb=tb.next())Wb=Wb.value,Bd.a.equals(Vc.labelId,
Wb.Id,!1)&&(td=Wb),Bd.a.equals(rd.iXf,Wb.Id,!1)&&(za=Wb);tb={};tb.ApplyLabelFlag=rd.uP;td?(tb.currentLabel="Set",tb.currentLabelEnabled=td.Enabled,tb.currentLabelName=td.Name?"Set":"NotSet",tb.currentLabelParentId=td.ParentId?"Set":"NotSet"):tb.currentLabel="NotSet";za?(tb.serverLabel="Set",tb.serverLabelEnabled=za.Enabled,tb.serverLabelName=za.Name?"Set":"NotSet",tb.serverLabelParentId=za.ParentId?"Set":"NotSet"):tb.serverLabel="NotSet";da.ULS.sendTraceTag(541638850,306,15,"PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : {0}",
JSON.stringify(tb))}};Vc.qOg=function(td,rd){if(!Vc.$.workbookContext.HasRoundTrippedHFPart)return!1;var za=Vc.nr.un;if(!za)return da.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;var tb=null;za=ak(za.SensitivityLabels);for(var Wb=za.next();!Wb.done;Wb=za.next())Wb=Wb.value,Bd.a.equals(Wb.Id,td,!1)&&(tb=Wb);return tb&&Vc.i5h(tb)?(da.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),
Vc.Oyj(rd),!0):!1};Vc.Ldi=function(){var td=!1;!Vc.$.ya.IsNewWorkbook||Vc.labelId&&Vc.labelId.length||(td=!0);da.ULS.sendTraceTag(537154501,306,50,"PolicyManagerWrapper.IsANewFile: is this a new file : {0}",td);return td};Vc.jof=function(td,rd){1===rd.xpe?Vc.$.isEditMode?(da.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),Vc.$.Ka.Kb(new ed.a(-723527778,0,Vc.$.Jc,10,null))):da.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):
(Vc.Ixa=rd.Ixa,Vc.$.ea.p2(Vc.Jqe),Vc.$.Jeb(),da.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),Vc.$.Ka.Kb(new ed.a(-8805455,0,Vc.$.Jc,10,null)))};Vc.Wke=function(td,rd){rd?(td=!!(Vc.$.Bd&64),da.ULS.sendTraceTag(537154496,306,50,"AddMandatoryLabellingBusinessBar User has edit permission : {0}",td),td&&(Vc.$.Jeb(),Vc.fE.iAj(rd.title,rd.message,rd.buttonText,function(za){rd.wY(za)}))):da.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};
Vc.yOf=function(){Vc.fE.hC(41)&&Vc.fE.removeEntry(41)};Vc.pag=function(td,rd){rd.Vwj&&(da.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),pc.TaskExtensions.Ba(Fb.GetServiceTaskFactory.Ra(Vc.$.da,55,56,0),function(za){za.result.U1c()},Vc.$.la,3))};Vc.Jqe=function(){Vc.Ixa&&Vc.$.isEditMode?(Vc.$.ea.e0(Vc.Jqe),Vc.t3a()):da.ULS.sendTraceTag(537154467,306,15,"ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty {0} , edit mode : {1}.",
!Vc.Ixa,Vc.$.isEditMode)};Vc.NLj=function(){Vc.$.isEditMode?(Vc.$.ea.e0(Vc.NLj),Vc.t3a()):da.ULS.sendTraceTag(537154466,306,15,"TriggerDefaultLabelingOnModeChanged is not expected in View-mode. Mode.")};Vc.Nja=function(){var td=Vc.$.ea.lo;td&&!Bd.a.equals(td.AppliedPolicyLabelId,Vc.labelId,!1)&&(da.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),da.ULS.shipAssertTag(537154463,306,Vc.$.isEditMode,
"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),Vc.fa.ra("SupportsOfficeClientCoauthoring")&&Vc.$.isEditMode&&(Vc.QBc=!0,Vc.fNd=td.AppliedPolicyLabelId),Vc.KDa=td.AppliedPolicyLabelId,Vc.t3a())};Vc.knd=function(){var td=!0;if(!Vc.$.ea.amIAlone)for(var rd=ak(Vc.$.ea.Dm),za=rd.next();!za.done;za=rd.next())if(!za.value.SupportsClientIsMipTrusted){td=!1;break}da.ULS.sendTraceTag(537154462,306,50,
"PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : {0}",td);return td};Vc.jyf=function(){da.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");Vc.QBc=!0;Vc.t3a()};Vc.$=Wc;Vc.nr=cb;Vc.fE=kc;Vc.fa=id;Vc.nr.lne(Vc.ARd);Vc.w6=Xb;return Vc}function k(cb){return Pd.call(this,cb,k.zQ(cb))||this}function l(cb,Xb,kc,Wc,id){var Vc=jd.call(this)||this;Vc.wof=3;Vc.augmentationLoopManager=null;Vc.zA=null;Vc.rZa=!1;Vc.X9a=[];Vc.Vif=new Vd.a(se.a.TJ());
Vc.kEd=0;Vc.pEd=null;Vc.Oqb=function(td,rd){td=Object(Fd.a)(new fe.a,{parentPath:["session","doc","security"],items:[Object(Fd.a)(new Hc.a,{id:"clp",body:Object(Fd.a)(new w,{existingLabelPriority:rd.existingLabelPriority,partialDocSITs:rd.aze,fullDocSITs:rd.$ye})})]});Vc.X9a.push(td);Vc.Cxb()};Vc.Dbg=function(td,rd){td=Object(Fd.a)(new ud.a,{parentPath:["session","doc","security"],items:[Object(Fd.a)(new Hc.a,{id:"clp",body:Object(Fd.a)(new w,{existingLabelPriority:rd.existingLabelPriority})})]});
Vc.X9a.push(td);Vc.Cxb()};Vc.Ebg=function(td,rd){td=Object(Fd.a)(new ud.a,{parentPath:["session","doc","security"],items:[Object(Fd.a)(new Hc.a,{id:"clp",body:Object(Fd.a)(new w,{partialDocSITs:rd.aze,fullDocSITs:rd.$ye})})]});Vc.X9a.push(td);Vc.Cxb()};Vc.X5=function(){da.ULS.sendTraceTag(537154588,306,50,"AutoPolicyManager::OnApplicationModeChanged - isEditMode:{0}.",Vc.$.isEditMode);Vc.$.isEditMode?ld.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Vc.Cxb():
Vc.k9e():(Vc.businessBar.removeEntry(40),Vc.businessBar.removeEntry(39),Vc.Ibh())};Vc.Z8a=function(){da.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");Vc.yGe();Vc.augmentationLoopManager=null};Vc.jqi=function(td,rd){var za,tb,Wb,fc,xc;da.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===rd.operationType)da.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");
else{var Yb=td=null,Ec=null;if(Vc.Vld()){var bd=rd.mJ;if(!bd){da.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(za=bd.automatic)||void 0===za?0:za.id)td=bd.automatic.id;if(null===(tb=bd.recommended)||void 0===tb?0:tb.id)Yb=bd.recommended.id,bd.recommended.policyTip&&(Ec=bd.recommended.policyTip)}else{za=rd.mJ;if(!za){da.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");
return}if(null===(Wb=null===(bd=za.automatic)||void 0===bd?void 0:bd.sensitivityLabel)||void 0===Wb?0:Wb.id)td=za.automatic.sensitivityLabel.id;if(null===(xc=null===(fc=za.recommended)||void 0===fc?void 0:fc.sensitivityLabel)||void 0===xc?0:xc.id)Yb=za.recommended.sensitivityLabel.id,za.recommended.sensitivityLabel.policyTip&&(Ec=za.recommended.sensitivityLabel.policyTip)}Vc.applyPolicyLabel(td,Yb,Ec,1)}};Vc.jsi=function(td,rd){da.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===rd.operationType?da.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(td=rd.mJ)?(td=td.classificationId,Vc.applyPolicyLabel(td,td,null,2)):da.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};Vc.aOf=function(td,rd){rd?rd.Azb&&Vc.businessBar.hC(40)?(Vc.businessBar.removeEntry(40),da.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!rd.Azb&&Vc.businessBar.hC(39)&&(Vc.businessBar.removeEntry(39),da.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):da.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};Vc.k2f=function(td,rd){rd?rd.Azb?(Vc.businessBar.UAj(rd.title,rd.message,rd.buttonText,function(za){rd.wY(za);Vc.businessBar.hC(40)&&Vc.businessBar.removeEntry(40)}),da.ULS.sendTraceTag(537154531,
306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(Vc.businessBar.Myj(rd.title,rd.message,rd.buttonText,function(za){rd.wY(za);Vc.businessBar.hC(39)&&Vc.businessBar.removeEntry(39)}),da.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):da.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};Vc.XCd=
cb;Vc.policyManager=Xb;Vc.$=kc;Vc.fa=Wc;Vc.businessBar=id;Vc.L8h();Vc.y7i();Vc.disposed=!1;return Vc}function m(){var cb=Gd.call(this)||this;cb.classificationId=null;cb.H_=Object.assign(new Ie.a,{T_:m.getTypeName(),B_:m.Rd()});return cb}function f(){var cb=Qd.call(this)||this;cb.recommended=null;cb.automatic=null;cb.source=null;cb.H_=Object.assign(new Ie.a,{T_:f.getTypeName(),B_:f.Rd()});return cb}function w(){var cb=n.call(this)||this;cb.existingLabelPriority=null;cb.H_=Object.assign(new Ie.a,{T_:w.getTypeName(),
B_:w.Rd()});return cb}function n(){var cb=pe.call(this)||this;cb.partialDocSITs=null;cb.fullDocSITs=null;cb.H_=Object.assign(new Ie.a,{T_:n.getTypeName(),B_:n.Rd()});return cb}function z(){var cb=ef.call(this)||this;cb.recommended=null;cb.automatic=null;cb.source=null;cb.H_=Object.assign(new Ie.a,{T_:z.getTypeName(),B_:z.Rd()});return cb}function r(cb,Xb,kc,Wc,id,Vc,td){td=cb.Na(1,void 0===td?null:td);td.tenantId=Xb;return qe.g(cb,"GetPolicyApplicationMethod",td,kc,Wc,id,Vc,4)}function v(cb,Xb,kc,
Wc,id,Vc,td){td=cb.Na(1,void 0===td?null:td);td.tenantId=Xb;return qe.g(cb,"GetPolicyLabelId",td,kc,Wc,id,Vc,4)}function A(){this.YFa=this.annotationType=null;this.wLa=this.eF=!1}function B(){this.Jpc=this.iXf=null;this.uP=0}function y(){this.f1=this.Kqa=this.fb=this.Ig=null}function x(cb,Xb,kc,Wc,id){Wc=void 0===Wc?0:Wc;id=void 0===id?null:id;this.TGc=this.M4d=null;this.dra=this.rib=this.tib=0;this.j8="";this.FEa=this.LEc=this.Z7d=this.bpa=this.qMc=null;this.B8d=!1;this.mCa=null;this.tJc=0;this.YUb=
this.HEa=this.qDa=this.XUb=null;this.$a=new zb.a;this.zKb=this.Dvb=this.CEa=null;this.fKc=!1;this.dBb=null;this.ib=cb;this.Pg=Xb;this.qh=kc;this.$Tb=Wc;this.un=new N;this.Sce=this.ib.Wa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.WO=id;this.byb=cb.ra("WacApplyManualPolicyLabelIsEnabled");this.xfc=cb.ra("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=cb.ra("SupportsOfficeClientCoauthoring");this.rmi=!1;this.Nrj=3E4;this.de=ac.a.instance;cb.ra("SupportsPolicies")&&
fb.a("MipSupportsPolicies");this.xfc&&this.supportsOfficeClientCoauthoring&&fb.a("MipSupportsOfficeClientCoauthoring")}function C(){}function G(cb,Xb,kc,Wc,id,Vc,td,rd,za,tb,Wb,fc,xc,Yb,Ec,bd,Ic,Md,ne,le,Ke){this.url=cb;this.EVj=Xb;this.body=kc;this.headers=Wc;this.Wcb=id;this.priority=Vc;this.state=td;this.Lfg=void 0===rd?null:rd;this.WN=void 0===za?null:za;this.BV=void 0===tb?!1:tb;this.T2i=void 0===Wb?null:Wb;this.pnj=void 0===fc?null:fc;this.name=void 0===xc?null:xc;this.nFb=void 0===Yb?null:
Yb;this.Rad=void 0===Ec?!1:Ec;this.EEf=void 0===bd?null:bd;this.R8b=void 0===Ic?null:Ic;this.bfc=void 0===Md?null:Md;this.Cbb=void 0===ne?null:ne;this.I6h=void 0===le?null:le;this.responseType=void 0===Ke?null:Ke}function E(cb){var Xb=kb.call(this)||this;Xb.Vwj=cb;return Xb}function I(cb){var Xb=Ya.call(this)||this;Xb.qKg=cb;return Xb}function U(cb,Xb,kc,Wc,id,Vc,td){Wc=void 0===Wc?null:Wc;id=void 0===id?null:id;Vc=void 0===Vc?null:Vc;td=void 0===td?null:td;var rd=Aa.call(this)||this;rd.errorType=
cb;rd.qKg=Xb;rd.$2f=kc;rd.title=Wc;rd.message=id;rd.buttonText=Vc;rd.wY=td;return rd}function M(cb,Xb){var kc=Pb.call(this)||this;kc.Jpc=cb;kc.uP=Xb;return kc}function T(){return sb.call(this)||this}function F(cb,Xb){var kc=ob.call(this)||this;kc.Wob=cb;kc.Azb=Xb;return kc}function K(cb,Xb,kc,Wc){var id=Ab.call(this)||this;id.title=cb;id.Kpc=Xb;id.buttonText=kc;id.Ptf=Wc;return id}function J(cb,Xb){var kc=rb.call(this)||this;kc.Ixa=cb;kc.xpe=Xb;return kc}function O(cb){cb=void 0===cb?!1:cb;var Xb=
Da.call(this)||this;Xb.onSuccess=cb;return Xb}function N(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelId="";this.SensitivityLabels=
[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}function H(){return pa.call(this)||this}function Q(cb){var Xb=Ta.call(this)||this;Xb.v_j=cb;return Xb}function ca(cb,Xb,kc){var Wc=$a.call(this)||this;Wc.aze=cb;Wc.$ye=Xb;Wc.existingLabelPriority=kc;return Wc}function X(cb,Xb,kc,Wc,id){var Vc=oa.call(this)||this;Vc.Wob=cb;Vc.title=Xb;Vc.message=kc;Vc.buttonText=Wc;Vc.wY=id;return Vc}function Z(cb,Xb,kc,Wc,id,Vc){var td=P.call(this)||this;td.Wob=cb;td.title=Xb;td.message=kc;td.buttonText=Wc;td.wY=
id;td.Azb=Vc;return td}function ea(cb,Xb,kc,Wc){this.DLc=this.ELc=null;this.z8d=this.VKc=this.nLc=this.$ib=this.Z$d=this.XGc=!1;this.UUa=this.Wea=this.Pfa=this.epa=this.cWa=this.xu=this.d9=this.oh=null;this.REc=0;this.y5d=this.kLc=this.bFc=null;this.La=cb;this.Se=Xb;this.ib=kc;this.Ig=Wc;this.Jjb={};this.Tce={};this.$$d={};this.byb=kc.ra("WacApplyManualPolicyLabelIsEnabled");this.Ig.value.Bne(Object(xa.a)(this,this.IEd,"processAutoSensitivityLabel"));this.Ig.value.$Uc(Object(xa.a)(this,this.IEd,"processAutoSensitivityLabel"));
this.Ig.value.hZb(Object(xa.a)(this,this.BTi,"onUpdateLabelInfo"));Ka.AFrameworkApplication.ta&&Ka.AFrameworkApplication.ta.CFg(Object(xa.a)(this,this.c7i,"refreshDocumentPolicyLabelsOnModeChange"));kc.ra("SupportsPolicies")&&kc.Wa("AppliedPolicyId")&&(this.ELc=kc.Wa("IrmPolicyTitle"),this.DLc=kc.Wa("IrmPolicyDescription"));this.IOc=kc.ra("ProtectedFile");this.Rkg=this.ib.kd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.Skg=this.ib.kd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}
function ka(cb,Xb,kc){var Wc=ya.call(this,!1,!1,ka.pu)||this;Wc.VVb=cb;Wc.cWa=Xb;Wc.yD=kc;Wc.Rb=1;Wc.ze=ka.id;Wc.i7(1);Wc.i7(0);return Wc}function Y(){}function qa(){this.Xib=!!Ka.AFrameworkApplication.ta&&Ka.AFrameworkApplication.ta.Pa.Wu}function fa(cb,Xb,kc){var Wc=sa.call(this,!1,!1,!0)||this;if(!cb||!kc)return da.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs"),Wc;var id={};id=(id.id="MandatoryLabellingDialog",id);Wc.ing=kc;Wc.eMc=Xb;if(!Ka.AFrameworkApplication.fa.ra("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||
Wc.eMc&&""!==Wc.eMc)Xb={},Xb=(Xb.href=Wc.eMc,Xb.target="_blank",Xb),kc={},id.learnMoreLink=(kc.type="AppLinkProps",kc.id="mandatoryLabellingLearnMoreLink",kc.text=CommonUIStrings.l_LearnMore,kc.handler=Xb,kc.customTooltip=CommonUIStrings.L_LearnMoreTooltip,kc);Xb={};cb=(Xb.id="mandatoryLabellingFlyoutMenuSection",Xb.controls=cb,Xb);Xb={};Xb=(Xb.sections=[],Xb.shouldAutoOpen=!1,Xb);Array.add(Xb.sections,cb);cb={};id.labelFlyout=(cb.type="AppFlyoutAnchorProps",cb.id="mandatoryLabellingFyout",cb.label=
"Pick a label",cb.hideLabel=!1,cb.hideChevron=!1,cb.hideIcon=!0,cb.menuDefinition=Xb,cb);cb={};cb=(cb.id="MandatoryLabellingDialog",cb.bodyControls=id,cb);id.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;id.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;Wc.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(xa.a)(Wc,Wc.myi,"mandatoryLabellingDialogHandler"),cb);return Wc}function ha(cb,Xb){var kc=ba.call(this,
!1,!1,ha.pu)||this;kc.fqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];kc.iVb=null;kc.gVb=!1;kc.VVb=cb;kc.yD=Xb;kc.Wf=kc.iQg();kc.Rb=1;kc.ze=ha.id;kc.mc(1,CommonUIStrings.l_DialogChange);kc.WK(1,!1);kc.i7(0);return kc}function ia(){}function wa(cb,Xb){this.uP=cb;this.displayName=Xb}function Qa(cb,Xb,kc){kc=void 0===kc?null:kc;this.id=cb.Id;kc||(kc="");this.f6i=kc;this.sensitivityLabel=
cb}b.r(D);var S=b(0),da=b(15),xa=b(83),ta=b(1062),ab=b(202);Object(S.a)(Qa,"AutoPolicyLabelData",null,[]);Object(S.a)(wa,"PolicyLabelRequestState",null,[]);var Na=b(150),Ka=b(4),la=b(158),Ea=b(13),ra=b(43),na=b(30);Af.Object.defineProperties(ia,{trd:{configurable:!0,enumerable:!0,get:function(){return ia.Ipi}}});ia.Ipi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(S.a)(ia,"JustificationDialogHtml",null,[]);var ba=Na.a;Rk(ha,ba);ha.prototype.qRd=function(){if(ha.pu)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(xa.a)(this,this.dLf,"reactJustificationDialogHandler"),this.E0e(this.gVb));else{for(var cb={},Xb=0;Xb<this.fqa.length;Xb++)cb[ha.qFd+Xb]=!1;cb[ha.KMb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(xa.a)(this,this.Hpi,"justificationDialogHandler"),cb);this.V7i();ra.a.addHandler($get(ha.KMb),
Ea.a.input,Object(xa.a)(this,this.hIj,"textAreaHandler"))}};ha.prototype.validate=function(){if(ha.pu)return this.Geg(this.iVb);var cb=$get(ha.KMb);return cb.disabled?!0:this.Geg(cb.value)};ha.prototype.Geg=function(cb){var Xb=2>cb.length,kc=500<cb.length,Wc=RegExp("[{|}|;|\\\\]").test(cb);cb=""===na.a.Rrc(cb);return!Xb&&!kc&&!Wc&&!cb};ha.prototype.Hpi=function(cb,Xb){var kc="";if(1===cb)for(var Wc=0;Wc<this.fqa.length;Wc++)if(Xb[ha.qFd+Wc]){kc=Wc===this.fqa.length-1?Xb[ha.KMb]:this.fqa[Wc];break}this.yD(cb,
this.VVb,kc)};ha.prototype.dLf=function(cb){var Xb="";1===cb&&this.iVb&&(Xb=this.iVb);this.yD(cb,this.VVb,Xb)};ha.prototype.ENi=function(cb){this.iVb=cb;cb=this.validate();this.gVb!==cb&&(this.gVb=cb,this.nTa(CommonUIStrings.l_SensitivityJustificationTitle,Object(xa.a)(this,this.dLf,"reactJustificationDialogHandler"),this.E0e(this.gVb)))};ha.prototype.E0e=function(cb){var Xb={},kc={},Wc={},id={};return id.id=this.ze,id.bodyControls=(kc.choiceGroupProps={},kc.textAreaProps=(Xb.placeholder=CommonUIStrings.l_SensitivityJustificationPlaceholder,
Xb),kc),id.actionButtonProps=(Wc.label=CommonUIStrings.l_DialogChange,Wc.disabled=!cb,Wc),id.infoMessage=CommonUIStrings.l_SensitivityJustificationMessage,id.justificationIrrelevantLabel=CommonUIStrings.l_SensitivityJustificationNoLongerApplies,id.justificationIncorrectLabel=CommonUIStrings.l_SensitivityJustificationIncorrect,id.justificationOtherLabel=CommonUIStrings.l_SensitivityJustificationOther,id.onJustificationUpdated=Object(xa.a)(this,this.ENi,"onJustificationUpdated"),id};ha.prototype.hIj=
function(cb){cb.target&&this.WK(1,this.validate())};ha.prototype.iQg=function(){return Na.a.Po(ha.trd,Ka.AFrameworkApplication.JC,la.getImageClass(ha.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.fqa[0],this.fqa[1],this.fqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)};ha.prototype.V7i=function(){for(var cb=document.getElementsByName(ha.msi),Xb=0;Xb<cb.length;Xb++)ra.a.addHandler(cb[Xb],Ea.a.focus,Object(xa.a)(this,this.MJf,"radioButtonFocusHandler")),ra.a.addHandler(cb[Xb],
Ea.a.click,Object(xa.a)(this,this.MJf,"radioButtonFocusHandler"))};ha.prototype.MJf=function(cb){if(cb=cb.target){cb.checked=!0;var Xb=$get(ha.KMb);cb.id===ha.qFd+(this.fqa.length-1)?(Xb.disabled=!1,Sys.UI.DomElement.setVisible(Xb,!0),Xb.focus()):(Xb.disabled=!0,cb.focus());this.WK(1,this.validate())}};Af.Object.defineProperties(ha,{pu:{configurable:!0,enumerable:!0,get:function(){return Ka.AFrameworkApplication.ta.Pa.Wu&&Ka.AFrameworkApplication.ta.Pa.lpd}}});ha.trd=ia.trd;ha.msi="ListRadioBox";
ha.qFd="radiobox";ha.KMb="txtJustification";ha.iconName="Info_32x32x32";ha.id="JustificationDialog";Object(S.a)(ha,"JustificationDialog",Na.a,[]);var sa=Na.a;Rk(fa,sa);fa.prototype.myi=function(cb,Xb){1===cb&&Xb.selectedLabel&&(cb=Xb.selectedLabel,""!==cb&&this.ing(cb))};Object(S.a)(fa,"MandatoryLabellingDialog",Na.a,[]);qa.prototype.t7g=function(cb,Xb,kc){this.Xib&&new fa(cb,Xb,kc)};Af.Object.defineProperties(qa,{instance:{configurable:!0,enumerable:!0,get:function(){return qa.Ma||(qa.Ma=new qa)}}});
qa.Ma=null;Object(S.a)(qa,"MandatoryLabellingDialogFactory",null,[682]);Y.gFj="sbProtectForm14";Y.iFj="SBStatusBarMarkAsReadOnly14";Y.xri="Info_16x16x32";Y.Hpb="QuickSearchCompletedToday_16x16x32";Y.QFd="CommonControlCheckboxCheck_16";Y.m9f="On";Y.visible="Visible";Y.dCh="ImageIsVisible";Y.TF="SourceControlId";Y.menuItemId="MenuItemId";Y.menu="Menu";Y.SVc="AppLockId";Y.value="Value";Y.ni="LabelText";Y.alt="Alt";Y.H8e="Image16by16";Y.f5a="Image16by16Class";Y.fFj="SBProtectForm_16";Y.hFj="SBStatusBarMarkAsReadOnly_16";
Y.icon="Icon";Y.iconColor="IconColor";Y.customTooltip="CustomTooltip";Y.u5i="MipTagDynamicFillWithOutline_20";Y.v5i="MipTagLockDynamicFillWithOutline_20";Y.t5i="MipTagErrorOutline_20";Y.w5i="MipTagQuestionOutline_20";Y.eWd="transparent";Object(S.a)(Y,"PolicyConstants",null,[]);var ya=Na.a;Rk(ka,ya);ka.prototype.ORd=function(){var cb={};cb=(cb.id="UserDefinedPermissionsDialog",cb);ka.pu&&this.initializeAndShow("Defined Permissions",Object(xa.a)(this,this.xUj,"userDefinedPermissionsDialogHandler"),
cb)};ka.prototype.xUj=function(cb){1!==cb&&this.yD(cb,this.VVb,"",this.cWa)};Af.Object.defineProperties(ka,{pu:{configurable:!0,enumerable:!0,get:function(){return Ka.AFrameworkApplication.ta.Pa.Wu&&Ka.AFrameworkApplication.ta.Pa.lpd}}});ka.id="UserDefinedPermissionsDialog";Object(S.a)(ka,"UserDefinedPermissionsDialog",Na.a,[]);var va=b(652),W=b(394),La=b(323),Ia=b(631),mb=b(99),fb=b(187),Ma=b(625),Hb=b(622),Kb=b(167),Ub=b(463),gb=b(135),Db=b(89),Va=b(205),yb=b(344),qb=b(84),dc=b(107),bb=b(27),db=
b(58);ea.prototype.Cg=function(){this.La.Mb(bb.a.ZDf,dc.a.frame,Object(xa.a)(this,this.kIe,"documentLabelPaneHandler"));this.La.Ie(bb.a.fab,dc.a.frame,Object(xa.a)(this,this.fab,"queryPolicyLabel"),96);this.La.Mb(bb.a.OSa,dc.a.frame,Object(xa.a)(this,this.OSa,"toggleSensitivity"));this.La.Mb(bb.a.Vya,dc.a.frame,Object(xa.a)(this,this.Vya,"populateSensitivityFlyout"));this.La.Mb(bb.a.setSensitivity,dc.a.frame,Object(xa.a)(this,this.setSensitivity,"setSensitivity"));this.La.Ie(bb.a.gab,dc.a.frame,Object(xa.a)(this,
this.gab,"querySensitivity"),96);this.La.Mb(bb.a.D6,dc.a.frame,Object(xa.a)(this,this.D6,"querySensitivityToggleButton"));this.La.Mb(bb.a.C6,dc.a.frame,Object(xa.a)(this,this.C6,"querySensitivitySubFlyout"));this.gmb(bb.a.OSa)||this.La.icb(bb.a.OSa,4);this.gmb(bb.a.Vya)||this.La.icb(bb.a.Vya,4);this.gmb(bb.a.setSensitivity)||this.La.icb(bb.a.setSensitivity,4);this.gmb(bb.a.D6)||this.La.icb(bb.a.D6,4);this.gmb(bb.a.C6)||this.La.icb(bb.a.C6,4);this.Se.updateCommandUI();Ka.AFrameworkApplication.fa&&
Ka.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Kb.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.Ig.value.wbj(Object(xa.a)(this,this.eNf,"registerActionsHandler"))};ea.prototype.eNf=function(){this.Cg()};ea.prototype.GNb=function(){this.La.jD(bb.a.ZDf,dc.a.frame,Object(xa.a)(this,this.kIe,"documentLabelPaneHandler"));this.La.jD(bb.a.fab,dc.a.frame,Object(xa.a)(this,
this.fab,"queryPolicyLabel"));this.La.jD(bb.a.OSa,dc.a.frame,Object(xa.a)(this,this.OSa,"toggleSensitivity"));this.La.jD(bb.a.Vya,dc.a.frame,Object(xa.a)(this,this.Vya,"populateSensitivityFlyout"));this.La.jD(bb.a.setSensitivity,dc.a.frame,Object(xa.a)(this,this.setSensitivity,"setSensitivity"));this.La.jD(bb.a.gab,dc.a.frame,Object(xa.a)(this,this.gab,"querySensitivity"));this.La.jD(bb.a.D6,dc.a.frame,Object(xa.a)(this,this.D6,"querySensitivityToggleButton"));this.La.jD(bb.a.C6,dc.a.frame,Object(xa.a)(this,
this.C6,"querySensitivitySubFlyout"))};ea.prototype.OSa=function(){return 32};ea.prototype.XVe=function(cb){var Xb="mandatoryLabelling_"+cb.Id;this.$$d[Xb]=cb.Id;var kc={};return kc.type="AppToggleButtonProps",kc.id=Xb,kc.label=cb.DisplayName,kc.hideLabel=!1,kc.customTooltip=cb.Tooltip,kc};ea.prototype.EMa=function(){return this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)};ea.prototype.wRh=function(){var cb=[],Xb=this.d9,kc;for(kc in Xb){var Wc=Xb[kc],id=this.xu[kc];if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",
!1)){if(!id||!id.Enabled||id.HasUserDefinedPermissions)continue}else if(!id||!id.Enabled)continue;if(Wc.count){var Vc={};Vc=(Vc.sections=[],Vc.shouldAutoOpen=!1,Vc);var td={};td=(td.id="mandatoryLabelling_flyoutMenuSection_"+id.Id,td.controls=[],td);Wc=ak(Wc);for(var rd=Wc.next();!rd.done;rd=Wc.next()){rd=this.xu[rd.value];if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!rd||!rd.Enabled||rd.HasUserDefinedPermissions)continue}else if(!rd||
!rd.Enabled)continue;Array.add(td.controls,this.XVe(rd))}Array.add(Vc.sections,td);td={};id=(td.type="AppFlyoutAnchorProps",td.id="mandatoryLabelling_"+id.Id,td.label=id.DisplayName,td.hideLabel=!1,td.hideChevron=!1,td.hideIcon=!1,td.menuDefinition=Vc,td);Array.add(cb,id)}else Array.add(cb,this.XVe(id))}return cb};ea.prototype.Vya=function(cb,Xb,kc,Wc,id){if(1===kc||!this.Ig.value.Vga(!0))return 32;id.MenuItems=Object.assign(new Ma.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});
Array.add(id.MenuItems.MenuSectionList,this.Bc(!this.isReactRibbonEnabled()));this.oh.CustomUrl&&Array.add(id.MenuItems.MenuSectionList,this.j7g(this.isReactRibbonEnabled()?this.oh.CustomUrl:na.a.af(this.oh.CustomUrl)));this.isReactRibbonEnabled()||(id.PopulationXML=La.q(id.MenuItems));return 32};ea.prototype.gab=function(cb,Xb,kc,Wc,id){if(1===kc||!id||!this.byb)return 32;this.oh=this.Ig.value.un;if(this.Ig.value.Vga(!0)&&(id[Y.visible]=!0,fb.a("MipLabelsAvailable"),this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",
!1)&&this.oh&&this.oh.AreLabelsAvailable&&(cb=qb.a.instance.Tb("Common.ISystemInitiatedFeedback")))){var Vc=ea.uh(this.oh.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";cb.execute(function(td){td.logActivity(Vc,null)})}return 32};ea.prototype.D6=function(cb,Xb,kc,Wc,id){if(1===kc||!id)return 32;var Vc,td;id[Y.m9f]=!!(Vc=id[Y.menuItemId])&&!!(td=this.Jjb[Vc])&&td===this.oh.AppliedPolicyId;return 32};ea.prototype.C6=function(cb,Xb,kc,Wc,id){if(1===
kc||!id)return 32;var Vc,td,rd;cb=!!(Vc=id[Y.TF])&&!!(td=this.Jjb[Vc])&&!!(rd=this.d9[td])&&rd.contains(this.oh.AppliedPolicyId);id[Y.dCh]=cb;id[Y.m9f]=cb;return 32};ea.prototype.setSensitivity=function(cb,Xb,kc,Wc,id){return 1!==kc&&id?this.pRa(this.Jjb[id[Y.TF]],id,2):32};ea.prototype.Rfc=function(){return!!Ka.AFrameworkApplication.ta&&1===Ka.AFrameworkApplication.ta.mode};ea.prototype.c7i=function(){this.VKc&&!this.Rfc()&&(this.VKc=!1,this.Ig.value.b7i())};ea.prototype.d$f=function(){this.oh.DefaultLabelId&&
this.oh.MandatoryLabelingEnforced?this.XGc||this.Rfc()?this.oh.AppliedPolicyId?this.f8c(""):(this.Ig.value.Bli(this.Ig.value.dBb)||this.Rfc())&&this.FKe():this.pYf():this.oh.DefaultLabelId?this.pYf():this.oh.MandatoryLabelingEnforced&&(this.oh.AppliedPolicyId?this.f8c(""):this.FKe())};ea.prototype.Tdf=function(){return this.oh.MandatoryLabelingEnforced?this.oh&&this.oh.AreLabelsAvailable?this.ib.ra("TestOverrideIsReactDialogEnabled")||this.Se&&this.Se.Pa&&this.Se.Pa.Wu?!0:(da.ULS.sendTraceTag(539109065,
306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(da.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(da.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)};ea.prototype.FKe=function(){var cb=this;!this.Tdf()||Ka.AFrameworkApplication.X4||this.Z$d||(this.Z$d=Ka.AFrameworkApplication.X4=!0,da.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),
this.Ig.value.eKf("",1),this.Ig.value.WTc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,function(){cb.kyi()}))};ea.prototype.f8c=function(cb){this.Tdf()&&Ka.AFrameworkApplication.X4&&(Ka.AFrameworkApplication.X4=!1,da.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Ig.value.UHd(),this.Ig.value.eKf(cb,2))};ea.prototype.kyi=function(){qa.instance.t7g(this.wRh(),
this.oh.CustomUrl,Object(xa.a)(this,this.lyi,"mandatoryLabellingDialogCallback"))};ea.prototype.lyi=function(cb){this.f8c(this.$$d[cb])};ea.prototype.yse=function(){return this.ib.ra("CoAuthForProtectedFilesEnabled")&&this.ib.ra("SupportsOfficeClientCoauthoring")&&this.ib.ra("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.y5d&&this.q6a};ea.prototype.pRa=function(cb,Xb,kc,Wc){var id=this;Wc=void 0===Wc?null:Wc;this.Ig.value.b4i(kc);var Vc=32,td=!1,rd=!0,za=2===kc||8===kc||16===kc,tb=cb===this.oh.AppliedPolicyId;
if(this.bFc&&this.bFc(cb,za))da.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",kc),this.Se.updateCommandUI();else if(Xb&&Y.SVc in Xb&&this.Ig.value.arj(Xb[Y.SVc]),cb)if(this.Ig.value.fgf()||this.yse()&&this.nLc)da.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",kc),this.Se.updateCommandUI(),za&&this.XZb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,
CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.ib.ra("HasDocumentEditRights"))if(this.Ig.value.rUg(cb))if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&!this.EMa()&&this.xu[cb]&&this.xu[cb].HasUserDefinedPermissions&&!tb)da.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",kc),1!==kc&&4!==kc&&this.xIg();else if(za&&this.oh.MandatoryLabelingEnforced&&tb)da.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",kc),this.XZb(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(za&&this.ib.ra("WacLabelingJustificationDialogIsEnabled")&&this.oh.RequiredDowngradeJustification&&(tb||this.xu[cb].RequiredDowngradeJustification)&&(this.EMa()?!this.z8d&&!Wc:!this.cWa))return da.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
kc),this.qRd(cb),Vc;if(this.EMa()&&this.xu[cb].HasUserDefinedPermissions&&!tb)return da.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",kc),this.ORd(cb,Wc),Vc;if(this.yse()&&!this.y5d())this.REc<this.Rkg?(da.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.REc,kc),this.nLc=!0,this.REc++,db.Task.delay(this.Skg).continueWith(function(){id.nLc=!1;id.pRa(cb,Xb,kc)})):(da.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",kc),td=1!==kc,rd=!1,Vc=8);else{if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacBlockParentLabelSetLabel",!1)&&this.kki(cb)&&(da.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",kc),1===kc||8===kc||4===kc))return Vc;da.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",
kc);this.setPolicyLabel(tb?"":cb,this.EMa()?Wc:this.cWa,"",kc);return Vc}}else da.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",kc),this.Se.updateCommandUI(),za&&this.XZb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else da.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",kc),
this.Se.updateCommandUI(),za&&this.XZb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else da.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",kc),this.Se.updateCommandUI(),td=za,rd=!1,Vc=8;this.Ig.value.EFd(0,kc,td,rd);return Vc};ea.prototype.XYa=function(cb,Xb,kc,Wc){kc=void 0===kc?null:kc;Wc=void 0===Wc?!1:Wc;mb.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",
0,"wordclpfc",null);this.ib.ra("SupportsOfficeClientCoauthoring")&&this.ib.ra("CoAuthForProtectedFilesIsEnabled")?(this.$ib=!1,(this.oh=this.Ig.value.un)&&!this.oh.AppliedPolicyId?this.$ib=!0:this.oh&&this.oh.PolicyLabelAssignmentMethod&&(this.$ib=Va.e(this.oh.PolicyLabelAssignmentMethod)===Va.e("standard"))):this.$ib=Wc;cb=ea.uh(cb)?null:this.xu[cb];(Xb=ea.uh(Xb)?null:this.xu[Xb])?this.Pfa=new Qa(Xb,!0,kc):(this.Ig.value.dda(29),this.Wea=null);cb?this.epa=new Qa(cb,!1):this.UUa=null;this.IEd(null,
null);return 32};ea.prototype.sKg=function(cb){""!==this.oh.AppliedPolicyId?this.Ig.value.EFd(4,16,!0):this.pRa(cb,null,16)};ea.prototype.eZf=function(){this.xu={};if(this.oh=this.Ig.value.un)for(var cb=ak(this.oh.SensitivityLabels),Xb=cb.next();!Xb.done;Xb=cb.next())Xb=Xb.value,this.xu[Xb.Id]=Xb};ea.prototype.kki=function(cb){if(this.d9&&cb in this.d9){cb=ak(this.d9[cb]);for(var Xb=cb.next();!Xb.done;Xb=cb.next())if((Xb=this.xu[Xb.value])&&Xb.Enabled)return!0}return!1};ea.prototype.MZf=function(){this.d9=
{};if(this.oh=this.Ig.value.un){for(var cb=ak(this.oh.SensitivityLabels),Xb=cb.next();!Xb.done;Xb=cb.next())Xb=Xb.value,Xb.ParentId||(this.d9[Xb.Id]=new ab.a);cb=ak(this.oh.SensitivityLabels);for(Xb=cb.next();!Xb.done;Xb=cb.next())Xb=Xb.value,Xb.ParentId&&Xb.ParentId in this.d9&&this.d9[Xb.ParentId].add(Xb.Id)}};ea.prototype.rJf=function(){if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.oh=this.Ig.value.un;var cb=this.byb&&this.isReactRibbonEnabled()&&
this.Ig.value.Vga();ea.bQa(cb)}else this.byb&&this.isReactRibbonEnabled()?(this.oh=this.Ig.value.un,this.Ig.value.Vga()?(ea.bQa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):ea.bQa(!1)):ea.bQa(!1)};ea.prototype.A7i=function(cb){this.bFc=cb};ea.prototype.q8i=function(cb){this.kLc=cb};ea.prototype.pYf=function(){this.ib.ra("WacApplyDefaultPolicyLabelIsEnabled")&&(this.Rfc()?this.VKc=!0:this.XGc||(this.XGc=!0,(this.oh=this.Ig.value.un)&&this.oh.DefaultLabelId&&
!this.oh.AppliedPolicyId&&(da.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.oh.DefaultLabelId),this.pRa(this.oh.DefaultLabelId,null,1))))};ea.prototype.IEd=function(){var cb=this;if(!this.Ig.value.fgf()){var Xb=this.xu[this.Ig.value.un.AppliedPolicyId];this.$ib&&this.epa&&this.UUa!==this.epa.id&&(!Xb||Xb.Order<this.epa.sensitivityLabel.Order)&&(Xb=this.pRa(this.epa.id,{},4),32!==Xb?da.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+
Xb):(this.UUa=this.epa.id,this.Wea&&(Xb=this.xu[this.Wea])&&Xb.Order<=this.epa.sensitivityLabel.Order&&(this.Ig.value.dda(29),this.Wea=null)));Xb=this.xu[this.Ig.value.un.AppliedPolicyId];if(this.Pfa&&this.Wea!==this.Pfa.id&&(!Xb||Xb.Order<this.Pfa.sensitivityLabel.Order)){var kc=this.Pfa.id;this.Ig.value.dda(29);this.Ig.value.vYb(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.$ed(this.Pfa.sensitivityLabel))+" "+this.Pfa.f6i,CommonUIStrings.l_PolicyLabelRecommendationButton,
function(){cb.pRa(kc,{},8)});this.Wea=this.Pfa.id}this.Pfa=this.epa=null}};ea.prototype.setPolicyLabel=function(cb,Xb,kc,Wc){Wc=void 0===Wc?2:Wc;this.EMa()?Xb&&(this.z8d=!0):this.cWa=Xb;this.Ig.value.setPolicyLabel(cb);this.Se.updateCommandUI();kc=new wa(Wc,this.$ed(this.xu[cb]));this.Ig.value.xOd(cb,this.EMa()?Xb:this.cWa,kc)};ea.prototype.q2g=function(cb,Xb,kc,Wc){1===cb&&this.setPolicyLabel(Xb,Wc,kc)};ea.prototype.p2g=function(cb,Xb,kc){1===cb?this.EMa()?this.pRa(Xb,null,2,kc):this.setPolicyLabel(Xb===
this.oh.AppliedPolicyId?"":Xb,kc,""):this.Se.updateCommandUI()};ea.prototype.qRd=function(cb){(new ha(cb,Object(xa.a)(this,this.p2g,"continueToSetPolicyLabelFromJustificationDialog"))).qRd()};ea.prototype.ORd=function(cb,Xb){(new ka(cb,Xb,Object(xa.a)(this,this.q2g,"continueToSetPolicyLabelFromUDPDialog"))).ORd()};ea.prototype.XZb=function(cb,Xb){cb=void 0===cb?"":cb;Xb=void 0===Xb?"":Xb;var kc=new gb.StandardDialog;kc.Qu=Ka.AFrameworkApplication.jyb;kc.Rb=0;kc.mc(1,CommonUIStrings.l_DialogClose);
kc.dX(cb,Xb,null)};ea.prototype.sOg=function(cb){1===cb&&this.Ig.value.f4i()};ea.prototype.xIg=function(){var cb=new gb.StandardDialog;cb.Qu=Ka.AFrameworkApplication.jyb;cb.Rb=1;cb.mc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);cb.mc(0,CommonUIStrings.l_DialogClose);cb.dX(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(xa.a)(this,this.sOg,"blockUDPSetLabelHandler"))};ea.prototype.isReactRibbonEnabled=function(){return!!this.Se&&
!!this.Se.Pa&&this.Se.Pa.yi};ea.prototype.vhc=function(){return this.Se&&this.Se.Pa?this.Se.Pa.vhc:!1};ea.prototype.kIe=function(){return 32};ea.prototype.fab=function(cb,Xb,kc,Wc,id){if(1===kc)return 32;this.oh=this.Ig.value.un;if(!this.oh||!id)return 32;id[Y.value]="";id[Y.ni]="";id[Y.alt]=null;id[Y.H8e]=null;id[Y.f5a]=null;id[Y.customTooltip]="";id[Y.visible]=!1;id[Y.iconColor]="";kc=Xb=cb=id[Y.icon]="";if(!this.oh.AreLabelsAvailable){if(!this.ELc)return 32;cb=this.ELc;kc=Y.eWd;this.DLc&&(Xb=this.DLc)}else if(this.oh.AppliedPolicyId){Wc=
null;for(var Vc=ak(this.oh.SensitivityLabels),td=Vc.next();!td.done;td=Vc.next())if(td=td.value,td.Id.toLowerCase()===this.oh.AppliedPolicyId.toLowerCase()){Wc=td;break}Wc&&(cb=this.$ed(Wc),Xb=Wc.Tooltip,this.IOc=Ka.AFrameworkApplication.protectedFile=Wc.IsEndpointProtectionEnabled,kc=this.TWe(Wc))}this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(cb?(id[Y.value]=cb,id[Y.ni]=cb,id[Y.customTooltip]=Xb,this.oZf(kc,this.IOc,id)):this.ib.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?
(id[Y.iconColor]=Y.eWd,this.oh.MandatoryLabelingEnforced?(id[Y.value]=id[Y.ni]=HeaderStrings.SelectASensitivityLabel,id[Y.icon]=Y.t5i):(id[Y.value]=id[Y.ni]=HeaderStrings.NoSensitivityLabel,id[Y.icon]=Y.w5i)):(id[Y.iconColor]="#000000",this.oh.MandatoryLabelingEnforced?(id[Y.value]=id[Y.ni]=HeaderStrings.SelectASensitivityLabel,id[Y.icon]="MipTagErrorDynamicColor_20"):(id[Y.value]=id[Y.ni]=HeaderStrings.NoSensitivityLabel,id[Y.icon]="MipTagQuestionDynamicColor_20")),id[Y.visible]=!0):cb&&(id[Y.value]=
cb,id[Y.ni]=cb,this.vhc()?id[Y.customTooltip]=Xb:id[Y.alt]=Xb,this.oZf(kc,this.IOc,id),id[Y.visible]=!0);return 32};ea.prototype.$ed=function(cb){return cb?this.xu?cb.ParentId&&this.xu[cb.ParentId]?this.xu[cb.ParentId].DisplayName+"\\"+cb.DisplayName:cb.DisplayName:(da.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),cb.DisplayName):""};ea.prototype.oZf=function(cb,Xb,kc){this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",
!1)?(kc[Y.icon]=this.n2e(Xb),kc[Y.iconColor]=this.o2e(cb)):this.vhc()?kc[Y.icon]=Xb?Y.fFj:Y.hFj:(kc[Y.H8e]=Ka.AFrameworkApplication.JC,kc[Y.f5a]=Xb?la.getImageClass(Y.gFj):la.getImageClass(Y.iFj))};ea.prototype.j7g=function(cb){var Xb=this.lU("LearnMoreSection",!0);cb=Object.assign(new W.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:cb,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:Ka.AFrameworkApplication.JC,Image16by16Class:la.getImageClass(Y.xri),
Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Xb.ControlList,cb);return Xb};ea.prototype.sEe=function(cb,Xb,kc){kc=void 0===kc?!1:kc;var Wc="Toggle_"+cb.Id;Wc="Sensitivity_"+Wc;var id=cb.DisplayName,Vc=cb.Tooltip,td=cb.Id===this.oh.AppliedPolicyId,rd=kc?na.a.af(Wc):Wc;this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(td=this.TWe(cb),Xb=Object.assign(new Ub.a,{Id:rd,ExternalId:rd,LabelText:kc?na.a.af(id):id,Command:"2935633379",MenuItemId:rd,
QueryCommand:"991261903",Visible:!0,Alt:kc?na.a.af(Vc):Vc,AriaLabel:Db.a.H_b,IconColor:this.o2e(td),KeyTip:Xb}),Xb.ExternalImageId=this.n2e(cb.IsEndpointProtectionEnabled)):(rd=Object.assign(new va.a,{Id:rd,ExternalId:rd,LabelText:kc?na.a.af(id):id,Command:"2935633379",MenuItemId:rd,QueryCommand:"991261903",CheckedImage:Ka.AFrameworkApplication.JC,Visible:!0,Alt:kc?na.a.af(Vc):Vc,IsChecked:td,AriaLabel:Db.a.H_b,KeyTip:Xb}),this.isReactRibbonEnabled()?(rd.CheckedImageClass=la.getImageClass(Y.QFd),
rd.ExternalImageId=Y.QFd):rd.CheckedImageClass=la.getImageClass(Y.Hpb),Xb=rd);rd=Wc;this.Jjb[rd]=cb.Id;this.Tce[cb.Id]=rd;return Xb};ea.prototype.lU=function(cb,Xb){Xb=void 0===Xb?!1:Xb;return Object.assign(new Hb.a,{Title:"",Id:cb,DisplayMode:Y.menu,ShowMenuSectionSeparator:Xb,ControlsId:"Ctrl_"+cb,ControlList:[]})};ea.prototype.i$g=function(cb,Xb,kc){cb=this.lU(cb+"Sub");var Wc=1;Xb=ak(Xb);for(var id=Xb.next();!id.done;id=Xb.next())(id=this.xu[id.value])&&id.Enabled&&(Array.add(cb.ControlList,this.sEe(id,
Wc.toString(),kc)),Wc++);return cb};ea.prototype.Bc=function(cb){cb=void 0===cb?!1:cb;var Xb=this.lU("SensitivitySection"),kc=1,Wc=this.d9,id;for(id in Wc){var Vc=Wc[id],td=this.xu[id];if(td&&td.Enabled){if(Vc.count){var rd="Sensitivity_"+td.Name,za=cb?na.a.af(rd):rd;za=Object.assign(new Ia.a,{Id:za,ExternalId:za,LabelText:cb?na.a.af(td.DisplayName):td.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new Ma.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,
Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:Db.a.H_b,KeyTip:kc.toString()});this.isReactRibbonEnabled()?za.ExternalImageId=Y.QFd:(za.Image16by16=Ka.AFrameworkApplication.JC,za.Image16by16Class=la.getImageClass(Y.Hpb));Array.add(za.Menu.MenuSectionList,this.i$g(rd,Vc,cb));Array.add(Xb.ControlList,za);this.Jjb[za.Id]=td.Id;this.Tce[td.Id]=za.Id}else Array.add(Xb.ControlList,this.sEe(td,kc.toString(),cb));kc++}}return Xb};ea.prototype.gmb=function(cb){return!!this.La.a4(cb)&&!!this.La.a4(cb).flags&&
!!this.La.a4(cb).flags.length};ea.prototype.BTi=function(cb,Xb){Xb.onSuccess&&this.xu&&(cb=this.xu[this.Ig.value.un.AppliedPolicyId])&&(this.Wea&&(Xb=this.xu[this.Wea])&&Xb.Order<=cb.Order&&(this.Ig.value.dda(29),this.Wea=null),this.UUa&&this.UUa!==cb.Id&&(this.Ig.value.dda(28),this.UUa=null))};ea.prototype.n2e=function(cb){return cb?Y.v5i:Y.u5i};ea.prototype.o2e=function(cb){return cb?cb:Y.eWd};ea.prototype.TWe=function(cb){if(cb.Color||!cb.ParentId)return cb.Color;var Xb=this.xu[cb.ParentId];return Xb?
Xb.Color:cb.Color};ea.bQa=function(cb){Ka.AFrameworkApplication.fa&&Ka.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(cb?(yb.a.Hxd("ribbon","sensitivity"),yb.a.Cxd("ribbon","sensitivity")):yb.a.Gxd("ribbon","sensitivity"));Ka.AFrameworkApplication.fa&&Ka.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Kb.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",
!cb))};ea.uh=function(cb){return cb&&cb.length?!1:!0};Af.Object.defineProperties(ea.prototype,{q6a:{configurable:!0,enumerable:!0,get:function(){return Ka.AFrameworkApplication.q6a||!!this.kLc&&this.kLc()}}});Object(S.a)(ea,"PolicyActor",null,[658]);var wc=b(737),nb=b(616),zb=b(97),ma;(function(cb){cb[cb.unknown=0]="unknown";cb[cb.boot=1]="boot";cb[cb.refresh=2]="refresh";cb[cb.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(ma||(ma={}));Object(S.b)("GetPolicyLabelsReason",ma);var P=Sys.EventArgs;Rk(Z,
P);Object(S.a)(Z,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var oa=Sys.EventArgs;Rk(X,oa);Object(S.a)(X,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Ja;(function(cb){cb[cb.none=0]="none";cb[cb.reasonDefaultLabel=1]="reasonDefaultLabel";cb[cb.reasonManual=2]="reasonManual";cb[cb.reasonAutomatic=4]="reasonAutomatic";cb[cb.reasonRecommended=8]="reasonRecommended";cb[cb.reasonMandatory=16]="reasonMandatory"})(Ja||(Ja={}));Object(S.b)("ApplyLabelFlags",Ja);var $a=
Sys.EventArgs;Rk(ca,$a);Object(S.a)(ca,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);var Ta=Sys.EventArgs;Rk(Q,Ta);Object(S.a)(Q,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);var pa=Sys.EventArgs;Rk(H,pa);Object(S.a)(H,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);Object(S.a)(N,"GetPolicyLabelsData",null,[]);var Da=Sys.EventArgs;Rk(O,Da);Object(S.a)(O,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);var rb=Sys.EventArgs;Rk(J,rb);Object(S.a)(J,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,
[]);var Ab=Sys.EventArgs;Rk(K,Ab);Object(S.a)(K,"PolicyTipEventArgs",Sys.EventArgs,[]);var ob=Sys.EventArgs;Rk(F,ob);Object(S.a)(F,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var sb=Sys.EventArgs;Rk(T,sb);Object(S.a)(T,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Pb=Sys.EventArgs;Rk(M,Pb);Object(S.a)(M,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);var Aa=Sys.EventArgs;Rk(U,Aa);Object(S.a)(U,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var Ya=Sys.EventArgs;
Rk(I,Ya);Object(S.a)(I,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);var kb=Sys.EventArgs;Rk(E,kb);Object(S.a)(E,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var lb=b(108),ac=b(104),Dc=b(41),Zb=b(81),mc=b(39);Object(S.a)(G,"ClientRequest",null,[]);var Lb=b(496),Sa=b(279);C.Hpj=function(cb,Xb){if(!cb||!Xb||cb.count!==Xb.count)return!1;cb=ak(cb);for(var kc=cb.next();!kc.done;kc=cb.next())if(!Xb.contains(kc.value))return!1;return!0};C.toArray=function(cb){if(!cb)return null;var Xb=Array(cb.count),
kc=0;cb=ak(cb);for(var Wc=cb.next();!Wc.done;Wc=cb.next())Xb[kc]=Wc.value,kc++;return Xb};Object(S.a)(C,"HashSetUtils",null,[]);var Cb=b(294),ec=b(80),wb=b(190);x.prototype.lne=function(cb){this.$a.addHandler("PolicyTipEvent",cb)};x.prototype.hZb=function(cb){this.$a.addHandler("LabelInfoUpdateEvent",cb)};x.prototype.wbj=function(cb){this.$a.removeHandler("LabelInfoUpdateEvent",cb)};x.prototype.Bne=function(cb){this.$a.addHandler("SetPolicyLabelEventKey",cb)};x.prototype.Kcj=function(cb){this.$a.removeHandler("SetPolicyLabelEventKey",
cb)};x.prototype.$Uc=function(cb){this.$a.addHandler("SetPolicyLabelFailureEventKey",cb)};x.prototype.Jcj=function(cb){this.$a.removeHandler("SetPolicyLabelFailureEventKey",cb)};x.prototype.QEg=function(cb){this.$a.addHandler("GetPolicyLabelEventKey",cb)};x.prototype.PEg=function(cb){this.$a.addHandler("GetPolicyLabelFailureEventKey",cb)};x.prototype.NEg=function(cb){this.$a.addHandler("GetAutoPolicyLabelEventKey",cb);this.Zld&&(da.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),
this.uFd(new Q(0)))};x.prototype.cbj=function(cb){this.$a.removeHandler("GetAutoPolicyLabelEventKey",cb)};x.prototype.lEg=function(cb){this.$a.addHandler("CreateAutoCLPSecurityNodesEventKey",cb)};x.prototype.Gaj=function(cb){this.$a.removeHandler("CreateAutoCLPSecurityNodesEventKey",cb)};x.prototype.eHg=function(cb){this.$a.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",cb)};x.prototype.Ycj=function(cb){this.$a.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",cb)};x.prototype.fHg=function(cb){this.$a.addHandler("UpdateAutoCLPSITNodesEventKey",
cb)};x.prototype.Zcj=function(cb){this.$a.removeHandler("UpdateAutoCLPSITNodesEventKey",cb)};x.prototype.Wle=function(cb){this.$a.addHandler("AddAutoPolicyBusinessBarEntryEventKey",cb)};x.prototype.$$i=function(cb){this.$a.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",cb)};x.prototype.qne=function(cb){this.$a.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",cb)};x.prototype.scj=function(cb){this.$a.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",cb)};x.prototype.Xle=function(cb){this.$a.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",
cb)};x.prototype.baj=function(cb){this.$a.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",cb)};x.prototype.rne=function(cb){this.$a.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",cb)};x.prototype.tcj=function(cb){this.$a.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",cb)};x.prototype.xFg=function(cb){this.$a.addHandler("MandatoryLabellingAppHandlerEventKey",cb)};x.prototype.Hbj=function(cb){this.$a.removeHandler("MandatoryLabellingAppHandlerEventKey",
cb)};x.prototype.bHg=function(cb){this.$a.addHandler("UDPLabelingAppHandlerEventKey",cb)};x.prototype.Wcj=function(cb){this.$a.removeHandler("UDPLabelingAppHandlerEventKey",cb)};x.prototype.NWg=function(){return Ka.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsClpBlockedByAppSpecificScenarioEnabled",!1)?this.Z7d?this.Z7d():!1:!1};x.prototype.w7i=function(cb){this.LEc=cb};x.prototype.ew=function(){return(new Date).getTime()};x.prototype.Cac=function(){this.qh&&(this.XUb=
this.qh.sc("WebServiceCall","Call Get Policy Endpoint On Server"));var cb=Cb.a.Wha(1,1);this.ib.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(cb=new G(this.T3a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,cb),this.Pg.send(cb).ZGd(Object(xa.a)(this,this.mvf,"onDataLossPolicySuccessCallback"),Object(xa.a)(this,this.lvf,"onDataLossPolicyFailureCallback"))):this.Pg.Yl(this.T3a("datalosspolicy"),1,null,null,!0,2,Object(xa.a)(this,
this.mvf,"onDataLossPolicySuccessCallback"),Object(xa.a)(this,this.lvf,"onDataLossPolicyFailureCallback"),null);this.tib++;da.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.Sce,this.tib)};x.prototype.b7i=function(){this.$cd(this.j8,2,this.bpa)};x.prototype.$cd=function(cb,Xb,kc,Wc){Xb=void 0===Xb?0:Xb;kc=void 0===kc?null:kc;Wc=void 0===Wc?!1:Wc;mb.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.kdd(void 0,
Xb));this.Dvb=this.ew();var id=this.e3c(Xb);this.Bac(cb,id,kc,Wc,Xb);this.yJd(!0)};x.prototype.mvf=function(cb){this.lGf();var Xb=this.DWd(cb);cb=Xb.data;Xb.returnValue&&(da.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.tib=0,this.qh&&(this.YUb=this.qh.sc("Task","Parse and Handle Get Policy Response")),this.AWi(cb),this.YUb&&(this.YUb.stop(),this.YUb=null))};x.prototype.lvf=function(cb){this.lGf();this.tib<=this.$Tb?this.Cac():(da.ULS.sendTraceTag(25565154,
306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",cb?cb.data?cb.data.mQa:null:null),this.tib=0)};x.prototype.fgf=function(){return 0<this.dra};x.prototype.setPolicyLabel=function(cb){this.un.AppliedPolicyId=cb};x.prototype.xOd=function(cb,Xb,kc){kc=void 0===kc?null:kc;var Wc=this.O6g(kc);this.Mrj(cb,Xb,Wc,kc)};x.prototype.VBf=function(cb){this.HEa&&(this.HEa.stop(),this.HEa=null);var Xb=this.v1e(cb);var kc=Xb.sWf;Xb=Xb.SZf;var Wc=cb.data.state,id=Wc?Wc.uP:2,Vc=this.DWd(cb);
cb=Vc.data;Vc.returnValue?(da.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",id),this.dra=0,this.TWi(cb,kc,Xb,Wc)):this.$Kd(id)};x.prototype.b4i=function(cb){mb.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.kdd(cb));this.zKb=this.ew();da.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.$a.raiseEvent("SetPolicyLabelTriggeredEventKey",new I(cb))};x.prototype.UDi=function(){this.xfc&&this.supportsOfficeClientCoauthoring&&
this.Oli&&this.CEa.Bda(12,null,!0)};x.prototype.UBf=function(cb){this.HEa&&(this.HEa.stop(),this.HEa=null);var Xb=this.v1e(cb);var kc=Xb.sWf;Xb=Xb.SZf;this.dra<=this.$Tb?this.xOd(kc,Xb):(kc=(kc=cb.data.state)?kc.uP:2,da.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",cb?cb.data?cb.data.mQa:null:null,kc),this.dBb="WACServerConnectionFailed",this.dra=0,this.$Kd(kc))};x.prototype.Bli=function(cb){if(cb&&("LabelNotSupported"===cb||"LabelErrorRetryLater"===
cb||"CoherencyFailure"===cb||"LabelIdNotFound"===cb||"LabelDisabled"===cb))return da.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",cb),!0;da.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",cb);return!1};x.prototype.rUg=function(cb){if(!cb)return!1;for(var Xb=null,kc=null,Wc=ak(this.un.SensitivityLabels),id=Wc.next();!id.done;id=Wc.next())id=id.value,id.Id===cb&&(Xb=id),id.Id===this.j8&&(kc=id);if(!Xb)return!1;if(this.xfc&&this.supportsOfficeClientCoauthoring){if(this.LEc&&
this.LEc()||this.knd)return!0}else if(Ka.AFrameworkApplication.Uy&&Ka.AFrameworkApplication.Uy.tub||this.bpa&&this.bpa())return!0;return Xb.IsEndpointProtectionEnabled===(!!kc&&kc.IsEndpointProtectionEnabled)};x.prototype.vYb=function(cb,Xb,kc,Wc,id){28===cb?this.OJf(new Z(cb,Xb,kc,Wc,id,!1)):this.OJf(new Z(cb,Xb,kc,Wc,id,!0))};x.prototype.dda=function(cb){28===cb?this.pKf(new F(cb,!1)):this.pKf(new F(cb,!0))};x.prototype.i3i=function(cb,Xb,kc){da.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");
this.$a.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new ca(cb,Xb,kc))};x.prototype.g4i=function(cb){da.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.$a.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ca(null,null,cb))};x.prototype.h4i=function(cb,Xb){da.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.$a.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ca(cb,Xb,null))};x.prototype.eKf=function(cb,Xb){da.ULS.sendTraceTag(572650527,
306,50,"Raising a mandatory labelling"+(1===Xb?"Reading":"Edit")+" switch event.");this.$a.raiseEvent("MandatoryLabellingAppHandlerEventKey",new J(cb,Xb))};x.prototype.WTc=function(cb,Xb,kc,Wc,id){37===cb&&this.Y2i(new X(37,Xb,kc,Wc,id))};x.prototype.UHd=function(){this.V3i(new T)};x.prototype.f4i=function(){da.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.$a.raiseEvent("UDPLabelingAppHandlerEventKey",new E(!0))};x.prototype.Vga=function(cb){cb=void 0===cb?!1:cb;var Xb=!!this.un&&
this.un.AreLabelsAvailable&&!!this.un.SensitivityLabels&&0<this.un.SensitivityLabels.length&&Sa.a.any(this.un.SensitivityLabels,function(kc){return!!kc&&kc.Enabled});Xb||cb||ea.bQa(!1);return Xb};x.prototype.exf=function(cb){this.qDa&&(this.qDa.stop(),this.qDa=null);this.yJd(!1);var Xb=this.DWd(cb);var kc=Xb.data;Xb.returnValue?(da.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.rib=0,kc=this.JWi(kc),cb=this.m0e(cb.data),mb.Health.instance.recordKpiSuccess("MipGetPolicyLabel",
this.H$b(void 0,cb,this.Dvb)),this.Dvb=null,cb=new Q(cb),this.w3i(cb),this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?kc&&this.Jvj()?this.Zld?this.ZPj():(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.Oqb(),this.uFd(cb),this.fKc=!0):kc||this.Mqc():!this.Zld&&kc&&this.ib.ra("WacApplyManualPolicyLabelIsEnabled")&&this.Uqe()?(this.uFd(cb),this.fKc=!0):kc||this.Mqc()):this.Mqc()};x.prototype.Jvj=function(){if(!this.ib.ra("WacApplyManualPolicyLabelIsEnabled"))return da.ULS.sendTraceTag(539877667,
306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.Uqe())return!1;if(""===this.j8)return da.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.mCa===this.tJc)return da.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;da.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");
return!0};x.prototype.Oqb=function(){this.Fbg();da.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.FEa.count,this.mCa);var cb=C.toArray(this.FEa);this.i3i(cb,cb,this.mCa)};x.prototype.ZPj=function(){var cb=this.FEa;this.Fbg();C.Hpj(cb,this.FEa)||(da.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.FEa.count),cb=C.toArray(this.FEa),this.h4i(cb,cb));this.B8d&&(da.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",
this.mCa),this.g4i(this.mCa))};x.prototype.Fbg=function(){for(var cb=new wc.a(nb.a.Jk()),Xb=ak(this.un.SensitivityLabels),kc=Xb.next();!kc.done;kc=Xb.next())if((kc=kc.value)&&kc.AutoLabelingSensitiveTypeIds&&0<kc.AutoLabelingSensitiveTypeIds.length){kc=ak(kc.AutoLabelingSensitiveTypeIds);for(var Wc=kc.next();!Wc.done;Wc=kc.next())(Wc=Wc.value)&&cb.add(Wc)}this.FEa=cb};x.prototype.dxf=function(cb){var Xb=this.m0e(cb.data);mb.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",
!1,!1,this.H$b(void 0,Xb,this.Dvb));this.Dvb=null;this.qDa&&(this.qDa.stop(),this.qDa=null);if(this.rib<=this.$Tb){if(this.ib.ra("SendHostAttributionInfoForPolicyLabelEnabled")){var kc=cb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in kc&&kc[Cb.a.SLd]&&"HostAttributionInfo.ScenarioTypeParamName"in kc&&kc[Cb.a.TLd]){cb.data.request.get_headers();cb.data.request.get_headers();cb=this.e3c(Xb);this.Bac(this.j8,cb,this.bpa,void 0,Xb);return}}this.$cd(this.j8,Xb,this.bpa)}else da.ULS.sendTraceTag(34996494,
306,15,"Request to get label policy failed with error response: {0}.",cb?cb.data?cb.data.mQa:null:null),this.Mqc(),this.rib=0,this.yJd(!1)};x.prototype.m0e=function(cb){return cb.state?cb.state:0};x.prototype.T3a=function(cb,Xb){Xb=void 0===Xb?!1:Xb;var kc=String.format("{0}{1}?action={2}&{3}",this.ib.Wa("PolicyHandlerWebServiceBase")||Ka.AFrameworkApplication.ta.Pa.QV,this.Sce,cb,Ka.AFrameworkApplication.aj);"setpolicylabel"===cb&&Ka.AFrameworkApplication.Uy&&Ka.AFrameworkApplication.Uy.tcf&&(kc=
Zb.a.vl(kc,"sl","1"));Xb&&(kc=Zb.a.vl(kc,"cbd","1"));return kc};x.prototype.v1e=function(cb){var Xb;var kc=Xb=null;cb&&cb.data&&cb.data.request&&cb.data.request.get_headers()&&(kc=cb.data.request.get_headers()[Lb.a.tWf],Xb=cb.data.request.get_headers()[Lb.a.TZf]);return{sWf:kc,SZf:Xb}};x.prototype.DWd=function(cb){cb=cb?cb.data?cb.data.Ud:null:null;return cb&&cb.length&&!this.omi(cb)?{returnValue:!0,data:cb}:(da.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,
data:cb})};x.prototype.AWi=function(cb){try{var Xb=Dc.b(cb)}catch(kc){da.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Xb)if(Xb.IsPolicyTipAvailable)switch(Xb.IsPolicyTipAvailable.toLowerCase()){case "false":da.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":da.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.TGc=Xb.NavigateUrl;this.GAj(Xb.GeneralText,
Object(xa.a)(this,this.MIi,"onDataLossPolicyOverrideButtonClick"));break;default:da.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Xb.IsPolicyTipAvailable)}else da.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else da.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")};x.prototype.TWi=function(cb,Xb,
kc,Wc){var id=this,Vc=Wc?Wc.uP:2,td=0,rd="",za;if(function(){var Wb=Dc.d(cb);za=Wb.Pt;return Wb}().returnValue)if(za){rd="Success";var tb=this.e3c(3);if(za.IsSuccessful){mb.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.H$b(Vc,void 0,this.zKb));this.dBb=this.zKb=null;da.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",Vc);2===Vc&&this.dda(29);this.Jsj(Xb,Vc);this.UDi();this.dda(28);Wc&&4===Vc&&
this.vYb(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,Wc.displayName),CommonUIStrings.l_DialogOk,function(){});fb.a("MipAppliedLabels",void 0,void 0,[Object.assign(new ec.a,{name:"SetPolicyLabelApplyFlag",string:Ja[Vc]})]);this.Bac(Xb,tb,this.bpa,void 0,3);return}da.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
Vc,za.FailureReason);this.dBb=za.FailureReason;"FileTooLarge"===za.FailureReason?td=1:"LabelNotSupported"===za.FailureReason?td=2:"LabelDisabled"===za.FailureReason?td=3:"MinorVersionLimitExceeded"===za.FailureReason&&(td=5);this.rmi&&0<=za.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Wc=new lb.a(2,1,this.Nrj,function(){da.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",id.dra);id.dra<=id.$Tb&&id.xOd(Xb,
kc)}),this.de.Eg(Wc));this.xfc&&this.supportsOfficeClientCoauthoring&&this.Bac(this.un.AppliedPolicyId,tb,this.bpa,!0,3)}else rd="setPolicyLabelData null.",da.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",Vc);else rd="TryDeserialize failed.",da.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",Vc);this.$Kd(Vc,td);Vc=this.H$b(Vc,void 0,this.zKb);this.zKb=
null;Vc.extendedProperties.set("SetPolicyLabelDataFailureReason",this.dBb);Vc.extendedProperties.set("SetPolicyLabelDataParseStatus",rd.toString());mb.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,Vc)};x.prototype.$Kd=function(cb,Xb){Xb=void 0===Xb?0:Xb;this.setPolicyLabel(this.j8);this.cKf(new O);this.EFd(Xb,cb,2===cb||8===cb||16===cb,!1)};x.prototype.Jsj=function(cb,Xb){this.setPolicyLabel(this.j8=cb);if(""===cb)Ka.AFrameworkApplication.protectedFile=!1,Ka.AFrameworkApplication.enableMacrosForProtectedFile=
!1;else for(var kc=ak(this.un.SensitivityLabels),Wc=kc.next();!Wc.done;Wc=kc.next())if(Wc=Wc.value,Wc.Id===cb){Ka.AFrameworkApplication.protectedFile=Wc.IsEndpointProtectionEnabled;break}this.a4i(new M(cb,Xb))};x.prototype.SRj=function(){for(var cb=ak(this.un.SensitivityLabels),Xb=cb.next();!Xb.done;Xb=cb.next())(Xb=Xb.value)&&Xb.Enabled&&(Xb.Id===this.j8&&(this.B8d=this.mCa!==Xb.Order,this.mCa=Xb.Order),Xb.Order>this.tJc&&(this.tJc=Xb.Order))};x.prototype.JWi=function(cb){var Xb=Dc.d(cb);cb=Xb.Pt;
if(!Xb.returnValue)return da.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!cb)return da.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!cb.AreLabelsAvailable)return!1;this.un=cb;this.j8=cb.AppliedPolicyId;this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.SRj();this.Vga()&&da.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");
this.cKf(new O(!0));return!0};x.prototype.Uqe=function(){if(!this.Vga())return da.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(var cb=ak(this.un.SensitivityLabels),Xb=cb.next();!Xb.done;Xb=cb.next())if((Xb=Xb.value)&&Xb.AutoLabelingSensitiveTypeIds&&0<Xb.AutoLabelingSensitiveTypeIds.length)return!0;da.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1};
x.prototype.cKf=function(cb){da.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.$a.raiseEvent("LabelInfoUpdateEvent",cb)};x.prototype.w3i=function(cb){da.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.$a.raiseEvent("GetPolicyLabelEventKey",cb)};x.prototype.Mqc=function(){ea.bQa(!1);this.$a.raiseEvent("GetPolicyLabelFailureEventKey",new H)};x.prototype.uFd=function(cb){var Xb=this;this.WO&&this.WO.execute(function(kc){kc=[kc.isFeatureEnabled("MsoClpSpTwo",
!0),kc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(kc).then(function(Wc){Sa.a.any(Wc,function(id){return id})&&(da.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),Xb.$a.raiseEvent("GetAutoPolicyLabelEventKey",cb),Xb.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&Xb.Oqb(),fb.a("MipAutoClassificationEnabled"));return null})})};x.prototype.kdd=function(cb,Xb){cb=void 0===cb?null:cb;Xb=void 0===Xb?null:Xb;var kc=new Map;
kc.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=cb&&kc.set("ApplyLabelFlags",Ja[cb]);null!=Xb&&kc.set("GetPolicyLabelsReason",ma[Xb]);return kc};x.prototype.H$b=function(cb,Xb,kc){cb=void 0===cb?null:cb;Xb=void 0===Xb?null:Xb;kc=void 0===kc?null:kc;var Wc=new wb.a;Wc.extendedProperties=this.kdd(cb,Xb);null!=kc&&(Wc.durationMs=this.ew()-kc);return Wc};x.prototype.a4i=function(cb){da.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.$a.raiseEvent("SetPolicyLabelEventKey",
cb)};x.prototype.OJf=function(cb){da.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");cb&&cb.Azb&&fb.a("MipRecommendations");this.$a.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",cb)};x.prototype.pKf=function(cb){da.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.$a.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",cb)};x.prototype.Y2i=function(cb){da.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");
this.$a.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",cb)};x.prototype.V3i=function(cb){da.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.$a.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",cb)};x.prototype.GAj=function(cb,Xb){Xb=void 0===Xb?null:Xb;da.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.$a.raiseEvent("PolicyTipEvent",new K(CommonUIStrings.l_PolicyBusinessBarTitle,cb,CommonUIStrings.l_PolicyOverrideButton,
Xb))};x.prototype.EFd=function(cb,Xb,kc,Wc){var id=this;da.ULS.sendTraceTag(42074656,306,void 0===Wc||Wc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Xb);if(this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)){Wc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var Vc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,td=null,rd=null;switch(cb){case 1:Wc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;
Vc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 2:Wc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;Vc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 3:Wc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;Vc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 4:Wc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;
Vc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 5:Wc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,Vc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,td=CommonUIStrings.l_LearnMore,rd=function(){id.UZf()}}cb=new U(cb,Xb,kc,Wc,Vc,td,rd)}else cb=5===cb?new U(cb,Xb,kc,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,
CommonUIStrings.l_LearnMore,function(){id.UZf()}):new U(cb,Xb,kc);this.$a.raiseEvent("SetPolicyLabelFailureEventKey",cb)};x.prototype.arj=function(cb){this.qMc=cb};x.prototype.MIi=function(){this.TGc?(da.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),mc.a.UU(this.TGc)):da.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")};x.prototype.omi=function(cb){if(!cb.startsWith("<")||-1===cb.indexOf("Error")&&-1===cb.indexOf("Unavailable"))return!1;
da.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0};x.prototype.lGf=function(){this.XUb&&(this.XUb.stop(),this.XUb=null)};x.prototype.ZGh=function(cb){if(!cb)return"manual";switch(cb.uP){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}};
x.prototype.lIh=function(cb){if(!cb)return"privileged";cb=cb.uP;var Xb="privileged";if(4===cb||1===cb)Xb="standard";return Xb};x.prototype.Bac=function(cb,Xb,kc,Wc,id){kc=void 0===kc?null:kc;Wc=void 0===Wc?!1:Wc;id=void 0===id?0:id;this.ib.ra("WacLabelingGetPolicyLabelsIsEnabled")&&(this.j8=cb,this.bpa=kc,this.qh&&(this.qDa=this.qh.sc("WebServiceCall","Call Get Policy Endpoint On Server")),kc={},kc[Lb.a.gKg]=cb,this.ib.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(cb=new G(this.T3a("getpolicylabels",
Wc),1,null,kc,!0,2,id,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Xb),this.Pg.send(cb).ZGd(Object(xa.a)(this,this.exf,"onGetPolicyLabelsSuccessCallback"),Object(xa.a)(this,this.dxf,"onGetPolicyLabelsFailureCallback"))):this.Pg.Yl(this.T3a("getpolicylabels",Wc),1,null,kc,!0,2,Object(xa.a)(this,this.exf,"onGetPolicyLabelsSuccessCallback"),Object(xa.a)(this,this.dxf,"onGetPolicyLabelsFailureCallback"),id,void 0,void 0,void 0,void 0,"22"),this.rib++,da.ULS.sendTraceTag(34996492,
306,50,"Policy label request sent to server. Policy call times: {0}",this.rib))};x.prototype.Mrj=function(cb,Xb,kc,Wc){Wc=void 0===Wc?null:Wc;if(this.byb){this.qh&&(this.HEa=this.qh.sc("WebServiceCall","Call Set Policy Endpoint On Server"));var id={};id[Lb.a.tWf]=cb;Xb&&(id[Lb.a.TZf]=encodeURIComponent(Xb));this.qMc&&(id[Lb.a.yJg]=this.qMc);Wc?(id[Lb.a.QZf]=this.ZGh(Wc),id[Lb.a.RZf]=this.lIh(Wc)):(id[Lb.a.QZf]="manual",id[Lb.a.RZf]="privileged");this.supportsOfficeClientCoauthoring&&this.un&&(id[Lb.a.CYi]=
this.un.PolicyLabelVersionToken);this.ib.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(cb=new G(this.T3a("setpolicylabel",!0),1,null,id,!0,2,Wc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,kc),this.Pg.send(cb).ZGd(Object(xa.a)(this,this.VBf,"onSetPolicyLabelSuccessCallback"),Object(xa.a)(this,this.UBf,"onSetPolicyLabelFailureCallback"))):this.Pg.Yl(this.T3a("setpolicylabel",!0),1,null,id,!0,2,Object(xa.a)(this,this.VBf,"onSetPolicyLabelSuccessCallback"),
Object(xa.a)(this,this.UBf,"onSetPolicyLabelFailureCallback"),Wc,void 0,void 0,void 0,void 0,"32");this.dra++;da.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.dra)}else da.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")};x.prototype.UZf=function(){var cb=new gb.StandardDialog,Xb=this.ib.Wa("BreadcrumbFolderUrl");Xb?(cb.Rb=11,cb.mc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),
cb.mc(2,CommonUIStrings.l_DialogOk)):(cb.Rb=0,cb.mc(1,CommonUIStrings.l_DialogOk));cb.Pke(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");cb.j$i();cb.dX(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,function(kc){1===kc&&Xb&&mc.a.Ze(Xb,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})};
x.prototype.e3c=function(cb){switch(cb){case 1:return Cb.a.Wha(1,1);case 2:return Cb.a.Wha(7,1);case 3:return Cb.a.Wha(8,1);default:return Cb.a.Wha(7,0)}};x.prototype.O6g=function(cb){cb=void 0===cb?null:cb;if(!cb)return Cb.a.Wha(8,0);switch(cb.uP){case 1:case 16:return Cb.a.Wha(1,1);case 4:case 2:case 8:return Cb.a.Wha(8,1);default:return Cb.a.Wha(8,0)}};x.prototype.yJd=function(cb){this.ib.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",
cb)};Af.Object.defineProperties(x.prototype,{Zld:{configurable:!0,enumerable:!0,get:function(){return this.fKc}},knd:{configurable:!0,enumerable:!0,get:function(){if(!this.M4d)return!1;for(var cb=ak(this.M4d.t_j()),Xb=cb.next();!Xb.done;Xb=cb.next())if(Xb=Xb.value,!Xb.Capabilities||!Xb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}},Oli:{configurable:!0,enumerable:!0,get:function(){return!!this.CEa}}});Object(S.a)(x,"PolicyManager",null,[634]);var rc=b(142),Mc=b(257);y.prototype.init=
function(){var cb=this;Ka.AFrameworkApplication.fa.ra("ShouldInitCommonPolicyPackage")&&(Ka.AFrameworkApplication.fa.ra("IsDataLossPreventionEnabledForUser")&&Ka.AFrameworkApplication.ta&&(this.Ig=this.fb.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Ig.lne(Object(xa.a)(this,this.ARd,"showPolicyBusinessBar")),da.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),rc.a.get_instance().ak(6,function(){cb.Ig.Cac()})),Ka.AFrameworkApplication.fa.ra("WacLabelingPoliciesIsEnabled")&&
Ka.AFrameworkApplication.fa.ra("SupportsPolicies")?rc.a.get_instance().ak(6,Object(xa.a)(this,this.YFi,"onAfterRibbonBehaviorAttached")):ea.bQa(!1))};y.prototype.dispose=function(){};y.prototype.Sh=function(cb){cb.register(634,"Common.App.Policy.Contracts.IPolicyManager").tc().Cc(function(){return new x(Ka.AFrameworkApplication.fa,Ka.AFrameworkApplication.qd,Ka.AFrameworkApplication.ta.tD,Ka.AFrameworkApplication.fa.kd("MaxGetPolicyRetries",1),cb.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),
Ka.AFrameworkApplication.ta.Pa.Fj)});cb.register(ea,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").tc().Cc(function(){return new ea(Ka.AFrameworkApplication.ub,Ka.AFrameworkApplication.ta,Ka.AFrameworkApplication.fa,cb.FKd("Common.App.Policy.Contracts.IPolicyManager"))});this.fb=cb};y.prototype.YFi=function(){this.f1=this.fb.nh("CommonUI.BusinessBar");this.Ig||(this.Ig=this.fb.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Kqa=this.fb.resolve("Common.App.Policy.PolicyActor");
Ka.AFrameworkApplication.fa&&Ka.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Kb.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Ig.hZb(Object(xa.a)(this.Kqa,this.Kqa.eNf,"registerActionsHandler")):this.Kqa.Cg();this.Ig.hZb(Object(xa.a)(this,this.PXd,"updateLabelInfo"));Ka.AFrameworkApplication.fa.ra("WacApplyManualPolicyLabelIsEnabled")&&(this.Ig.$Uc(Object(xa.a)(this,
this.L3h,"handleSetPolicyLabelFailure")),this.Ig.Wle(Object(xa.a)(this,this.vYb,"addAutoPolicyBusinessBarEntry")),this.Ig.qne(Object(xa.a)(this,this.dda,"removeAutoPolicyBusinessBarEntry")),this.Ig.Xle(Object(xa.a)(this,this.WTc,"addMandatoryLabellingBusinessBarEntry")),this.Ig.rne(Object(xa.a)(this,this.UHd,"removeMandatoryLabellingBusinessBarEntry")))};y.prototype.PXd=function(){this.Kqa.MZf();this.Kqa.eZf();this.Kqa.rJf();var cb=this.Ig.NWg();Ka.AFrameworkApplication.fa.ra("HasDocumentEditRights")&&
!cb?this.Kqa.d$f():da.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",Ka.AFrameworkApplication.fa.ra("HasDocumentEditRights"),cb);Ka.AFrameworkApplication.ta.updateCommandUI()};y.prototype.ARd=function(cb,Xb){this.k0e(Xb.title,Xb.Kpc,38,Xb.Ptf,Xb.buttonText);da.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")};y.prototype.L3h=
function(cb,Xb){if(Xb.$2f){cb=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var kc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Wc=null,id=null;Ka.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(cb=Xb.title,kc=Xb.message,Wc=Xb.buttonText,id=Xb.wY):1===Xb.errorType?(cb=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle,kc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage):
2===Xb.errorType?(cb=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle,kc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage):Ka.AFrameworkApplication.fa.ra("ClpLabelDisabledErrorCodeIsEnabled")&&3===Xb.errorType?(cb=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle,kc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage):4===Xb.errorType?(cb=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle,
kc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage):5===Xb.errorType&&(cb=Xb.title,kc=Xb.message,Wc=Xb.buttonText,id=Xb.wY);this.k0e(cb,kc,21,null,null,id,Wc);da.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.")}};y.prototype.dda=function(){};y.prototype.vYb=function(cb,Xb){this.f1&&(this.Ig.dda(Xb.Wob),cb=new ta.a(Xb.title,Xb.message,null),cb.id=Xb.Wob,cb.closeable=!0,cb.image=3,cb.addButton(Xb.buttonText,Xb.wY,
Xb.buttonText,!0),this.f1.VD(cb,!1))};y.prototype.WTc=function(cb,Xb){this.f1&&(cb=new ta.a(Xb.title,Xb.message,null),cb.id=Xb.Wob,cb.closeable=!1,cb.image=3,cb.addButton(Xb.buttonText,Xb.wY,Xb.buttonText,!1),this.f1.VD(cb,!1))};y.prototype.UHd=function(){};y.prototype.k0e=function(cb,Xb,kc,Wc,id,Vc,td){Wc=void 0===Wc?null:Wc;id=void 0===id?null:id;Vc=void 0===Vc?null:Vc;td=void 0===td?null:td;cb=new ta.a(cb,Xb,null);cb.id=kc;cb.closeable=!0;Wc&&cb.qBg(id,Wc);Vc&&cb.addButton(td,Vc,td)};y.main=function(){Mc.a.instance.Ui(new y)};
Af.Object.defineProperties(y.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.Policy"}}});Object(S.a)(y,"PackageManager",null,[3,4]);var Pc=b(11),Kc=b(615),ub=b(232),Fb=b(51),pc=b(37),eb=b(85),ic=b(38),Ac=b(328),lc=b(389),Gc=b(177),ed=b(92),fd=b(29),Bc=b(296),ld=b(1),Bd=b(22),xb=b(295);Object(S.a)(B,"ApplyPolicyContextParameters",null,[]);var Fd=b(7),Vd=b(904),se=b(626),ue=b(47),Ee=b(44);Object(S.a)(A,"AnnotationActivationOptions",null,[]);var qe=b(61),He=b(932),Ie=
b(909),ef=He.a;Rk(z,ef);z.getTypeName=function(){return"AugLoop_SecurityClp_LabellingAnnotation"};z.Rd=function(){return["AugLoop_Core_Annotation"]};Object(S.a)(z,"LabellingAnnotation",He.a,[]);var Ye=b(933),pe=Ye.a;Rk(n,pe);n.getTypeName=function(){return"AugLoop_SecurityShared_SecurityShared"};n.Rd=function(){return[]};Object(S.a)(n,"SecurityShared",Ye.a,[]);Rk(w,n);w.getTypeName=function(){return"AugLoop_SecurityShared_CLP"};w.Rd=function(){return["AugLoop_SecurityShared_SecurityShared"]};Object(S.a)(w,
"CLP",n,[]);var Qd=He.a;Rk(f,Qd);f.getTypeName=function(){return"AugLoop_Automatic_Clp_LabellingAnnotation"};f.Rd=function(){return["AugLoop_Core_Annotation"]};Object(S.a)(f,"LabellingAnnotation",He.a,[]);var fe=b(1177),Hc=b(1077),ud=b(1179),Gd=He.a;Rk(m,Gd);m.getTypeName=function(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"};m.Rd=function(){return["AugLoop_Core_Annotation"]};Object(S.a)(m,"LinkedDataTypeAnnotation",He.a,[]);var jd=ic.a;Rk(l,jd);l.prototype.dispose=function(){this.disposed||
(this.disposed=!0,this.sdh(),this.yGe(),this.XCd=this.policyManager=this.augmentationLoopManager=null,jd.prototype.dispose.call(this))};l.prototype.XYa=function(cb,Xb,kc,Wc,id){id=void 0===id?!1:id;da.ULS.sendTraceTag(537154642,306,50,"AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource {0} with AutoLabelPresent: {1}, RecommendedLabelPresent: {2}, isStandard: {3}.",Wc,!!cb,!!Xb,id);this.dc?this.XCd&&(this.sUg(Xb,Wc)?(this.pEd=Xb,this.kEd=Wc,this.Vif.ia(Wc,Xb)):Xb=this.pEd,cb=this.XCd.XYa(cb,
Xb,kc,id),da.ULS.sendTraceTag(537154640,306,50,"AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned {0}.",cb)):da.ULS.sendTraceTag(537154641,306,15,"AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.dc)};l.prototype.sUg=function(cb,Xb){if(!this.policyManager.Vga())return da.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;var kc=this.policyManager.un;
var Wc=this.Vif.zc(this.kEd).value;var id=null,Vc=null,td=null;kc=ak(kc.SensitivityLabels);for(var rd=kc.next();!rd.done;rd=kc.next())rd=rd.value,rd.Id===cb&&(id=rd),rd.Id===Wc&&(Vc=rd),rd.Id===this.pEd&&(td=rd);return Vc&&Vc.Id===cb?(da.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.hC(40)&&this.kEd!==Xb&&td&&(!id||td.Order>=id.Order)?(da.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0};l.prototype.Vld=function(){return ld.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)};l.prototype.y7i=function(){this.policyManager.Wle(this.k2f);this.policyManager.qne(this.aOf);this.$.ea.p2(this.X5);this.Vld()&&(this.policyManager.lEg(this.Oqb),this.policyManager.eHg(this.Dbg),this.policyManager.fHg(this.Ebg))};
l.prototype.sdh=function(){this.businessBar.removeEntry(40);this.businessBar.removeEntry(39);this.policyManager.$$i(this.k2f);this.policyManager.scj(this.aOf);this.$.ea.e0(this.X5);ld.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&(this.policyManager.Gaj(this.Oqb),this.policyManager.Ycj(this.Dbg),this.policyManager.Zcj(this.Ebg))};l.prototype.L8h=function(){this.zA=new Vd.a(se.a.TJ());var cb=this.Vld()?z.getTypeName():f.getTypeName();this.zA.add(1,Object(Fd.a)(new A,
{annotationType:cb,YFa:this.jqi,eF:!1,wLa:!1}));this.zA.add(2,Object(Fd.a)(new A,{annotationType:m.getTypeName(),YFa:this.jsi,eF:!1,wLa:!1}))};l.prototype.F6f=function(){for(var cb=ak(this.X9a),Xb=cb.next();!Xb.done;Xb=cb.next())this.augmentationLoopManager.submitOperation(Xb.value);this.X9a=[]};l.prototype.t7i=function(cb){if(!this.zA.kb(cb))return da.ULS.sendTraceTag(537154636,306,15,"AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource {0}.",cb),
!1;if(this.zA.na(cb).eF)return da.ULS.sendTraceTag(537154635,306,15,"AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource {0}.",cb),!0;this.zA.na(cb).eF=!0;da.ULS.sendTraceTag(537154634,306,50,"AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource {0}.",cb);if(!this.$.isEditMode)return da.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;ld.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)?this.Cxb():this.k9e();return!0};l.prototype.k9e=function(){for(var cb=this,Xb=!1,kc=ak(this.zA),Wc=kc.next();!Wc.done&&!(Xb=Wc.value.value.eF||Xb);Wc=kc.next());Xb?this.augmentationLoopManager?(da.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.UXb()):this.rZa?da.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):
(this.rZa=!0,Xb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,da.ULS.sendTraceTag(537154629,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in {0} milliseconds.",Xb),ue.a.instance.create(function(){cb.N8h()},Xb,Ee.a.rse,!0,!0)):da.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")};l.prototype.Cxb=function(){var cb=this,Xb=0<this.X9a.length;if(!Xb)for(var kc=
ak(this.zA),Wc=kc.next();!Wc.done&&!(Xb=Wc.value.value.eF||Xb);Wc=kc.next());Xb?this.augmentationLoopManager?(da.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.UXb(),this.F6f()):this.rZa?da.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):(this.rZa=!0,Xb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,da.ULS.sendTraceTag(537154625,
306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in {0} milliseconds.",Xb),ue.a.instance.create(function(){cb.O8h()},Xb,Ee.a.rse,!0,!0)):da.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")};l.prototype.O8h=function(){var cb=this;pc.TaskExtensions.Ba(Fb.GetServiceTaskFactory.Ra(this.$.da,328,327,1),function(Xb){cb.augmentationLoopManager=Xb.result;cb.rZa=!1;cb.augmentationLoopManager?
(da.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),cb.augmentationLoopManager.xYb(cb.Z8a),cb.$.isEditMode?(cb.UXb(),cb.F6f()):da.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):da.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};l.prototype.N8h=function(){var cb=this;
pc.TaskExtensions.Ba(Fb.GetServiceTaskFactory.Ra(this.$.da,328,327,1),function(Xb){cb.augmentationLoopManager=Xb.result;cb.rZa=!1;cb.augmentationLoopManager?(da.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),cb.augmentationLoopManager.xYb(cb.Z8a),cb.$.isEditMode?cb.UXb():da.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):da.ULS.sendTraceTag(537154593,306,
10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};l.prototype.yGe=function(){for(var cb=ak(this.zA),Xb=cb.next();!Xb.done;Xb=cb.next())Xb=Xb.value,Xb.value.eF&&this.rdh(Xb.key)};l.prototype.rdh=function(cb){this.zA.na(cb).wLa&&this.yFe(cb);this.zA.na(cb).eF=!1;da.ULS.sendTraceTag(537154591,306,50,"AutoPolicyManager::DeregisterAnnotation completed for LabellingSource {0}.",cb)};l.prototype.UXb=function(){for(var cb=ak(this.zA),Xb=cb.next();!Xb.done;Xb=
cb.next())Xb=Xb.value,Xb.value.eF&&!Xb.value.wLa&&this.activateAnnotation(Xb.key)};l.prototype.activateAnnotation=function(cb){this.augmentationLoopManager.activateAnnotation(this.zA.na(cb).annotationType);this.augmentationLoopManager.gJ(this.zA.na(cb).annotationType,this.zA.na(cb).YFa);this.zA.na(cb).wLa=!0;da.ULS.sendTraceTag(537154590,306,50,"AutoPolicyManager::ActivateAnnotation completed for LabellingSource {0}.",cb)};l.prototype.Ibh=function(){for(var cb=ak(this.zA),Xb=cb.next();!Xb.done;Xb=
cb.next())Xb=Xb.value,Xb.value.wLa&&this.yFe(Xb.key)};l.prototype.yFe=function(cb){this.augmentationLoopManager.Dma(this.zA.na(cb).annotationType,this.zA.na(cb).YFa);this.zA.na(cb).wLa=!1;da.ULS.sendTraceTag(537154589,306,50,"AutoPolicyManager::DeactivateAnnotation completed for LabellingSource {0}.",cb)};l.prototype.applyPolicyLabel=function(cb,Xb,kc,Wc){var id=this;if(this.fa.ra("SupportsOfficeClientCoauthoring"))da.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),
this.XYa(cb,Xb,kc,Wc);else{da.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");var Vc=function(td){id.XYa(cb,Xb,kc,Wc,0===td||1===td||4===td)};this.efd(Vc,function(){Vc(2)},this.wof)}};l.prototype.ZWc=function(cb,Xb){var kc=this.P$f(cb);cb=kc.sensitivityLabel;var Wc=kc.aGa;if(!kc.returnValue)return da.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Wc&&Wc.Order>=
cb.Order)return da.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(cb.Id,cb.Id,null,Xb);return!0};l.prototype.$Wc=function(cb,Xb){var kc=this;Xb=!1;var Wc=null,id=null;if(!function(){var rd=kc.P$f(cb);Wc=rd.sensitivityLabel;id=rd.aGa;return rd}().returnValue)return da.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,R5a:Xb};if(id&&
id.ParentId&&Wc.ParentId&&id.ParentId===Wc.ParentId)return da.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,R5a:Xb};if(id&&id.Order>=Wc.Order)return da.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,R5a:Xb};if(this.fa.ra("SupportsOfficeClientCoauthoring")){da.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled.");var Vc=this.policyManager.un;Vc=!Vc.AppliedPolicyId||!Vc.PolicyLabelAssignmentMethod||Va.e(Vc.PolicyLabelAssignmentMethod)===Va.e("standard");this.Oqe(Wc.Id,Vc)}else{da.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");var td=function(rd){kc.Oqe(Wc.Id,0===rd||1===rd||4===rd)};this.efd(td,function(){td(2)},
this.wof)}return{returnValue:!0,R5a:Xb}};l.prototype.efd=function(cb,Xb,kc,Wc){var id=this;Wc=void 0===Wc?0:Wc;if(this.dc){var Vc=this.$.oa.xa.Pb();r(this.$.oa.xa,this.$.ya.DocumentHostInfo.TenantId,function(td){id.OTh(td,cb)},function(){id.NTh(cb,Xb,kc,Wc)},null,null,Vc)}else da.ULS.sendTraceTag(537154570,306,15,"AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.dc)};l.prototype.OTh=function(cb,Xb){da.ULS.sendTraceTag(537154569,
306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.dc?!cb||Bc.a(cb)?da.ULS.sendTraceTag(537154567,306,15,cb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Xb(cb.Result):da.ULS.sendTraceTag(537154568,306,50,"AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.dc)};l.prototype.NTh=
function(cb,Xb,kc,Wc){da.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.dc?Wc>=kc?(da.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Xb()):this.efd(cb,Xb,kc,Wc+1):da.ULS.sendTraceTag(537154565,306,50,"AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.dc)};l.prototype.Oqe=
function(cb,Xb){Xb?this.XYa(cb,null,null,3,!0):this.XYa(null,cb,null,3,!1)};l.prototype.P$f=function(cb){var Xb;var kc=Xb=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Xb,aGa:kc};if(!this.policyManager.Vga())return da.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Xb,aGa:kc};var Wc=this.policyManager.un;if(!Wc)return da.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),
{returnValue:!1,sensitivityLabel:Xb,aGa:kc};if(Sa.a.uh(Wc.SensitivityLabels))return da.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:Xb,aGa:kc};var id=Wc.AppliedPolicyId;cb=ak(cb);for(var Vc=cb.next();!Vc.done;Vc=cb.next()){Vc=Vc.value;for(var td=ak(Wc.SensitivityLabels),rd=td.next();!rd.done;rd=td.next())rd=rd.value,rd.Id===Vc&&(!Xb||Xb.Order<rd.Order)&&(Xb=rd),rd.Id===
id&&(kc=rd)}return Xb?{returnValue:!0,sensitivityLabel:Xb,aGa:kc}:(da.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Xb,aGa:kc})};Af.Object.defineProperties(l.prototype,{dc:{configurable:!0,enumerable:!0,get:function(){return!this.disposed&&this.$.ea.dc}}});Object(S.a)(l,"AutoPolicyManager",ic.a,[10]);var Sd=b(160),Wd=b(12),Le=b(14),Pd=Sd.ErrorDialog;Rk(k,Pd);k.prototype.pn=function(){var cb=this;Pd.prototype.pn.call(this);
if(this.error.Appearance&1&&this.$.Bd&2){var Xb=this.getButton(0);Wd.DOMElementExtensions.MNd(Xb.get_element(),Le.a.instance.ga(1296));this.qP(function(){0===cb.returnValue&&cb.$.Bd&2&&(da.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),pc.TaskExtensions.Ba(Fb.GetServiceTaskFactory.Ra(cb.$.da,55,56,0),function(kc){kc.result.U1c()},cb.$.la,3))})}};k.zQ=function(cb){return cb.Bd&2?fd.a.Wc(3,1,0,1945,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
fd.a.Wc(1,1,0,1946,0,-313914360,"SensitivityLabelBlockApplyLabel")};Object(S.a)(k,"BlockSenitivityLabelActionDialog",Sd.ErrorDialog,[]);var Re=ic.a;Rk(e,Re);e.prototype.initialize=function(){var cb=this;this.fa.ra("SupportsPolicies")?(this.KDa=this.fa.Wa("AppliedPolicyId"),this.w6.Cg(),this.$.da.Za(29,function(Xb){cb.statusBarManager=Xb;Xb.jJ(cb)}),this.xz(),Bd.a.uh(this.fa.Wa("HostUserId"))||this.DYi(),this.w6.A7i(this.qOg),this.w6.q8i(this.Ldi),this.nr.w7i(this.knd),this.ko=ld.EwaSettings.getBooleanFeatureGate(Ac.a.oPa,
!1)):ld.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Kb.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!Bd.a.uh(this.fa.Wa("HostUserId"))&&ld.EwaSettings.ma(170)&&this.$.ea.Kg.get(45)&&(da.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.VMh())};e.prototype.jq=function(cb){this.addHandler("LabelInfoChangedKey",cb)};e.prototype.Hq=function(cb){this.removeHandler("LabelInfoChangedKey",
cb)};e.prototype.dn=function(){return!0};e.prototype.Lr=function(cb,Xb){if("QueryPolicyLabel"!==cb)return!1;if(this.FRa())return Xb.Visible=!1,!0;Xb.Visible=!0;return 32===Ka.AFrameworkApplication.ub.ae(bb.a.fab,2,Xb)};e.prototype.dispose=function(){this.statusBarManager&&(this.statusBarManager.BF(this),this.statusBarManager=null);this.w6.GNb();this.XXc=!1;this.nr.Jcj(this.A3f);this.nr.Kcj(this.TBf);this.$.ea.Gw(this.Nja);if(this.fa.ra("SupportsOfficeClientCoauthoring")){var cb=this.$.da.za(292);
cb&&cb.xbj(this.jyf)}this.nr.baj(this.Wke);this.nr.tcj(this.yOf);this.nr.Hbj(this.jof);this.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&this.nr.Wcj(this.pag);ld.EwaSettings.ma(292)&&this.nr.cbj(this.iKe);this.Y9&&(this.Y9.dispose(),this.Y9=null);Re.prototype.dispose.call(this)};e.prototype.ZWc=function(cb,Xb){if(!this.fa.ra("SupportsPolicies"))return da.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.YCd)return da.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(Sa.a.uh(cb))return!1;this.Y9||this.zkd();return this.Y9.ZWc(cb,Xb)};e.prototype.xz=function(){this.raiseEvent("LabelInfoChangedKey")};e.prototype.VMh=function(){var cb=this;ld.EwaSettings.isChangeGateEnabled("OfficeVSO:6000793_RibbonDisplayedDependencyInDataLossPolicyCall")?rc.a.get_instance().ak(10,function(){cb.nr.Cac()}):this.nr.Cac()};e.prototype.DYi=function(){var cb=
this;rc.a.get_instance().ak(10,function(){cb.nr.hZb(cb.PXd);cb.nr.QEg(cb.cxf);cb.nr.PEg(cb.cxf);cb.nr.$Uc(cb.A3f);cb.nr.Bne(cb.TBf);cb.$.ea.Bu(cb.Nja);cb.nr.Xle(cb.Wke);cb.nr.rne(cb.yOf);cb.nr.xFg(cb.jof);cb.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&cb.nr.bHg(cb.pag);if(cb.fa.ra("SupportsOfficeClientCoauthoring")){var Xb=cb.$.da.za(292);Xb&&Xb.oFg(cb.jyf)}ld.EwaSettings.ma(292)&&(da.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),
cb.nr.NEg(cb.iKe));cb.Byh()});this.$.ycb("sensitivity",!0)};e.prototype.Byh=function(){this.fa.ra("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.t3a():this.cIh(this.$.ya.DocumentHostInfo.TenantId)};e.prototype.zkd=function(){this.Y9=new l(this.w6,this.nr,this.$,this.fa,this.fE)};e.prototype.gNf=function(cb){if(!this.fa.ra("SupportsPolicies"))return da.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),
!1;this.Y9||this.zkd();return this.Y9.t7i(cb)};e.prototype.$Wc=function(cb,Xb){if(!this.fa.ra("SupportsPolicies"))return da.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,R5a:!1};if(!this.YCd)return da.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,R5a:!0};this.Y9||this.zkd();return this.Y9.$Wc(cb,Xb)};e.prototype.cIh=
function(cb){var Xb=this;da.ULS.sendTraceTag(537154514,306,50,"PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length {0}",cb.length);var kc=this.$.oa.xa.Pb();v(this.$.oa.xa,cb,function(Wc){Xb.hGj(Wc)},null,null,null,kc)};e.prototype.hGj=function(cb){da.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");cb&&!Bc.a(cb)&&(this.KDa=cb.Result);this.t3a();this.labelId?da.ULS.sendTraceTag(537154512,306,50,"PolicyManagerWrapper: Fetched LabelId length from custom.xml is {0}",
this.labelId.length):da.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")};e.prototype.t3a=function(){this.nr.$cd(this.labelId,void 0,void 0,!1)};e.prototype.FQe=function(){if(!this.XXc){this.$.jf();this.XXc=!0;this.fE.$4e();var cb={};cb.hasLabel=!!this.labelId&&0<this.labelId.length;cb.isProtectedFile=this.fa.ra("ProtectedFile");cb.SupportsPolicies=this.fa.ra("SupportsPolicies");cb.AreLabelsAvailableForDisplay=this.nr.Vga();cb.SupportsOfficeClientCoauthoring=this.fa.ra("SupportsOfficeClientCoauthoring");
cb.IsAnonymousUser=this.fa.ra("IsAnonymousUser");da.ULS.sendTraceTag(51238051,306,50,"CLPUsage : {0}",JSON.stringify(cb))}};e.prototype.rKg=function(){this.w6.sKg(this.Ixa);this.Ixa=null};e.prototype.i5h=function(cb){cb=ak(cb.LabelActions);for(var Xb=cb.next();!Xb.done;Xb=cb.next())if(Bd.a.equals(Xb.value.Name,"ApplyWatermark",!1))return!0;return!1};e.prototype.Oyj=function(cb){cb?(new k(this.$)).hf():da.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")};
e.prototype.applyPolicyLabel=function(cb,Xb,kc,Wc){var id=this,Vc=Dc.c(this.nr.un);if(void 0===cb||null===cb)cb="";var td=new B;td.Jpc=cb;td.iXf=Wc;td.uP=Xb;var rd=this.$.oa.xa;lc.a(this.$.userOperationManager,function(za,tb,Wb){tb=cb;var fc=id.$.ya.DocumentHostInfo.TenantId;za=xb.b.call(null,id.gGi,za);var xc=rd.Na(41,null);xc.labelsInfoJson=Vc;xc.appliedLabelId=tb;xc.tenantId=fc;xc.applyLabelFlag=Xb;xc.skipApplyOutcomes=kc;return qe.g(rd,"ApplyPolicyLabel",xc,za,null,Wb,td,0)},function(za){return new Gc.a(222,
0,za)},null);this.QBc=!1;this.fNd=null};e.prototype.FRa=function(){var cb=this.$.da.za(478);return this.ko&&cb?cb.ko():!1};Af.Object.defineProperties(e.prototype,{title:{configurable:!0,enumerable:!0,get:function(){return this.Ap}},Kpc:{configurable:!0,enumerable:!0,get:function(){return this.Uce}},linkText:{configurable:!0,enumerable:!0,get:function(){return this.Afa}},aOi:{configurable:!0,enumerable:!0,get:function(){return this.Nbe}},labelId:{configurable:!0,enumerable:!0,get:function(){return this.KDa}}});
Object(S.a)(e,"PolicyManagerWrapper",ic.a,[465,157,659]);var Qe=ub.a;Rk(d,Qe);d.prototype.create=function(){var cb=this,Xb=Fb.GetServiceTaskFactory.Ra(this.$.da,5,4,this.hb),kc=Ka.AFrameworkApplication.qd,Wc=Ka.AFrameworkApplication.fa;pc.TaskExtensions.Ba(Xb,function(){try{var id=new Kc.a(function(){return new x(Wc,kc,Ka.AFrameworkApplication.ta.tD,cb.$.ya.MaxGetPolicyRetries,qb.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))}),Vc=new Kc.a(function(){return new ea(Ka.AFrameworkApplication.ub,
Ka.AFrameworkApplication.ta,Ka.AFrameworkApplication.fa,id)}),td=cb.$.da.za(274);td||(td=new e(id.value,Vc.value,Xb.result,cb.$,Ka.AFrameworkApplication.fa),td.initialize());cb.pb(td)}catch(rd){throw da.ULS.sendTraceTag(537154525,306,10,"PolicyManager was not created successfully [Exception: {0}]",rd.toString()),rd;}},this.la,3)};d.ka=function(cb){cb.da.Ga(275,new d(cb))};Object(S.a)(d,"PolicyManagerFactory",ub.a,[]);var jc=b(905),Fa=b(186);c.prototype.Lc=function(){return!1};c.prototype.executeCommand=
function(cb,Xb,kc){switch(Xb.command){case bb.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(kc[Y.SVc]=this.$.workbookContext.ExclusiveLockId),cb=Ka.AFrameworkApplication.ub.ae(bb.a.setSensitivity,2,kc),db.Task.Ua(32===cb);case bb.a.C6:return cb=Ka.AFrameworkApplication.ub.ae(bb.a.C6,2,kc),db.Task.Ua(32===cb);case bb.a.D6:return cb=Ka.AFrameworkApplication.ub.ae(bb.a.D6,2,kc),db.Task.Ua(32===cb);default:return Fa.a(Xb.command)}};c.prototype.Ac=function(cb,Xb){switch(Xb.command){case bb.a.setSensitivity:case bb.a.C6:case bb.a.D6:return!0;
default:return!1}};c.prototype.Qc=function(cb,Xb,kc){switch(Xb){case "PopulateSensitivityFlyout":return 32===Ka.AFrameworkApplication.ub.ae(bb.a.Vya,2,kc);default:return!1}};Object(S.a)(c,"SensitivityCommandHandler",null,[403]);var Qb=jc.a;Rk(a,Qb);a.prototype.zd=function(){this.jd([new c(this.$)])};a.ka=function(cb){jc.a.Qd(316,new a(cb))};Object(S.a)(a,"SensitivityCommandHandlerFactory",jc.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");
y.main();(function(){Pc.a.Fa(function(cb){d.ka(cb);a.ka(cb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.policy.js.map/6506e423554f170b40fc3abe749e180b/EwaDS.policy.js.map