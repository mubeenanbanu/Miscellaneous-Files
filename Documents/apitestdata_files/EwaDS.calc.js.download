(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[14],{1002:function(u,D,b){function a(){}b.d(D,"a",function(){return a});u=b(0);a.abs="Abs";a.rel="Rel";Object(u.a)(a,"PositionBaseType",null,[])},1016:function(u,D,b){function a(G){this.calcManager=G}function c(){return w.call(this)||this}function d(){this.secondRow=this.firstRow=null;return this}function e(){return w.call(this)||this}function k(){this.right=this.left=this.bottom=this.top=null;return this}function l(){return w.call(this)||
this}function m(){this.secondColumn=this.firstColumn=null;return this}function f(){var G=w.call(this)||this;G.lhc=!1;return G}function w(){this.end=this.start=0;this.dv=null}function n(){this.column=this.row=null;return this}function z(){}b.r(D);u=b(0);var r=b(7),v=b(15);Object(u.a)(z,"Reference",null,[]);Rk(n,z);Object(u.a)(n,"CellReference",z,[]);w.prototype.kKg=function(G,E){for(var I=0;I<this.dv.length;I++){var U=this.r_b(G,this.dv[I]);E+=U;I<this.dv.length-1&&(E+=":")}return E};Object(u.a)(w,
"IReferenceSequence",null,[]);var A=b(24),B=b(1002);Rk(f,w);f.prototype.rbc=function(){var G=b(1016).RelativeAndAbsoluteReferencesManager,E=this.dv[0];return G.frf(E.row.kind===B.a.abs,E.column.kind===B.a.abs)};f.prototype.r_b=function(G,E){E=A.Range.Tc(E.row.index+1,E.column.index+1);return this.lhc?E.Dac(1===G||3===G,1===G||2===G):E.Y3a(1===G||3===G,1===G||2===G,!0,!0)};Object(u.a)(f,"CellReferenceSequence",w,[]);Rk(m,z);Object(u.a)(m,"ColumnReference",z,[]);Rk(l,w);l.prototype.rbc=function(){var G=
this.dv[0];return b(1016).RelativeAndAbsoluteReferencesManager.Epf(G.firstColumn,G.secondColumn).kind===B.a.abs?2:3};l.prototype.r_b=function(G,E){return A.Range.dub(E.firstColumn.index+1,E.secondColumn.index+1).Y3a(1===G||3===G,!0,1===G||3===G,!0)};Object(u.a)(l,"ColumnReferenceSequence",w,[]);Rk(k,z);Object(u.a)(k,"RangeReference",z,[]);Rk(e,w);e.prototype.rbc=function(){var G=b(1016).RelativeAndAbsoluteReferencesManager,E=this.dv[0];return G.frf(E.top.kind===B.a.abs,E.left.kind===B.a.abs)};e.prototype.r_b=
function(G,E){E=new A.Range(E.top.index+1,E.left.index+1,E.bottom.index+1,E.right.index+1,!1,!1);var I=1===G||3===G;G=1===G||2===G;return E.Y3a(I,G,I,G)};Object(u.a)(e,"RangeReferenceSequence",w,[]);Rk(d,z);Object(u.a)(d,"RowReference",z,[]);Rk(c,w);c.prototype.rbc=function(){var G=this.dv[0];return b(1016).RelativeAndAbsoluteReferencesManager.Epf(G.firstRow,G.secondRow).kind===B.a.abs?0:1};c.prototype.r_b=function(G,E){return A.Range.m$b(E.firstRow.index+1,E.secondRow.index+1).Y3a(!0,1===G||2===
G,!0,1===G||2===G)};Object(u.a)(c,"RowReferenceSequence",w,[]);var y=b(1186),x=b(1187),C=b(206);b.d(D,"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.N0a=function(G,E,I){var U=E;var M=I;if(!G||!C.f(G))return{returnValue:G,Ywd:U,Xwd:M};var T=this.calcManager.hRe(G);if(!T)return v.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,Ywd:U,Xwd:M};
T=this.IWh(T,G,E,I);for(var F=0,K="",J=0,O=0;O<T.length;O++)if(this.rIe(T[O],E,I)){F=T[O].rbc();U=T[O].start;break}for(;O<T.length&&this.rIe(T[O],E,I);O++)K+=G.substring(J,T[O].start),K=T[O].kKg(F,K),J=T[O].end;J&&(M=K.length);K+=G.substring(J,G.length);return{returnValue:K,Ywd:U,Xwd:M}};a.prototype.IWh=function(G,E,I,U){for(var M=[],T=0;T<G.length;T++){var F=G[T];if(F.kind===y.a.range)if(F=F.ref,F.type===x.a.cell){var K=F;F=Object(r.a)(new f,{start:F.span.start,end:F.span.end,dv:[Object(r.a)(new n,
{column:K.col,row:K.row})],lhc:this.calcManager.G1b(F.span.end,E)});M.push(F)}else if(F.type===x.a.range)this.sIe(F.topLeftSpan,I,U)&&this.sIe(F.bottomRightSpan,I,U)?(K=new k,F.top.index<=F.bottom.index?(K.top=F.top,K.bottom=F.bottom):(K.bottom=F.top,K.top=F.bottom),F.left.index<=F.right.index?(K.left=F.left,K.right=F.right):(K.right=F.left,K.left=F.right),F=Object(r.a)(new e,{start:F.topLeftSpan.start,end:F.bottomRightSpan.end,dv:[K]}),M.push(F)):(K=Object(r.a)(new f,{start:F.topLeftSpan.start,end:F.topLeftSpan.end,
dv:[Object(r.a)(new n,{column:F.left,row:F.top})],lhc:this.calcManager.G1b(F.topLeftSpan.end,E)}),F=Object(r.a)(new f,{start:F.bottomRightSpan.start,end:F.bottomRightSpan.end,dv:[Object(r.a)(new n,{column:F.right,row:F.bottom})],lhc:this.calcManager.G1b(F.topLeftSpan.end,E)}),M.push(K),M.push(F));else if(F.type===x.a.column){K=F;for(F=Object(r.a)(new l,{start:F.span.start,end:F.span.end,dv:[Object(r.a)(new m,{firstColumn:K.startIndex,secondColumn:K.endIndex})]});F.end<E.length-1&&":"===E.charAt(F.end)&&
T<G.length-1;)if(K=G[T+1].ref,K.type===x.a.column&&K.span.start===F.end+1){var J=K;F.dv.push(Object(r.a)(new m,{firstColumn:J.startIndex,secondColumn:J.endIndex}));F.end=K.span.end;T++}else break;M.push(F)}else if(F.type===x.a.row){K=F;for(F=Object(r.a)(new c,{start:F.span.start,end:F.span.end,dv:[Object(r.a)(new d,{firstRow:K.startIndex,secondRow:K.endIndex})]});F.end<E.length-1&&":"===E.charAt(F.end)&&T<G.length-1;)if(K=G[T+1].ref,K.type===x.a.row&&K.span.start===F.end+1)J=K,F.dv.push(Object(r.a)(new d,
{firstRow:J.startIndex,secondRow:J.endIndex})),F.end=K.span.end,T++;else break;M.push(F)}}return M};a.prototype.rIe=function(G,E,I){return!(G.start>I||E>G.end)};a.prototype.sIe=function(G,E,I){return!(G.start>I||E>G.end)};a.Epf=function(G,E){return G.index<=E.index?G:E};a.frf=function(G,E){return E||G?E&&G?2:!E&&G?3:0:1};Object(u.a)(a,"RelativeAndAbsoluteReferencesManager",null,[515])},1147:function(u,D,b){function a(A){var B=this;this.$=A;(this.lz=this.$.da.za(268))||d.ULS.shipAssertTag(537170070,
0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var y=n.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?w.a.current.Uo(75):w.a.current.Uo(78);this.logger=new f.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Vba=new c(A,this.lz);excelOnlineCalc.config.initCalc(this.logger,this.lz?function(x){return B.lz.isFeatureEnabled(x)}:function(){return!1},y);this.omg=
excelOnlineCalc.config.calcConfig(this.Vba.localeInfo)}function c(A,B){A=b(1147).CalcHelper;B&&(B.xe||d.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.Urg=A.mDe(B,A.ZCe(B.dja));this.Vrg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(D);u=b(0);var d=b(15),e=b(279),k;(function(A){A[A.paren=0]="paren";A[A.lead=1]="lead";A[A.intern=2]="intern";A[A.trail=3]="trail";A[A.undefined=4]="undefined"})(k||(k={}));Object(u.b)("CurrencyFormatOption",
k);var l;(function(A){A[A.none=-1]="none";A[A.mdy=0]="mdy";A[A.dmy=1]="dmy";A[A.ymd=2]="ymd";A[A.myd=3]="myd";A[A.dym=4]="dym";A[A.ydm=5]="ydm"})(l||(l={}));Object(u.b)("DateOrderOption",l);var m=b(8);c.prototype.formatNumber=function(A){return this.localeInfo.formatNumber(A)};Af.Object.defineProperties(c.prototype,{localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Vrg}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.Urg}}});Object(u.a)(c,"LocaleHolder",null,
[]);var f=b(1184),w=b(53),n=b(1),z=b(22),r=b(14),v=b(205);b.d(D,"CalcHelper",function(){return a});a.prototype.Cah=function(){if(n.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.va)return d.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var A=this.$.va.pa;return A?A.index:(d.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.va.pa.index};a.prototype.createParser=
function(){var A={};A.config=this.config;return excelOnlineCalc.parse.createParser(A)};a.prototype.createNumberFormatter=function(){var A=this,B=excelOnlineCalc.numfmt.createFormatGlobals(this.config,function(y,x){return excelOnlineCalc.calc.getTime(A.config,y,x,"Estimation")});return excelOnlineCalc.numfmt.createNumberFormatter(B)};a.prototype.N9g=function(A,B,y,x){if(!x)return{range:{row:B,col:y},sheet:{document:this.documentLoc,index:A}};B=excelOnlineCalc.location.gridCell(B,y);A=excelOnlineCalc.location.sheetIndex(this.documentLoc,
A);return excelOnlineCalc.location.sheetGridCell(A,B)};a.prototype.Xlh=function(A,B){var y=excelOnlineCalc.calc.getEvalResultKind(A);switch(y){case 4:return{returnValue:A?this.Vba.localeInfo.trueName:this.Vba.localeInfo.falseName,kind:y};case 1:return{returnValue:n.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.mAc(this.Vba.formatNumber(A),B):this.Vba.formatNumber(A),kind:y};case 2:return{returnValue:n.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.mAc(A.toString(),B):A.toString(),kind:y};case 128:return{returnValue:"",kind:y};case 8:switch(A.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.Vba.localeInfo.errorNames[A.type],kind:y};default:return{returnValue:a.unknownError,kind:y}}case 32:return{returnValue:n.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.mAc(this.d$g(A,B),B):"##UNSUPPORTED: ARRAY",kind:y};default:return{returnValue:r.a.instance.ga(2188),
kind:y}}};a.prototype.mAc=function(A,B){return A.length<=B?A:A.substring(0,B-3)+"..."};a.prototype.d$g=function(A,B){for(var y=this.Vba.localeInfo.leftBrace,x=0;x<A.rows;++x){for(var C=0;C<A.cols;++C)y+=A.opers[x][C],C<A.cols-1&&(y+=this.Vba.localeInfo.columnSeparator);x<A.rows-1&&(y+=this.Vba.localeInfo.rowSeparator)}return this.mAc(y,B-1)+this.Vba.localeInfo.rightBrace};a.mDe=function(A,B){B=void 0===B?null:B;var y=a.m4b(),x=A.xe.TrueValueString,C=A.xe.FalseValueString,G=A.xe.DecimalSeparator.toString(),
E=A.xe.ListSeparator.toString(),I=A.xe.ColumnSeparator.toString(),U=A.xe.RowSeparator.toString(),M=A.xe.ThousandsDataArray,T=A.xe.ThousandSeparator.toString(),F=A.xe.Lcid,K=A.xe.Country,J=A.xe.DigitsNumber,O=A.xe.ExpSeparatedBySpace,N=A.xe.FractionSeparator.toString(),H=A.xe.PercentSeparatedBySpace,Q=z.a.SUg(Enum.toString(k,A.xe.CurrencyFormat)),ca=A.xe.CurrencySymbolLead,X=A.xe.CurrencySeparatedBySpace,Z=A.xe.CurrencySymbolString,ea=A.xe.DigitsCurrency,ka=-1===A.xe.DateOrder?"MDY":v.e(Enum.toString(l,
A.xe.DateOrder)),Y=A.xe.DateSeparator.toString(),qa=A.xe.DateAlternativeSeparator.toString(),fa=A.xe.Year4Digits,ha=A.xe.Month2Digits,ia=A.xe.Day2Digits,wa=A.xe.LongDateFormat,Qa=A.xe.TimeSeparator.toString(),S=A.xe.TimeAltSeparator,da=A.xe.Hour2Digits,xa=A.xe.Use24HourClock,ta=A.xe.AmPmSeparatedBySpace,ab=[A.xe.AmString,A.xe.PmString],Na=A.xe.DayNameShortArray,Ka=A.xe.DayNameLongArray,la=A.xe.MonthNameShortArray,Ea=A.xe.MonthNameLongArray,ra=A.xe.PictureSpecialArray,na=e.a.map(("\x00"+A.xe.PictureSingleString).split(""),
function(Ma){return"\x00"===Ma?null:Ma}),ba=A.xe.PictureColorArray,sa=A.xe.PictureDbnumArray,ya=A.xe.RowLetter.toString(),va=A.xe.ColumnLetter.toString(),W=A.xe.LeftBrace.toString(),La=A.xe.RightBrace.toString(),Ia=A.xe.LeftBracket.toString(),mb=A.xe.RightBracket.toString(),fb=a.DXh(A.xe);return excelOnlineCalc.calc.localeData(B,y,x,C,ya,va,W,La,Ia,mb,G,E,I,U,M,T,F,K,J,O,N,H,Q,ca,X,Z,ea,ka,Y,qa,fa,ha,ia,wa,Qa,S,da,xa,ta,ab,Na,Ka,la,Ea,ra,na,ba,sa,fb,A.xe.SysDateFormatString,A.xe.SysTimeFormatString)};
a.ZCe=function(A){var B=[];if(!A)return B;A=ak(A);for(var y=A.next();!y.done;y=A.next()){y=y.value;var x=null;y.IsDynamicUdf||(x=excelOnlineCalc.calc.worksheetFunctionName(y.FunctionIndexInServer,y.NameUI));x&&B.push(x)}return B};a.m4b=function(){for(var A=[],B=Object.keys(m.a.errorNames),y=0;y<B.length;y++){var x=excelOnlineCalc.calc.errorTypeName(y+1,B[y]);x&&A.push(x)}return A};a.DXh=function(A){var B=Array(6);B[1]="#"+A.AllStructRefString;B[3]="#"+A.HeadersStructRefString;B[2]="#"+A.DataStructRefString;
B[4]="#"+A.TotalsStructRefString;B[5]="#"+A.ThisRowStructRefString;return B};Af.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.omg}}});a.unknownError="##ERR##";Object(u.a)(a,"CalcHelper",null,[])},1186:function(u,D,b){function a(){}b.d(D,"a",function(){return a});u=b(0);a.qsi="literal";a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.Gjf="letName";a.all="*";a.yTd="structRefRange";Object(u.a)(a,"TraverseFormulaInterestTypes",
null,[])},1187:function(u,D,b){function a(){}b.d(D,"a",function(){return a});u=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(u.a)(a,"TraverseFormulaRefTypes",null,[])},1367:function(u,D,b){function a(){Ea.a.Fa(c.ka)}function c(ra){var na=la.call(this)||this;na.$=ra;na.Eb();return na}function d(ra){var na=ab.call(this)||this;na.yl=null;na.Ifg=!1;na.xFb=null;na.instantaneousSupportInformationManager=null;na.HKd=null;na.Pxd=new Map;na.nbe=null;na.qnc=function(ba){B.ULS.sendTraceTag(537170005,
0,50,"CalcManager.OnLocaleInformationAvailable() called");ba.FId(na.qnc);ba.dja.length?na.Xmc(ba,Sys.EventArgs.Empty):(B.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),ba.Eme(na.Xmc))};na.Xmc=function(ba){B.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");ba.wId(na.Xmc);na.hNj(ba)};na.onContentReady=function(){na.yl&&(na.instantaneousSupportInformationManager&&na.instantaneousSupportInformationManager.pld||
Qa.Task.delay(0).continueWith(function(){na.yl.Leb(1)},0,null,S.a.current))};na.Ktf=function(ba,sa){na.yl&&(na.instantaneousSupportInformationManager&&na.instantaneousSupportInformationManager.pld||na.yl.vEe(sa.Zc.block))};B.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");na.kmd=!1;na.jb=ra;na.Pq=Z.g(ra);na.AFc=null;na.gridView.Ft(na.onContentReady);na.gridView.Ea.vUc(na.Ktf);na.$.da.Za(268,function(ba){ba.xe?(B.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),
na.qnc(ba,Sys.EventArgs.Empty)):(B.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),ba.Zme(na.qnc))});return na}function e(ra){var na=ta.call(this)||this;na.sk=ra;return na}function k(){}function l(){}function m(){this.G4=this.H4=this.OZ=this.PZ=this.Pwa=!1}function f(ra){var na=this;this.qGd=null;this.Xsd=this.pGd=this.CEb=!1;this.mEd=0;this.cEd=this.eEd=this.fEd=this.dEd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=
this.Hm=this.errorTypeNames=null;this.Rp=this.currentStateId=-1;this.eta="";this.N$=null;this.xzf=function(){na.setNumberFormats()};this.Yc=function(){B.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");na.Re=new Q.a;na.Rp=-1;na.currentStateId=-1;na.eta="";na.xrb=null;na.pGd=!1;na.Hm&&na.clearCache()};this.B4f=(this.Ec=ra)?ra.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.B4f;this.Re=new Q.a;this.xrb=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Ec.workbookContext.FullDocumentInfo.BreadcrumbDocName);
this.noa();this.Jnd=N.a.Jnd()}function w(ra){this.L2d=null;this.init(ra)}function n(){}function z(ra){this.m7=ra;this.P5=new M.a(T.a.Jk());this.wlc=!1}function r(ra){this.$dg=ra;this.Ofe=[];this.xbg=[];this.a_a={};this.IPd=new Map}function v(ra,na,ba,sa,ya){this.type=ra;this.fullName=na;this.range=ba;this.sheetId=sa;this.attributes=ya;this.nE=null}function A(ra,na){this.Oue=ra;this.sheetName=na;this.gvc=!1}u=b(0);var B=b(15),y=b(232),x=b(83),C=b(8),G=b(113),E=b(202),I=b(85);Object(u.a)(A,"CalcBlockInformation",
null,[]);Object(u.a)(v,"CalcNamedObject",null,[]);var U=b(22);r.prototype.i_f=function(ra,na){this.Ofe[ra]=na;this.$dg&&na.m7&&this.IPd.set(na.m7.sheetName,ra)};r.prototype.getSheetIndex=function(ra){if(this.$dg){if(this.IPd.has(ra))return this.IPd.get(ra)}else for(var na=1;na<this.yj.length;na++)if(U.a.equals(this.yj[na].m7.sheetName,ra,!1))return na;return-1};Af.Object.defineProperties(r.prototype,{yj:{configurable:!0,enumerable:!0,get:function(){return this.Ofe}}});Object(u.a)(r,"GridCache",null,
[]);var M=b(894),T=b(616);Object(u.a)(z,"SheetInformation",null,[]);var F=b(1147),K;(function(ra){ra[ra.initialization=0]="initialization";ra[ra.contentReady=1]="contentReady";ra[ra.cellEdit=2]="cellEdit"})(K||(K={}));Object(u.b)("UpdateDataTrigger",K);var J=b(64);n.local="Local";n.EIj="Thread";Object(u.a)(n,"RecalcServiceCreateMode",null,[]);var O=b(45),N=b(36),H=b(169),Q=b(171);w.prototype.init=function(ra){this.L2d=new Q.a;if(void 0!==ra&&null!==ra&&void 0!==ra.HeadersList&&null!==ra.HeadersList&&
0<ra.HeadersList.length){ra=ak(ra.HeadersList);for(var na=ra.next();!na.done;na=ra.next())na=na.value,this.u$.ia(na.Index,na.Name)}};Af.Object.defineProperties(w.prototype,{u$:{configurable:!0,enumerable:!0,get:function(){return this.L2d}}});Object(u.a)(w,"ColHeadersListData",null,[]);var ca=b(1),X=b(101),Z=b(21),ea=b(206);b(205);var ka=b(259);f.prototype.dispose=function(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.FId(this.xzf);this.Ec&&this.Ec.ol(this.Yc);
this.close()};f.prototype.Leb=function(ra){if(!this.Hm)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Ec.da.za(268),!this.instantaneousSupportInformationManager))return B.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==ra&&(this.currentStateId=this.Ec.ea.kjc,this.currentStateId===C.a.Fe&&(this.currentStateId=this.Ec.ea.Ve));if(1===ra&&this.currentStateId<this.Rp)return B.ULS.sendTraceTag(537170197,
0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.currentStateId,this.Rp),!1;this.lpj();0!==ra&&this.pGd||(this.Dtj(),this.Kqj(),this.vrj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.Zme(this.xzf),this.Ec.Tk(this.Yc),this.pGd=!0);this.h6i();var na=!1;0===ra&&(na=this.Q$h());if(0!==ra||na)this.Psj()?(this.stj(ra),this.rtj(),this.Rp=this.currentStateId,this.AXg()):B.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",
this.currentStateId);2!==ra&&this.resumeRecalc();return!0};f.prototype.evalFormula=function(ra){if(!this.Hm)return B.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});ra=this.Hm.evalFormula(this.Ec.ea.Ve,ra,J.d(this.Ec.va.pa));this.resumeRecalc();return ra};f.prototype.evalFormulaRange=function(ra,na,ba){if(!this.Hm)return B.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);B.ULS.shipAssertTag(537170193,
0,na.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");ba=O.j(ba);na=O.o(na,this.Ec);na=excelOnlineCalc.calc.cellLocation(na.FirstRow,na.FirstColumn);ba=f.mU("EvalFormulaRange",J.d(this.Ec.va.pa),ba.FirstRow,ba.FirstColumn,ba.LastRow,ba.LastColumn);B.ULS.sendTraceTag(537170190,0,50,"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.Rp);ra=this.Hm.evalFormulaRange(this.Rp,ra,na,ba,null);ra.then(function(sa){if(excelOnlineCalc.util.isSuccess(sa)){var ya=
[];sa=ak(sa.value);for(var va=sa.next();!va.done;va=sa.next())va=va.value,excelOnlineCalc.util.isSuccess(va.value)||(va=va.value.reason.kind.toString(),Array.contains(ya,va)||ya.push(va));B.ULS.sendTraceTag(537170191,0,50,"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",ya.length?Sys.Serialization.JavaScriptSerializer.serialize(ya):"None")}else B.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",
sa.reason.kind)}).catch(function(sa){B.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(sa));return Promise.reject(sa)});this.resumeRecalc();return ra};f.prototype.nTg=function(ra,na,ba,sa){sa=void 0===sa?null:sa;if(this.Hm&&ra){var ya=J.d(this.Ec.va.pa),va=ra.cell.YJ-1,W=ra.cell.XJ-1,La=va,Ia=W,mb=null;sa&&(mb=excelOnlineCalc.calc.cellLocation(va,W),va=sa.top-1,W=sa.left-1,La=sa.bottom-1,Ia=sa.right-1);if(ra.cell.Vt)if(sa=
ra.cell.Vt.RXc,sa===C.a.Fe)B.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",ra.cell.Vt.Kd);else if(sa<this.Rp)B.ULS.sendTraceTag(537170185,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",va,W,sa,this.Rp);else if(sa<this.currentStateId)B.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",
va,W,sa,this.currentStateId);else if(this.CEb||(this.Hm.setOnRecalcResults(ba),this.CEb=!0),this.kbg()&&!this.Leb(2))B.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{Ia=f.mU("CalculateFormula.cell",ya,va,W,La,Ia);ba=[];var fb=Z.g(this.Ec);La=fb.Ug;Z.g(this.Ec).eb.Ni&&(La=fb.Ef(1).Ug,La.kna(1,1),La.kna(3,1));fb=null;La?fb=f.mU("CalculateFormula.viewport",ya,La.top-1,La.left-1,La.bottom-1,La.right-1):B.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");
na=excelOnlineCalc.calc.inferredRangeFormulaEdit(Ia,na,mb,fb);ba.push(na);ra=La?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ya,va,W,U.a.e_b(ra.cell.text),sa,La.top-1,La.left-1,La.bottom-1,La.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ya,va,W,U.a.e_b(ra.cell.text),sa,"","","","");B.ULS.sendTraceTag(537170181,0,50,ra);
this.Hm.editRangeFormulas(sa,ba);this.resumeRecalc()}else B.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",ra.cell.YJ,ra.cell.XJ)}else B.ULS.sendTraceTag(537170188,0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",!this.Hm,!ra)};f.prototype.lTg=function(ra,na,ba,sa){sa=void 0===sa?null:sa;var ya=J.d(this.Ec.va.pa),va=ra.cell.YJ-1,W=ra.cell.XJ-1,La=va,Ia=W,mb=null;sa&&(mb=excelOnlineCalc.calc.cellLocation(va,
W),va=sa.top-1,W=sa.left-1,La=sa.bottom-1,Ia=sa.right-1);ba=this.XYd(ra,ba,"SetCell");0>ba||(Ia=f.mU("CalculateFormula.cell",ya,va,W,La,Ia),La=[],sa=this.Dgd(ya),na=excelOnlineCalc.calc.inferredRangeFormulaEdit(Ia,na,mb,sa),La.push(na),ra=(na=this.a3e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ya,va,W,U.a.e_b(ra.cell.text),ba,na.top-1,na.left-1,na.bottom-1,na.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
ya,va,W,U.a.e_b(ra.cell.text),ba,"","","",""),B.ULS.sendTraceTag(537170180,0,50,ra),this.Hm.editRangeFormulas(ba,La),this.resumeRecalc())};f.prototype.Xsb=function(ra,na,ba,sa){if(!this.Hm)return B.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");if(!ba||!na)return B.ULS.sendTraceTag(524120779,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone inputs are null. originCell null: "+!ba+", outputColumnRange null: "+!na),
Promise.reject("CalcAsyncEngine::EvalFormulaRangeOnClone: null inputs");B.ULS.shipAssertTag(537170178,0,ba.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var ya=J.d(this.Ec.va.pa),va=this.Dgd(ya),W=null;if(ra){W=[];ra=ak(ra);for(var La=ra.next();!La.done;La=ra.next())if(La=La.value,La.column!==ba.left){var Ia=La.row-1;var mb=La.column-1;Ia=f.mU("EvalFormulaRangeOnClone.cell",ya,Ia,mb,Ia,mb);mb=La.text;W.push(excelOnlineCalc.calc.rangeWrite(Ia,excelOnlineCalc.calc.valueCellData(mb,
mb,La.Xk,null)))}}ba=excelOnlineCalc.calc.cellLocation(ba.top-1,ba.left-1);na=f.mU("EvalFormulaRangeOnClone.outputColumnRange",ya,na.top-1,na.left-1,na.bottom-1,na.right-1);sa=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(na,sa,ba,va)];W=this.Hm.evalOnClonedModel(W,sa);this.resumeRecalc();return W};f.prototype.vEe=function(ra){var na=null;try{if(ra)if(this.eta=Z.g(this.Ec).Ea.Jua(ra),this.currentStateId=ra.wSa,this.currentStateId<this.Rp||this.currentStateId===C.a.Fe)B.ULS.sendTraceTag(537170176,
0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.eta,this.currentStateId,this.Rp);else{if(this.V$h(),!this.pOg()){var ba=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",this.eta,this.currentStateId);na=this.Ec.Fb.sc("ModelUpdate",ba);this.xrb=this.Qvb(ra.pa.sheetName);if(!this.xrb){var sa=!!(this.Ec.Bd&32);B.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",
this.Re.kb(this.currentStateId)&&this.Re.na(this.currentStateId).yj?this.Re.na(this.currentStateId).yj.length:0,sa,ra.pa.sheetName?ra.pa.sheetName.length:-1,ra.pa.hash)}else if(Z.g(this.Ec).Ea.im.n1a(ra.Kd)){var ya=ra.lf;if(ya){var va=ya.getCalcBlockModel();if(!va)B.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.hOg(va)){this.Re.na(this.currentStateId).a_a[this.eta]=new A(va,ra.pa.sheetName);var W=ra.me;W?this.EBg(W.NamedObjects):
B.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else B.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",this.eta)}}}else B.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{na&&na.stop()}};f.prototype.e4a=function(ra){if(!this.Re.na(this.currentStateId).yj||!this.Re.na(this.currentStateId).yj[0])return null;
var na=this.Re.na(this.currentStateId).yj[0].P5;if(!na||!na.kb(ra.name))return null;na=na.na(ra.name);if(!na||!na.nE)return null;ra=new E.a;na=ak(na.nE.u$);for(var ba=na.next();!ba.done;ba=na.next())ra.add(ba.value.value);return ra};f.prototype.getNameLoc=function(ra,na){return this.Ngc()?this.Re.na(this.currentStateId).yj[0].P5.kb(na)?(ra=excelOnlineCalc.location.nameLoc(ra,na),excelOnlineCalc.util.success(ra)):excelOnlineCalc.util.success(null):(ra=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ra))};
f.prototype.getContainingTable=function(ra){if(!this.Ngc())return ra=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ra);var na=ra.range.col,ba=ra.range.row,sa=this.Re.na(this.currentStateId).yj[0].P5,ya=null;sa=ak(sa);for(var va=sa.next();!va.done;va=sa.next())if(va=va.value.value,2===va.type&&U.a.equals(ra.sheet.index.toString(),va.sheetId,!0)){var W=va.range;na>=W.left-1&&na<=W.right-1&&ba<=W.bottom-1&&ba>=W.top-1&&(ya=excelOnlineCalc.location.nameScope(this.documentLoc,va.sheetId),
ya=excelOnlineCalc.location.nameLoc(ya,va.fullName))}return ya?excelOnlineCalc.util.success(ya):excelOnlineCalc.util.success(null)};f.prototype.getStructRefColumn=function(ra,na){if(!this.Ngc()){var ba=excelOnlineCalc.util.unavailable([2]);return excelOnlineCalc.util.failure(ba)}ba=ra.name;var sa=this.Re.na(this.currentStateId).yj[0].P5;if(sa.kb(ba)){sa=sa.na(ba);var ya=sa.range;if(2!==sa.type)return excelOnlineCalc.util.failure(this.k3c(5));var va=sa.nE?sa.nE.u$:null;if(!va)return excelOnlineCalc.util.success(null);
for(var W=ak(va),La=W.next();!La.done;La=W.next())if(La=La.value,U.a.equals(La.value,na,!0))return ra=excelOnlineCalc.location.documentLoc(ra.scope.document.path,ra.scope.document.name),ra=excelOnlineCalc.location.sheetIndex(ra,sa.sheetId),ya=excelOnlineCalc.location.gridRange(ya.top-1,La.key,ya.bottom-ya.top+1,1),ya=excelOnlineCalc.location.sheetGridRange(ra,ya),ba=excelOnlineCalc.location.structRefColumnLoc(ba,ya,!!(sa.attributes&16),!!(sa.attributes&8)),excelOnlineCalc.util.success(ba);return ya.right-
ya.left+1!==va.count?(ba=excelOnlineCalc.util.unavailable([17,ra,na]),excelOnlineCalc.util.failure(ba)):excelOnlineCalc.util.failure(this.k3c(0))}return excelOnlineCalc.util.success(null)};f.prototype.getStructRefSpecialRef=function(ra,na){if(!this.Ngc())return na=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(na);var ba=this.Re.na(this.currentStateId).yj[0].P5;if(ba.kb(ra.name)){var sa=ba.na(ra.name);if(2!==sa.type)return excelOnlineCalc.util.failure(this.k3c(5));ba=!!(sa.attributes&
16);var ya=!!(sa.attributes&8),va=ba?1:0,W=ya?1:0;ra=excelOnlineCalc.location.documentLoc(ra.scope.document.path,ra.scope.document.name);ra=excelOnlineCalc.location.sheetIndex(ra,sa.sheetId);sa=sa.range;var La={};if(1===na)La=excelOnlineCalc.location.gridRange(sa.top-va-1,sa.left-1,sa.bottom+W-sa.top+va+1,sa.right-sa.left+1);else if(2===na)La=excelOnlineCalc.location.gridRange(sa.top-1,sa.left-1,sa.bottom-sa.top+1,sa.right-sa.left+1);else if(3===na)if(ba)La=excelOnlineCalc.location.gridRange(sa.top-
2,sa.left-1,1,sa.right-sa.left+1);else return excelOnlineCalc.util.success(null);else if(4===na)if(ya)La=excelOnlineCalc.location.gridRange(sa.bottom,sa.left-1,1,sa.right-sa.left+1);else return excelOnlineCalc.util.success(null);na=excelOnlineCalc.location.sheetGridRange(ra,La);return excelOnlineCalc.util.success(na)}return excelOnlineCalc.util.success(null)};f.prototype.getDocumentLoc=function(ra,na){if((U.a.equals(ra,this.documentLoc.path,!0)||!ra)&&U.a.equals(na,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);
ra=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(ra,na)]);return excelOnlineCalc.util.failure(ra)};f.prototype.getSheetIndex=function(ra,na){if(!this.Re.kb(this.currentStateId)||!this.Re.na(this.currentStateId).yj)return na=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(na);ra=this.Re.na(this.currentStateId).yj;for(var ba=1;ba<ra.length;ba++)if(U.a.equals(ra[ba].m7.sheetName,na,!0))return excelOnlineCalc.util.success(ra[ba].m7.sheetId);return excelOnlineCalc.util.success(null)};
f.prototype.getSheetName=function(ra,na){if(!this.Re.kb(this.currentStateId)||!this.Re.na(this.currentStateId).yj)return na=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(na);ra=this.Re.na(this.currentStateId).yj;for(var ba=1;ba<ra.length;ba++)if(U.a.equals(ra[ba].m7.sheetId,na,!0))return excelOnlineCalc.util.success(ra[ba].m7.sheetName);return excelOnlineCalc.util.success(null)};f.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};
f.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};f.prototype.mTg=function(ra,na,ba){var sa=Z.g(this.Ec),ya=sa.Ub(na);ya=this.XYd(ya,null,"CopyPaste");ba=this.XYd(sa.Ub(ra),ba,"CopyPaste");if(0>ya||0>ba||ya!==ba)B.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",ba,ya);else{ba=[];sa=J.d(this.Ec.va.pa);
var va=this.Dgd(sa);ra=f.mU("CalculateFormulaForCopyPaste.srcRange",sa,ra.top-1,ra.left-1,ra.bottom-1,ra.right-1);na=f.mU("CalculateFormulaForCopyPaste.targetRange",sa,na.top-1,na.left-1,na.bottom-1,na.right-1);na=excelOnlineCalc.calc.copyPasteRangePasteEdit(na,ra,va);ba.push(na);na=va?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",sa,ya,va.row,va.column,va.lastRow,va.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",
sa,ya,"","","","");B.ULS.sendTraceTag(537170142,0,50,na);this.Hm.editRangePaste(ya,ba);this.resumeRecalc()}};f.prototype.Dgd=function(ra){var na=this.a3e(),ba=null;na?ba=f.mU("GetViewport.viewport",ra,na.top-1,na.left-1,na.bottom-1,na.right-1):B.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return ba};f.prototype.a3e=function(){var ra=Z.g(this.Ec),na=ra.Ug;if(Z.g(this.Ec).eb.Ni){na=ra.Ef(1).Ug;if(ca.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&
!na)return B.ULS.sendTraceTag(537170140,0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;na.kna(1,1);na.kna(3,1)}return na};f.prototype.XYd=function(ra,na,ba){if(!this.Hm||!ra)return B.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Hm,!ra,ba),-1;var sa=ra.cell.YJ-1,ya=ra.cell.XJ-1;if(ra.cell.Vt){var va=ra.cell.Vt.RXc;if(va===C.a.Fe)return B.ULS.sendTraceTag(537170138,0,
15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",ra.cell.Vt.Kd,ba),-1}else return B.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",ra.cell.YJ,ra.cell.XJ,ba),-1;if(va<this.Rp)return B.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",
sa,ya,va,this.Rp,ba),-1;if(va<this.currentStateId)return B.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",sa,ya,va,this.currentStateId,ba),-1;na&&!this.CEb&&(this.Hm.setOnRecalcResults(na),this.CEb=!0);return this.kbg()&&!this.Leb(2)?(B.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",ba),-1):va};f.prototype.getFormulaBarText=
function(ra,na,ba){return na&&na.startsWith("'")?na:ra.cell.formulaBarText||ba.toString()};f.prototype.U8g=function(ra,na,ba){var sa=null;if(this.xve()&&this.Re.na(this.Rp).a_a){var ya=this.Re.na(this.Rp).a_a[ra];if(null===ya||void 0===ya?0:ya.gvc)sa=ya.Oue}ba=this.Lei(sa,na,ba);na=this.b0g(sa,na,ba);B.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",ra,this.currentStateId,na)};f.prototype.Lei=function(ra,
na,ba){var sa=!1,ya=f.tWe(na);if(ra){var va=f.tWe(ra);U.a.equals(va,ya,!1)&&(sa=!0)}sa?this.gCg(ra,this.Rp,ba):this.iCg(na,ba);return sa};f.prototype.xve=function(){var ra=!1;this.Hm&&-1!==this.Rp&&(ra=this.Hm.stateIdAvailable(this.Rp));return ra&&this.Re.kb(this.Rp)&&this.Rp<this.currentStateId};f.prototype.b0g=function(ra,na,ba){var sa=0;var ya,va;for(na.reset();ya=na.getNextCell();)ea.f(ya.formula)&&sa++,(va=ba?ra.getCell(ya.row,ya.col):null)?this.Y_g(na,ya,va):this.hCg(na,ya);if(ba)for(ra.reset();va=
ra.getNextCell();)(ya=na.getCell(va.row,va.col))||this.nle(ra,va);return sa};f.prototype.vrj=function(){this.Hm.setOnUpdateRequest(function(){})};f.prototype.urj=function(){var ra=this;this.Hm.setOnUnresponsive(function(na,ba,sa,ya){ra.xTi(na,ba,sa,ya)})};f.prototype.xTi=function(ra,na,ba,sa){B.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",ra,na,ba,sa);sa&&(this.lgj(),this.noa())};f.prototype.lgj=
function(){this.Yc(null,null);this.Xsd=this.CEb=!1;this.mEd=0;this.cEd=this.eEd=this.fEd=this.dEd=-1};f.prototype.close=function(){this.Hm.close()};f.prototype.clearCache=function(){this.Hm.clearCache()};f.prototype.resumeRecalc=function(){this.Hm.resumeRecalc()};f.prototype.Kqj=function(){this.Hm.setA1ReferenceStyle(!0)};f.prototype.h6i=function(){if(this.instantaneousSupportInformationManager){var ra=this.instantaneousSupportInformationManager.bci,na=this.instantaneousSupportInformationManager.eci,
ba=this.instantaneousSupportInformationManager.dci,sa=this.instantaneousSupportInformationManager.cci,ya=!1;ra!==this.dEd&&(ya=!0,this.dEd=ra);na!==this.fEd&&(ya=!0,this.fEd=na);ba!==this.eEd&&(ya=!0,this.eEd=ba);sa!==this.cEd&&(ya=!0,this.cEd=sa);var va=[];ca.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(ya=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),va.push(ya),ya=!0);ca.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",
!1)&&(ya=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),va.push(ya),ya=!0);ca.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(ya=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),va.push(ya),ya=!0);ya&&(ra=excelOnlineCalc.calc.recalcServiceConfig(null,ra,null,na,null,null,null,ba,va,sa),this.Hm.reconfigure(ra))}};f.prototype.stj=function(ra){var na=this,ba=null;if(this.Re.kb(this.currentStateId))try{this.N$=[];var sa=
String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,K[ra]);ba=this.Ec.Fb.sc("ModelUpdate",sa);G.a.forEach(this.Re.na(this.currentStateId).a_a,function(ya,va){va.gvc||(na.U8g(ya,va.Oue,va.sheetName),va.gvc=!0)},null);this.Hm.updateRanges(this.currentStateId,this.N$)}finally{ba&&ba.stop()}else B.ULS.sendTraceTag(537170122,0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};f.prototype.rtj=function(){var ra=
[],na=this.xve(),ba=na&&this.Re.na(this.Rp).yj&&this.Re.na(this.Rp).yj[0]&&this.Re.na(this.Rp).yj[0].wlc?this.Re.na(this.Rp).yj[0].P5:null;this.dAe(ba,this.Re.na(this.currentStateId).yj[0].P5,null,this.Rp,ra);this.Re.na(this.currentStateId).yj[0].wlc=!0;for(var sa=1;sa<this.Re.na(this.currentStateId).yj.length;sa++)ba=-1,na&&this.Re.na(this.Rp).yj&&(ba=this.Mfd(this.Re.na(this.currentStateId).yj[sa].m7.sheetName,this.Rp)),ba=-1!==ba&&this.Re.na(this.Rp).yj[ba].wlc?this.Re.na(this.Rp).yj[ba].P5:null,
this.dAe(ba,this.Re.na(this.currentStateId).yj[sa].P5,this.Re.na(this.currentStateId).yj[sa].m7.sheetId,this.Rp,ra),this.Re.na(this.currentStateId).yj[sa].wlc=!0;this.Hm.updateNamedObjects(this.currentStateId,ra)};f.prototype.dAe=function(ra,na,ba,sa,ya){if(void 0!==ba&&null!==ba){var va=excelOnlineCalc.calc.undefinedNamesWrite(ba);ya.push(va)}if(ra){var W=!1,La=[];va=[];if(na)for(var Ia=ak(na),mb=Ia.next();!mb.done;mb=Ia.next()){mb=mb.value;var fb=mb.value;if(ra.kb(mb.key)){var Ma=ra.na(mb.key);
f.kDi(Ma,fb)?W=!0:(Ma=excelOnlineCalc.calc.namedObject(mb.key,null),La.push(Ma),f.XTc(mb.key,fb,va))}else f.XTc(mb.key,fb,va)}ra=ak(ra);for(mb=ra.next();!mb.done;mb=ra.next())Ia=mb.value,na&&na.kb(Ia.key)||(Ia=excelOnlineCalc.calc.namedObject(Ia.key,null),La.push(Ia));W&&(na=excelOnlineCalc.calc.namedObjectsPromote(ba,sa),ya.push(na));0<La.length&&(na=excelOnlineCalc.calc.namedObjectsWrite(ba,La),ya.push(na));0<va.length&&(ba=excelOnlineCalc.calc.namedObjectsWrite(ba,va),ya.push(ba))}else if(na){va=
[];na=ak(na);for(sa=na.next();!sa.done;sa=na.next())sa=sa.value,f.XTc(sa.key,sa.value,va);0<va.length&&(ba=excelOnlineCalc.calc.namedObjectsWrite(ba,va),ya.push(ba))}};f.prototype.pOg=function(){return this.Re.na(this.currentStateId).a_a[this.eta]?(B.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.eta,this.currentStateId),!0):!1};f.prototype.hOg=function(ra){return 1===ra.getColumnNumbers().length&&ra.getColumnNumbers()[0]===
f.nvd+1?!1:!0};f.prototype.Q$h=function(){var ra=this,na=!1;Z.g(this.Ec).Ea.Lad(function(ba){ba.state&1&&ra.Ec.ea.Ve===ba.je.Revision&&(ra.vEe(ba),na=!0)});return na};f.prototype.rCe=function(ra,na){var ba=ra.getRowNumbers(),sa=ra.getColumnNumbers();ra=ba[0]-1;ba=ba[ba.length-1]-1;var ya=sa[0]-1;sa=sa[sa.length-1]-1;(na=this.Qvb(na))||B.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",this.Re.kb(this.currentStateId)&&this.Re.na(this.currentStateId).yj?
this.Re.na(this.currentStateId).yj.length:0);return f.mU("CreateBlockRangeLocation",na,ra,ya,ba,sa)};f.prototype.gCg=function(ra,na,ba){if(ba=this.rCe(ra,ba)){var sa=f.n4b(ra.getRowNumbers());ra=f.n4b(ra.getColumnNumbers());na=excelOnlineCalc.calc.rangePromote(ba,na,sa,ra);this.N$[this.N$.length]=na}};f.prototype.iCg=function(ra,na){if(na=this.rCe(ra,na)){var ba=f.n4b(ra.getRowNumbers());ra=f.n4b(ra.getColumnNumbers());ra=excelOnlineCalc.calc.rangeWrite(na,null,ba,ra);this.N$[this.N$.length]=ra}};
f.prototype.Y_g=function(ra,na,ba){var sa=null,ya=0,va=0;switch(na.valueType){case 2:sa=this.Agd(na);var W=this.Agd(ba);W=U.a.equals(W,sa,!1);break;case 1:null===na.value&&null===ba.value?W=!0:(ya=parseFloat(na.value),W=parseFloat(ba.value)===ya);break;default:null===na.value&&null===ba.value?W=!0:(va=parseFloat(na.value),W=va===parseFloat(ba.value))}W&&na.valueType===ba.valueType&&na.ifmt===ba.ifmt&&na.formulaType===ba.formulaType&&U.a.equals(ba.formula,na.formula,!1)||(void 0!==na.formula&&null!==
na.formula||void 0!==na.value&&null!==na.value||void 0!==na.text&&null!==na.text?this.KYb(ra,na,sa,ya,va):this.nle(ra,na))};f.prototype.EBg=function(ra){if(this.Ec.vb&&this.Ec.vb.items)for(var na=0;na<this.Ec.vb.count;na++){var ba=this.Ec.vb.items[na];if(2===ba.type||3===ba.type){var sa=0,ya=ba.name,va=ya.lastIndexOf("!");if(0<va){sa=ya.substr(0,va);"'"===sa.charAt(0)&&(sa=sa.substr(1,sa.length-2));sa=this.Mfd(sa,this.currentStateId);if(-1===sa){B.ULS.sendTraceTag(595096334,0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",
this.Re.kb(this.currentStateId)&&this.Re.na(this.currentStateId).yj?this.Re.na(this.currentStateId).yj.length:0);continue}ya=ya.substr(va+1)}sa=this.Re.na(this.currentStateId).yj[sa].P5;var W=ba.usedRange;2===ba.type&&(W=H.a(ba));if(sa.kb(ya)){if(va=sa.na(ya),va.range=W,va.attributes=ba.attributes,2===va.type&&(ya=f.BSe(ba.name,ra),ba=(sa=ca.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?ba.sO:null===ya||void 0===ya?void 0:ya.ColHeadersList,ya||sa))if(!va.nE)va.nE=
new w(ba);else if(ba)for(ba=ak(ba.HeadersList),ya=ba.next();!ya.done;ya=ba.next())ya=ya.value,va.nE.u$.ia(ya.Index,ya.Name)}else if(va=this.Qvb(ba.sheetName)){va=new v(ba.type,ba.name,W,va,ba.attributes);if(2===va.type)if(ca.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&ba.sO)va.nE=new w(ba.sO);else if(ba=f.BSe(ba.name,ra))va.nE=new w(ba.ColHeadersList);sa.ia(ya,va)}else B.ULS.sendTraceTag(537170117,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",
this.Re.kb(this.currentStateId)&&this.Re.na(this.currentStateId).yj?this.Re.na(this.currentStateId).yj.length:0)}}};f.prototype.KYb=function(ra,na,ba,sa,ya){var va=ra.getRowNumbers()[na.row]-1;ra=ra.getColumnNumbers()[na.col]-1;va=f.mU("AddRangeUpdateCommand",this.xrb,va,ra,va,ra);ra=null;var W=na.formula||na.text,La=excelOnlineCalc.calc.blankValue,Ia=null;void 0!==na.text&&null!==na.text||void 0!==na.value&&null!==na.value||(ba="",Ia="This cell contains blanks only",0===na.formulaType&&(W=""));switch(na.valueType){case 2:null!==
ba&&(0===na.formulaType&&(ra=excelOnlineCalc.calc.valueCellData(W,ba,na.ifmt,Ia)),1===na.formulaType&&(ra=excelOnlineCalc.calc.cellFormulaCellData(W,ba,na.ifmt,Ia)),2===na.formulaType&&(ra=excelOnlineCalc.calc.valueCellData("",La,0,"This cell is a part of an array")));break;case 1:isNaN(sa)?B.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",na.row,na.col):(0===na.formulaType&&(ra=excelOnlineCalc.calc.valueCellData(W,sa,na.ifmt,null)),1===
na.formulaType&&(ra=excelOnlineCalc.calc.cellFormulaCellData(W,sa,na.ifmt,null)),2===na.formulaType&&(ra=excelOnlineCalc.calc.valueCellData("",La,0,"This cell is a part of an array")));break;case 3:isNaN(ya)?B.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",na.row,na.col):(ba=1===ya?!0:!1,0===na.formulaType&&(ra=excelOnlineCalc.calc.valueCellData(W,ba,na.ifmt,null)),1===na.formulaType&&(ra=excelOnlineCalc.calc.cellFormulaCellData(W,ba,na.ifmt,
null)),2===na.formulaType&&(ra=excelOnlineCalc.calc.valueCellData("",La,0,"This cell is a part of an array")));break;case 4:isNaN(ya)?B.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",na.row,na.col):(ba=excelOnlineCalc.calc.errorValue(ya),0===na.formulaType&&(ra=excelOnlineCalc.calc.valueCellData(W,ba,na.ifmt,null)),1===na.formulaType&&(ra=excelOnlineCalc.calc.cellFormulaCellData(W,ba,na.ifmt,null)),2===na.formulaType&&(ra=excelOnlineCalc.calc.valueCellData("",
La,0,"This cell is a part of an array")));break;default:ra=excelOnlineCalc.calc.valueCellData("",La,na.ifmt,null)}ra&&(na=excelOnlineCalc.calc.rangeWrite(va,ra,null,null),this.N$[this.N$.length]=na)};f.prototype.hCg=function(ra,na){switch(na.valueType){case 2:this.KYb(ra,na,this.Agd(na),null,0);break;case 1:this.KYb(ra,na,null,parseFloat(na.value),0);break;default:this.KYb(ra,na,null,null,parseFloat(na.value))}};f.prototype.nle=function(ra,na){var ba=ra.getRowNumbers()[na.row]-1;ra=ra.getColumnNumbers()[na.col]-
1;ba=f.mU("AddRangeUpdateCommandEmptyCell",this.xrb,ba,ra,ba,ra);na=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,na.ifmt,null);na=excelOnlineCalc.calc.rangeWrite(ba,na,null,null);this.N$[this.N$.length]=na};f.prototype.Qvb=function(ra){ra=this.Mfd(ra,this.currentStateId);return 0<ra?this.Re.na(this.currentStateId).yj[ra].m7.sheetId:null};f.prototype.Mfd=function(ra,na){if(!this.Re.kb(na))return B.ULS.sendTraceTag(537170113,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",
na),-1;var ba=this.Re.na(na);return ba.yj?ba.getSheetIndex(ra):(B.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",na),-1)};f.prototype.Psj=function(){if(!this.Re.kb(this.currentStateId)||!this.Re.na(this.currentStateId).yj.length)return B.ULS.sendTraceTag(537170083,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var ra=[],na=
1;na<this.Re.na(this.currentStateId).yj.length;na++){var ba=this.Re.na(this.currentStateId).yj[na];ba&&ra.push(ba.m7)}this.Hm.updateSheetNames(this.currentStateId,ra);this.Hm.updateUnusedCells(this.currentStateId,this.Re.na(this.currentStateId).xbg);return!0};f.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var ra=[],na=ak(this.instantaneousSupportInformationManager.$xa),ba=na.next();!ba.done;ba=na.next())ba=ba.value,ba=excelOnlineCalc.calc.numberFormat(ba.IfmtIndex,
ba.FormatString,ba.Builtin),ra.push(ba);this.Hm.setNumberFormats(ra,!0)}};f.prototype.lpj=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.xe){var ra=this.T$h();if(!this.Xsd||ra)this.m4b(),this.instantaneousSupportInformationManager.xe.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.xe.TrueValueString),this.instantaneousSupportInformationManager.xe.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.xe.FalseValueString),
ra=F.CalcHelper.mDe(this.instantaneousSupportInformationManager,ra),this.Hm.setLocale(ra),this.Xsd=!0}};f.prototype.Dtj=function(){var ra=null;if(void 0!==this.Ec.workbookContext.TimeZoneInformation&&null!==this.Ec.workbookContext.TimeZoneInformation){ra=null;this.Ec.workbookContext.TimeZoneInformation.StandardDate.Month&&(ra=excelOnlineCalc.date.dateTime(this.Ec.workbookContext.TimeZoneInformation.StandardDate.Year,this.Ec.workbookContext.TimeZoneInformation.StandardDate.Month,this.Ec.workbookContext.TimeZoneInformation.StandardDate.Day,
this.Ec.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Ec.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Ec.workbookContext.TimeZoneInformation.StandardDate.Second,this.Ec.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Ec.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var na=null;this.Ec.workbookContext.TimeZoneInformation.DaylightDate.Month&&(na=excelOnlineCalc.date.dateTime(this.Ec.workbookContext.TimeZoneInformation.DaylightDate.Year,
this.Ec.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Ec.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Ec.workbookContext.TimeZoneInformation.DaylightDate.Hour,this.Ec.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Ec.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Ec.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Ec.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));ra=excelOnlineCalc.date.tzData(this.Ec.workbookContext.TimeZoneInformation.Bias,
ra,this.Ec.workbookContext.TimeZoneInformation.StandardBias,na,this.Ec.workbookContext.TimeZoneInformation.DaylightBias)}else B.ULS.sendTraceTag(537170082,0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");ra=excelOnlineCalc.calc.workbookProps(this.Ec.workbookContext.F1904,this.Ec.workbookContext.FDateCompatibility,ra);this.Hm.setWorkbookProps(ra)};f.prototype.noa=function(){var ra=this;ca.EwaSettings.ma(306)&&ka.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.B4f,!0)).continueWith(function(ya){ya.exception?
B.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",ya.exception.toString()):B.ULS.sendTraceTag(537170080,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var na=ca.EwaSettings.ma(659)?n.local:n.EIj,ba=ak(N.a.rV()?[excelOnlineCalc.x10.PluginSchedulerSingleton.instance(),excelOnlineCalc.x10.GridImportManagerSingleton.instance()]:[void 0,void 0]),sa=ba.next().value;ba=ba.next().value;this.qGd=ka.c(excelOnlineCalc.calc.createRecalcService(na,
sa,ba));this.qGd.continueWith(function(ya){ya.exception?B.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",ya.exception.toString()):(B.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),ra.Hm=ra.qGd.result,ra.Hm?ra.Leb(0)?ra.urj():B.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):B.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};
f.prototype.T$h=function(){var ra=this.instantaneousSupportInformationManager.dja;if(!ra||this.mEd===ra.length)return null;this.mEd=ra.length;return F.CalcHelper.ZCe(ra)};f.prototype.m4b=function(){this.errorTypeNames=F.CalcHelper.m4b()};f.prototype.V$h=function(){if(!(this.Re.kb(this.currentStateId)&&0<this.Re.na(this.currentStateId).yj.length)){this.Re.ia(this.currentStateId,new r(this.Jnd));this.Re.na(this.currentStateId).i_f(0,new z(null));for(var ra=this.Ec.va,na=0;na<ra.count;na++){var ba=Object(I.a)(X.a,
ra.getItem(na));if(ba){void 0!==ba.sheetId&&null!==ba.sheetId&&void 0!==ba.name&&null!==ba.name&&ba.sheetId.length&&ba.sheetName.length||B.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",na,ba.sheetId,ba.hash,ba.name?ba.name.length:-1);var sa=excelOnlineCalc.calc.sheetName(ba.sheetId,ba.name);this.Re.na(this.currentStateId).i_f(na+1,new z(sa));sa=ba.usedRange.oS();sa=excelOnlineCalc.calc.rangeLocation(0,0,sa.LastRow,
sa.LastColumn);ba=excelOnlineCalc.calc.unusedCellsUpdate(ba.sheetId,sa);Array.add(this.Re.na(this.currentStateId).xbg,ba)}else B.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,na)}}};f.prototype.AXg=function(){for(var ra=ak(this.Re),na=ra.next();!na.done;na=ra.next())na=na.value,na.key<this.Rp&&this.Re.remove(na.key)};f.prototype.Agd=function(ra){ra=ra.value||ra.text;if(void 0===ra||null===ra)ra="";return ra};
f.prototype.kbg=function(){if(!this.Re.kb(this.currentStateId))return!1;var ra=!1;G.a.forEach(this.Re.na(this.currentStateId).a_a,function(na,ba){ba.gvc||(ra=!0)},null);return ra};f.prototype.k3c=function(ra){var na={};na.reason=ra;na.kind=1;return na};f.prototype.Ngc=function(){return this.Re.kb(this.currentStateId)&&this.Re.na(this.currentStateId).yj&&this.Re.na(this.currentStateId).yj[0]&&this.Re.na(this.currentStateId).yj[0].P5?!0:!1};f.Y4g=function(ra){var na=[];if(null===ra||void 0===ra?0:ra.u$){ra=
ak(ra.u$);for(var ba=ra.next();!ba.done;ba=ra.next())ba=ba.value,ba=excelOnlineCalc.calc.columnData(ba.key,ba.value),na.push(ba)}return na};f.kDi=function(ra,na){if(ra.type!==na.type||ra.attributes!==na.attributes||!U.a.equals(ra.fullName,na.fullName,!1)||!ra.range.equals(na.range))return!1;if(!ra.nE&&!na.nE)return!0;if(!ra.nE||!na.nE||ra.nE.u$.count!==na.nE.u$.count)return!1;var ba={};ra=ak(ra.nE.u$);for(var sa=ra.next();!sa.done;ba={Nfb:ba.Nfb,Ufb:ba.Ufb},sa=ra.next())if(ba.Nfb=sa.value,ba.Ufb=
void 0,!(ba.Nfb.value&&function(ya){return function(){var va=na.nE.u$.zc(ya.Nfb.key);ya.Ufb=va.value;return va}}(ba)().returnValue&&ba.Ufb&&U.a.equals(ba.Nfb.value,ba.Ufb,!1)))return!1;return!0};f.XTc=function(ra,na,ba){var sa=f.mU("NamedObject",na.sheetId,na.range.top-1,na.range.left-1,na.range.bottom-1,na.range.right-1);if(2===na.type){var ya=!!(na.attributes&16),va=!!(na.attributes&8);na=f.Y4g(na.nE);sa=excelOnlineCalc.calc.namedTableData(sa,ya,va,na);ra=excelOnlineCalc.calc.namedObject(ra,sa)}else sa=
excelOnlineCalc.calc.namedRangeData(sa),ra=excelOnlineCalc.calc.namedObject(ra,sa);ba.push(ra)};f.tWe=function(ra){var na=Sys.Serialization.JavaScriptSerializer.serialize(ra.getRowNumbers());ra=Sys.Serialization.JavaScriptSerializer.serialize(ra.getColumnNumbers());return na+ra};f.n4b=function(ra){var na=null;if(1<ra.length)for(var ba=1;ba<ra.length;ba++)for(var sa=0;ra[ba-1]+1+sa<ra[ba];)na=na||[],na.push(ra[ba-1]+sa),sa++;return na};f.BSe=function(ra,na){if(!na)return null;for(var ba=0,sa=na.length;ba<
sa;++ba)if(U.a.equals(ra,na[ba].Name,!1))return na[ba];return null};f.mU=function(ra,na,ba,sa,ya,va){function W(La,Ia,mb,fb){(0>mb||mb>=fb)&&B.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",La,Ia,mb)}void 0!==na&&null!==na||B.ULS.sendTraceTag(537170071,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",ra);W(ra,"top",ba,f.Sof);W(ra,"left",sa,f.nvd);W(ra,"bottom",ya,f.Sof);W(ra,"right",va,f.nvd);return excelOnlineCalc.calc.sheetRangeLocation(na,
ba,sa,ya,va)};f.Sof=1048576;f.nvd=16384;Object(u.a)(f,"CalcAsyncEngine",null,[10]);Object(u.a)(m,"AbsoluteRelativeReferenceInfo",null,[]);var Y=b(1185),qa=b(24);l.VGf="#";Object(u.a)(l,"Operators",null,[]);var fa=b(1186);k.sheet="Sheet";k.sheetRange="SheetRange";k.document="Document";k.C7h="Ident";Object(u.a)(k,"TraverseFormulaQualifierTypes",null,[]);var ha=b(1187),ia=b(1083),wa=b(1002),Qa=b(58),S=b(63),da=b(445),xa=b(38),ta=Sys.EventArgs;Rk(e,ta);Object(u.a)(e,"EditedCellRecalcCompleteEventArgs",
Sys.EventArgs,[]);var ab=xa.a;Rk(d,ab);d.prototype.vEg=function(ra){this.addHandler(d.a7c,ra)};d.prototype.Paj=function(ra){this.removeHandler(d.a7c,ra)};d.prototype.Crf=function(ra){this.raiseEvent(d.a7c,new e(ra))};d.prototype.dispose=function(){var ra=this;B.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.da.Za(268,function(na){na.FId(ra.qnc);na.wId(ra.Xmc)});this.gridView&&(this.gridView.Fw(this.onContentReady),this.gridView.Ea&&this.gridView.Ea.hPf(this.Ktf),this.Pq=null);
this.AFc=null};d.prototype.oTg=function(ra,na,ba,sa){sa=void 0===sa?null:sa;this.yl&&(ca.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?this.yl.lTg(ra,na,ba,sa):this.yl.nTg(ra,na,ba,sa))};d.prototype.evalFormula=function(ra){return this.yl?this.yl.evalFormula(ra):Promise.reject("calc engine not initialized")};d.prototype.evalFormulaRange=function(ra,na,ba){return this.yl?this.yl.evalFormulaRange(ra,na,ba):Promise.reject("calc engine not initialized")};d.prototype.Xsb=
function(ra,na,ba,sa){return this.yl?this.yl.Xsb(ra,na,ba,sa):Promise.reject("CalcEngine is null")};d.prototype.e4a=function(ra){return this.yl?(B.ULS.shipAssertTag(537170059,0,2===ra.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.yl.e4a(ra)):null};d.prototype.HIg=function(ra,na){if(!na||2!==ra.type)return!1;ra=H.a(ra);return ra.right-ra.left+1===na.count};d.prototype.hRe=function(ra){if(!this.xFb)return this.Ifg||B.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),
null;var na=this.Tsa(qa.Range.Tc(1,1));na=this.xFb.parseFormula(excelOnlineCalc.parse.parseLocals(1,na.range),ra);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(na))return B.ULS.sendTraceTag(537170056,0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(ca.EwaSettings.isChangeGateEnabled("OfficeVSO:6518739_FlightRemovalStructuredReferencesHighlighting")){var ba=this.gridView.ha.sa.activeCell,sa=excelOnlineCalc.location.gridCell(ba.top-1,ba.left-1),ya=excelOnlineCalc.location.documentLoc("",
this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),va=excelOnlineCalc.location.sheetIndex(ya,this.$.va.pa.sheetId),W=this.p9g(sa,va);this.HKd||(this.HKd=excelOnlineCalc.util.createResolver(this.o9g()));var La=excelOnlineCalc.parse.parseResultHelper.extractReferences(na,this.Er.config.localeInfo,ca.EwaSettings.ma(596),W,this.HKd)}else La=excelOnlineCalc.parse.parseResultHelper.extractReferences(na,this.Er.config.localeInfo,ca.EwaSettings.ma(596));ca.EwaSettings.ma(103)&&this.JSj(La,ra);return La}catch(Ia){return B.ULS.sendTraceTag(537170055,
0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",Ia.message),null}};d.prototype.extractLetVariables=function(ra,na){if(!this.xFb)return this.Ifg||B.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var ba=this.Tsa(qa.Range.Tc(1,1));ra=this.xFb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ba.range),ra);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ra))return B.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),
null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(ra,na,this.Er.config.localeInfo)}catch(sa){return B.ULS.sendTraceTag(537170052,0,10,"CalcManager.ExtractLetVariables - exception: {0}",sa.message),null}};d.prototype.extractReferences=function(ra,na,ba,sa){if(!na)return B.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!ba)return B.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var ya=
this.hRe(ra);if(!ya)return B.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.n8g(ya,na,ba,ra,sa)}catch(va){return B.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",va.message),null}};d.prototype.YXh=function(ra,na,ba,sa){if(!ra)return B.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!na||0>=na.length)return B.ULS.sendTraceTag(537170018,
0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;ra=this.Tsa(ra);if(!this.Er||!ra)return null;var ya=this.Dub(ra).returnValue;if(!ya||ya.O5a)return null;ba=excelOnline.utils.getCharIndexInTextFromPoint(ba,sa,ca.EwaSettings.ma(596));return 0>ba?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Er.config,ba,na,ra)};d.prototype.bTg=function(ra,na,ba,sa){var ya=this;if(!ra)return B.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),
null;var va=null;return this.evalFormula(na).then(function(W){var La=ya.Er.Xlh(W,ba),Ia=La.returnValue;8!==La.kind||Ia.length&&Ia!==F.CalcHelper.unknownError?W=0:(B.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),W=excelOnlineCalc.calc.getEvalFailureReason(W),void 0!==W&&null!==W||B.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),W=1);return va=sa?new Y.a(Ia,sa.start,
sa.end,W):new Y.a(Ia,-1,-1,W)},function(W){B.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",W);return Promise.resolve(va)})};d.prototype.getSubExpressionSpan=function(ra){return this.Er&&ra?excelOnlineCalc.runtime.getSubExpressionSpan(ra):null};d.prototype.getFormulaSubExpressionObject=function(ra,na,ba){return this.Er&&ra&&na&&ba?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Er.config,na,ba,this.Tsa(ra)):null};d.prototype.aYh=function(ra,
na,ba){return this.Er&&ra&&na?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Er.config,na,ba,this.Tsa(ra)):null};d.prototype.ZXh=function(ra,na,ba){return this.Er&&ra&&na?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Er.config.localeInfo,na,ba):null};d.prototype.gRh=function(){return this.Er?this.Er.config.localeInfo.listSeparator:null};d.prototype.isFormulaSubExpressionVolatile=function(ra){return this.Er?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Er.config.localeInfo,
ra):!1};d.prototype.Tsa=function(ra,na){na=void 0===na?!0:na;return ra&&this.Er?this.Er.N9g(this.Er.Cah(),ra.top-1,ra.left-1,na):null};d.prototype.Qhi=function(ra,na){ra=this.vbc(ra);if(void 0===ra||null===ra)return null;ra=this.pF.createFormat(ra.FormatString,ra.Builtin);if(!excelOnlineCalc.util.isSuccess(ra))return null;na=this.pF.parseEdit(na,ra.value);return excelOnlineCalc.util.isSuccess(na)?na.value.kind===ia.a.formula:null};d.prototype.tbc=function(ra){if(null==this.pF)return Object(da.a)("Number formatter is null");
if(null==this.instantaneousSupportInformationManager)return Object(da.a)("Instantaneous manager is null");if(this.Pxd.has(ra))return Object(da.d)(this.Pxd.get(ra));if("number"===typeof ra){var na=this.vbc(ra);if(null==na)return Object(da.a)("Invalid ifmt="+ra);var ba=na.FormatString;na=na.Builtin}else ba=ra,na=!1;ba=this.pF.createFormat(ba,na);return excelOnlineCalc.util.isSuccess(ba)?(this.Pxd.set(ra,ba.value),Object(da.d)(ba.value)):Object(da.a)("Could not create number format")};d.prototype.getWorksheetFuncId=
function(ra){return this.localeInfo.getWorksheetFuncId(ra)};d.prototype.n8g=function(ra,na,ba,sa,ya){for(var va={Items:[]},W=0;W<ra.length;W++){var La=ra[W],Ia={};Ia.Start=La.span.start;Ia.End=La.span.end;if(ya||La.kind!==fa.a.func)if(ya||La.kind!==fa.a.qsi){if(this.mhh(La,na,ba)){var mb=new m,fb=this.SUh(La,na,mb,sa);if(ca.EwaSettings.ma(596)){var Ma=this.YQh(La),Hb=this.XQh(La);if(fb||Hb&&0<=Ma)Ia={Span:Ia,LetNumber:Ma,LetName:Hb,Range:fb},Ia.IsRangeRef=mb.Pwa,Ia.IsAbsoluteFirstRow=mb.PZ,Ia.IsAbsoluteFirstColumn=
mb.OZ,Ia.IsAbsoluteSecondRow=mb.H4,Ia.IsAbsoluteSecondColumn=mb.G4,Ia.IsStructRef=La.kind===fa.a.yTd,va.Items.push(Ia)}else fb&&(Ia={Span:Ia,Range:fb},Ia.IsRangeRef=mb.Pwa,Ia.IsAbsoluteFirstRow=mb.PZ,Ia.IsAbsoluteFirstColumn=mb.OZ,Ia.IsAbsoluteSecondRow=mb.H4,Ia.IsAbsoluteSecondColumn=mb.G4,Ia.IsStructRef=La.kind===fa.a.yTd,va.Items.push(Ia))}}else La=La.ref.value.oper.kind,va.Items.push({Span:Ia,IsString:2===La,IsBoolean:4===La,IsNumber:1===La});else Ia.End=La.span.start+La.ref.name.length,La={Span:Ia,
IsFunction:!0},La.FunctionId=this.getWorksheetFuncId(sa.substring(Ia.Start,Ia.End)),va.Items.push(La)}va.Items.sort(function(Kb,Ub){return Kb.Span.Start-Ub.Span.Start});return va};d.prototype.YQh=function(ra){return ra.kind===fa.a.Gjf?ra.ref.number:-1};d.prototype.XQh=function(ra){return ra.kind===fa.a.Gjf?ra.ref.name:null};d.prototype.SUh=function(ra,na,ba,sa){if(ra.kind===fa.a.range)return ba.Pwa=!0,this.oBe(ra,na,ba,sa);if(ra.kind===fa.a.namedRange){ba=ra.ref;(ra=this.$.vb.getItemByName(ba.name))||
(ra=this.$.vb.getItemByName(na+"!"+ba.name));if(!(ra&&ra.sheetName&&ra.usedRange&&U.a.equals(ra.sheetName,na,!0)))return null;na=2===ra.type?H.a(ra):ra.usedRange;return O.m(na,ra)}if(ra.kind===fa.a.yTd){var ya=ra.ref,va;ya.name?(va=this.$.vb.getItemByName(ya.name))||(va=this.$.vb.getItemByName(na+"!"+ya.name)):va=this.gridView.Ab.dk(this.gridView.ha.sa.activeCell);if(!(va&&va.sheetName&&va.usedRange&&U.a.equals(va.sheetName,na,!0)))return null;ba.Pwa=!1;return this.oBe(ra,na,ba,sa)}return null};d.prototype.oBe=
function(ra,na,ba,sa){ra=ra.ref;if(ra.type){if(ra.type===ha.a.column){var ya=ra.startIndex;ra=ra.endIndex;ba.OZ=ya.kind===wa.a.abs;ba.G4=ra.kind===wa.a.abs;return this.createRange(0,ya.index,C.a.vh,ra.index,na)}if(ra.type===ha.a.row)return ya=ra.endIndex,ba.PZ=ra.startIndex.kind===wa.a.abs,ba.H4=ya.kind===wa.a.abs,this.createRange(ra.startIndex.index,0,ra.endIndex.index,C.a.Eh,na);if(ra.type===ha.a.cell){ya=ra.row;var va=ra.col;ba.PZ=ba.H4=ya.kind===wa.a.abs;ba.OZ=ba.G4=va.kind===wa.a.abs;return this.G1b(ra.span.end,
sa)&&(ba=qa.Range.Tc(ya.index+1,va.index+1),ba=this.gridView.Ab.Q1e(ba))?O.n(ba,na):this.createRange(ya.index,va.index,ya.index,va.index,na)}if(ra.type===ha.a.range){ya=ra.top;va=ra.left;sa=ra.bottom;ra=ra.right;var W=Math.min(ya.index,sa.index),La=Math.min(va.index,ra.index),Ia=Math.max(ya.index,sa.index),mb=Math.max(va.index,ra.index);ba.PZ=ya.kind===wa.a.abs;ba.H4=sa.kind===wa.a.abs;ba.OZ=va.kind===wa.a.abs;ba.G4=ra.kind===wa.a.abs;return this.createRange(W,La,Ia,mb,na)}B.ULS.sendTraceTag(537170010,
0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",ra.type);return null}B.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};d.prototype.G1b=function(ra,na){return na.length>=ra&&0<ra&&na.charAt(ra-1)===l.VGf};d.prototype.iTg=function(ra,na,ba){this.yl&&this.yl.mTg(ra,na,ba)};d.prototype.vbc=function(ra){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.$xa&&
this.instantaneousSupportInformationManager.$xa[ra]&&this.pF?this.instantaneousSupportInformationManager.$xa[ra]:null};d.prototype.toXLNumber=function(ra){if(!this.pF)return null;ra=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.pF,ra);return excelOnlineCalc.util.isSuccess(ra)?ra.value:null};d.prototype.JSj=function(ra,na){if(ra){ra=ak(ra);for(var ba=ra.next();!ba.done;ba=ra.next())if(ba=ba.value,ba.ref.type&&ba.ref.type===ha.a.cell){var sa=ba.ref;d.XZi(sa,na)&&(sa.span.end+=1,ba.span.end+=
1)}}};d.prototype.createRange=function(ra,na,ba,sa,ya){var va={};va.FirstRow=ra;va.FirstColumn=na;va.LastRow=ba;va.LastColumn=sa;va.SheetName=ya;return va};d.prototype.mhh=function(ra,na,ba){var sa=ra.ref.qualifier;if(!sa)return!0;switch(ra.ref.qualifier.type){case k.sheet:return ra=sa.document,U.a.equals(sa.sheet,na,!0)&&(!ra||U.a.equals(ra.document,ba,!0));case k.sheetRange:return na=this.$.va.getItemByName(na),ba=this.$.va.getItemByName(sa.sheet1),sa=this.$.va.getItemByName(sa.sheet2),!!na&&!!ba&&
!!sa&&(ba.index<=na.index&&na.index<=sa.index||sa.index<=na.index&&na.index<=ba.index);case k.document:return U.a.equals(sa.document,ba,!0);case k.C7h:return sa=sa.name,U.a.equals(sa,na,!0)||U.a.equals(sa,ba,!0);default:return B.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",sa.type),!1}};d.prototype.hNj=function(ra){this.instantaneousSupportInformationManager=ra;ra.$xa.length&&ra.dja.length?(this.AFc=new F.CalcHelper(this.gridView.$),this.xFb=
this.Er.createParser(),this.nbe=this.Er.createNumberFormatter(),this.kmd=!0,B.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),this.yl||(B.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.yl=new f(this.$))):B.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",ra.$xa.length,
ra.dja.length.toString())};d.prototype.Dub=function(ra){if(!ra)return{returnValue:null,emptyCell:!1};var na=this.getSheetName(ra.sheet.index);if(!na)return B.ULS.sendTraceTag(537169998,0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",ra.sheet.index),{returnValue:null,emptyCell:!1};var ba=d.convertToRange(ra);na=this.gridView.Dub(na,ba.top,ba.left);return na?na.ghh?{returnValue:na,emptyCell:!1}:(B.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",
ra.range.row,ra.range.col),{returnValue:null,emptyCell:!0}):(B.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",ra.range.row,ra.range.col),{returnValue:null,emptyCell:!1})};d.prototype.getSheetName=function(ra){var na=this.gridView.$.va.getItem(ra);return na?na.sheetName:(B.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",ra),null)};d.prototype.p9g=function(ra,na){var ba={allowUnqualifiedCell:!0,wrapCellReferences:!0};
ba.config=this.Er.config;ba.originGridCell=excelOnlineCalc.util.success(ra);ba.originSheet=excelOnlineCalc.util.success(na);return ba};d.prototype.o9g=function(){var ra={};ra.config=this.Er.config;ra.getNameLoc=Object(x.a)(this.yl,this.yl.getNameLoc,"getNameLoc");ra.getContainingTable=Object(x.a)(this.yl,this.yl.getContainingTable,"getContainingTable");ra.getStructRefColumn=Object(x.a)(this.yl,this.yl.getStructRefColumn,"getStructRefColumn");ra.getStructRefSpecialRef=Object(x.a)(this.yl,this.yl.getStructRefSpecialRef,
"getStructRefSpecialRef");ra.getDocumentLoc=Object(x.a)(this.yl,this.yl.getDocumentLoc,"getDocumentLoc");ra.getSheetIndex=Object(x.a)(this.yl,this.yl.getSheetIndex,"getSheetIndex");ra.getSheetName=Object(x.a)(this.yl,this.yl.getSheetName,"getSheetName");ra.getUserDefinedFuncLoc=Object(x.a)(this.yl,this.yl.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");ra.getSheetRangeIndexes=Object(x.a)(this.yl,this.yl.getSheetRangeIndexes,"getSheetRangeIndexes");return ra};d.XZi=function(ra,na){return na.length>
ra.span.end&&na.charAt(ra.span.end)===l.VGf};d.convertToRange=function(ra){return qa.Range.Tc(ra.range.row+1,ra.range.col+1)};Af.Object.defineProperties(d.prototype,{Er:{configurable:!0,enumerable:!0,get:function(){return this.AFc}},gridView:{configurable:!0,enumerable:!0,get:function(){return this.Pq}},$:{configurable:!0,enumerable:!0,get:function(){return this.jb}},pF:{configurable:!0,enumerable:!0,get:function(){return this.nbe}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Er?
this.Er.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.Er.config}}});d.a7c="ECRC";Object(u.a)(d,"CalcManager",xa.a,[850,10]);var Na=b(37),Ka=b(53),la=y.a;Rk(c,la);c.prototype.create=function(){var ra=this;if(this.$){B.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(ca.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var na=75;var ba="Current"}else na=78,ba="Stable";B.ULS.sendTraceTag(537169992,
0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",ba);Na.TaskExtensions.Ba(Ka.a.loadScript(na,4,this.hb,void 0,void 0,265),function(){B.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");var sa=ra.$.da.za(266,!1);sa||(B.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),sa=new d(ra.$));ra.pb(sa)},this.la,3)}else B.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};
c.ka=function(ra){ra&&ra.da&&ra.da.Ga(265,new c(ra))};Object(u.a)(c,"CalcManagerFactory",y.a,[]);var Ea=b(11);b.d(D,"a",function(){return a})},1411:function(u,D,b){function a(){l.a.Fa(c.ka)}function c(N){var H=O.call(this)||this;H.$=N;H.Eb();return H}function d(N,H){var Q=J.call(this)||this;Q.YMa=r.a.Fe;Q.UYc=null;Q.Qic=!1;Q.tfb=!1;Q.Qsf=function(ca,X){var Z;(ca=F.g(Q.$))&&(X=null!==(Z=null===X||void 0===X?void 0:X.cell)&&void 0!==Z?Z:ca.Ub(null))&&Q.fTa(X.cell.Xk,!0)};Q.NKi=function(ca){Q.isActive()&&
(I.a.Xq(ca.Errors)||!ca.Result?m.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",ca.Errors?ca.Errors.join(","):"None"):(ca=ca.Result,m.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",ca.Index,ca.Category),Q.prj(ca.Index,ca.Category),Q.raiseEvent(d.WZc,new A.a(ca.Index,ca.Category),Q)))};Q.refresh=function(){m.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");
Q.s1b();Q.isActive()&&Q.ea.ic.allowEdits&&(Q.tfb||Q.en&&!(Q.ea.kjc>Q.YMa)?Q.NCc():(m.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information."),Q.jed=x.a(Q.$.oa.xa,Q.en?Q.en.Digest:"",Q.vLi,Q.uLi,null,null)),m.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info."),Q.JYe())};Q.Zwf=function(ca){m.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",
ca.data.status,ca.data.httpStatus);Q.SJa=null};Q.E_=function(){Q.tfb=!1;Q.ea.lD(Q.E_);Q.HQa(Q.Qic?d.UPd:d.mxd)};Q.Uc=function(ca,X){m.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");B.a(X)&&Q.HQa(d.UPd)};Q.Sf=function(){m.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==Q.$.workbookContext.CalcMode&&Q.yxd(0===Q.$.workbookContext.CalcMode)};Q.Yc=function(){m.ULS.sendTraceTag(537155713,
0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");Q.HQa(d.UPd);U.EwaSettings.ma(302)&&3!==Q.$.workbookContext.CalcMode&&Q.yxd(0===Q.$.workbookContext.CalcMode)};Q.nLi=function(ca,X,Z){m.ULS.sendTraceTag(537155712,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");Q.SJa=null;Q.isActive()?ca.StateId===r.a.Fe?(m.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),Q.NCc()):
!ca.Result||Q.JX&&Q.JX.length?Q.HQa(d.mxd):Q.GAf(ca,X,Z):m.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};Q.GAf=function(ca){Q.JX=ca.Result;m.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",Q.JX?Q.JX.length:-1);ca=!1;if(Q.JX){for(var X=ak(Q.JX),Z=X.next();!Z.done;Z=X.next())if(Z=Z.value)Q.CUe[Z.NameUI.toLocaleUpperCase()]=
Z.FunctionIndex.toString(),Z.NameUI!==Z.NameDataStrings&&(Q.CUe[Z.NameDataStrings.toLocaleUpperCase()]=Z.FunctionIndex.toString(),ca=!0),Q.lEh.ia(Z.FunctionIndex,Z.NameUI);Q.raiseEvent(d.sbd,Sys.EventArgs.Empty,Q)}ca&&m.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};Q.vLi=function(ca){if(Q.isActive())if(m.ULS.shipAssertTag(537155679,0,!!Q.$,"null ewaControl"),Q.Qic=!1,Q.YMa=ca.StateId,Q.YMa===r.a.Fe)Q.Qic=
!0,Q.NCc();else{if(ca.Result){var X=Q.en;Q.en=ca.Result;m.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",Q.en.Digest);ca=[];if(X)ca=d.MRh(X.NumberFormats,Q.en.NumberFormats);else for(X=0;X<Q.en.NumberFormats.length;X++)Q.Wlc.ia(X,Q.en.NumberFormats[X].NumberFormatCategory);X=ak(ca);for(var Z=X.next();!Z.done;Z=X.next())Z=Z.value,Q.Wlc.ia(Z,Q.en.NumberFormats[Z].NumberFormatCategory);Q.raiseEvent(d.Uxd,new k(ca),Q);U.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",
!1)&&Q.raiseEvent(d.Fkf)}Q.HQa(d.mxd)}};Q.uLi=function(ca){Q.isActive()&&(10===ca.data.status?m.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(m.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",ca.data.status,ca.data.httpStatus),Q.Qic=!0,Q.NCc()))};m.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");Q.ea=N;Q.$=H;Q.fHb=null;Q.jed=null;Q.SJa=null;Q.en=null;
Q.Wlc=new K.a;Q.Cub=new K.a;Q.JX=[];Q.lEh=new K.a;Q.CUe={};Q.ea.Wj(Q.Uc);Q.$.Tk(Q.Yc);F.g(Q.$).ha.Fga(Q.Qsf);U.EwaSettings.ma(302)&&Q.ea.Bu(Q.Sf);Q.HQa(d.N8e);m.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return Q}function e(N){this.data=N}function k(N){var H=C.call(this)||this;H.W_j=N;return H}var l=b(11);u=b(0);var m=b(15),f=b(232),w=b(90),n=b(4),z=b(202),r=b(8),v=b(38),A=b(1082),B=b(235),y=b(61),x=b(1081),C=Sys.EventArgs;Rk(k,C);Object(u.a)(k,"NumberFormatsUpdatedEventArgs",
Sys.EventArgs,[]);var G=b(47),E=b(44);b(34);var I=b(29),U=b(1),M=b(710);b(22);var T=b(295),F=b(21);b(206);Object(u.a)(e,"NumberFormatDataHolder",null,[]);var K=b(171),J=v.a;Rk(d,J);d.prototype.Zme=function(N){this.addHandler(d.Uxd,N)};d.prototype.FId=function(N){this.removeHandler(d.Uxd,N)};d.prototype.SDg=function(N){this.addHandler(d.WZc,N)};d.prototype.naj=function(N){this.removeHandler(d.WZc,N)};d.prototype.Eme=function(N){this.addHandler(d.sbd,N)};d.prototype.wId=function(N){this.removeHandler(d.sbd,
N)};d.prototype.uFg=function(N){this.addHandler(d.Fkf,N)};d.prototype.fTa=function(N,H){var Q=this.Wlc.zc(N,0);var ca=Q.value;Q=Q.returnValue;!Q&&0<N&&this.$&&(m.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",N),this.NJh(N),H&&(ca=this.MJh(N),Q=!0),M.a(N,this.$.eG)&&(ca=6));return{returnValue:Q,category:ca}};d.prototype.Mhi=function(N){var H=this.fTa(N,!0);var Q=H.category;if(H.returnValue)return 6===
Q;m.ULS.sendTraceTag(537155733,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",N);return!1};d.prototype.JCh=function(N){m.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.SJa=y.p(this.$.oa.xa,{FilterType:0},T.b(this.GAf,N),this.Zwf,null,null,null)};d.prototype.UTe=function(){this.HQa(d.N8e)};d.prototype.yxd=function(N){this.UYc=N};d.prototype.NJh=
function(N){if(this.Cub&&this.$){var H=this.Cub.zc(N);var Q=H.value;if(!H.returnValue||Q.isCompleted)m.ULS.sendTraceTag(537155728,0,50,"Getting number format category for format index: {0}",N),(Q=x.b(this.$.oa.xa,N,this.NKi,null,null,null))&&this.Cub.ia(N,Q)}else m.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};d.prototype.MJh=function(N){return 1<=N&&8>=N?1:9<=N&&12>=N?2:13===N||14===N?6:15===N?8:17===N|
18===N?7:19===N?4:16===N||20<=N&&29>=N||31===N?11:30===N?9:32<=N&&35>=N?3:0};d.prototype.isActive=function(){var N=void 0===this.ea||null===this.ea,H=!N&&this.ea.dc;m.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",H,N);return H};d.prototype.prj=function(N,H){this.Wlc.ia(N,H)};d.prototype.dispose=function(){w.a.Ia(this.fHb);this.fHb=null;this.s1b();for(var N=ak(this.Cub),
H=N.next();!H.done;H=N.next())(H=H.value.value)&&!H.isCompleted&&n.AFrameworkApplication.qd.nu(H.Ht);this.Cub=null;this.ea&&(this.ea.xk(this.Uc),this.tfb&&this.ea.lD(this.E_),this.tfb=!1,this.ea.Gw(this.Sf));this.ea=null;this.$&&F.g(this.$)&&F.g(this.$).ha&&(F.g(this.$).ha.Gma(this.Qsf),this.$.ol(this.Yc));this.$=null;J.prototype.dispose.call(this)};d.prototype.isFeatureEnabled=function(N){try{switch(N){case "LocaleLongDateFormat":return U.EwaSettings.ma(197);case "GetLocaleDayNames":return U.EwaSettings.ma(198);
case "CalculateTextWidthIgnoreLetterSpacing":return U.EwaSettings.ma(284);case "OfficeVSO:3657744_CalcFixForDateFormat":return U.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return U.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");case "CalcAutocompleteExperiment":return U.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",
!1);case "CalcNewFunctions":return U.EwaSettings.ma(247);case "CalcContractChecks":return U.EwaSettings.ma(248);case "CalcSupportDynamicArrays":return U.EwaSettings.ma(249);case "CalcFormatCalculations":return U.EwaSettings.ma(250);case "CalcFormulaCacheAPIChanges":return U.EwaSettings.ma(251);case "CalcStrictFormulaChecking":return U.EwaSettings.ma(252);case "CalcSupportRowReference":return U.EwaSettings.ma(263);case "CalcParserUsesPledges":return U.EwaSettings.ma(307);case "CalcWebWorker":return!0;
case "CalcWebWorkerTest":return U.EwaSettings.ma(306);case "CalcLookupFunctions":return U.EwaSettings.ma(308);case "CalcLogStopWatch":return U.EwaSettings.ma(371);case "CalcPreventSpillingHack":return U.EwaSettings.ma(253);case "CalcDynamicArrayOperators":return U.EwaSettings.ma(103);case "CalcDotOperator":return U.EwaSettings.ma(585);case "CalcLetFunction":return U.EwaSettings.ma(704);default:return N.startsWith("OfficeVSO:")?U.EwaSettings.isChangeGateEnabled(N):!1}}catch(H){return m.ULS.sendTraceTag(537155724,
0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",N,H.toString()),!1}};d.prototype.HQa=function(N){this.isActive()&&this.ea.ic.allowEdits?(w.a.Ia(this.fHb),this.fHb=null,this.fHb=G.a.instance.create(this.refresh,N,E.a.fci)):m.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",void 0!==this.ea&&null!==this.ea&&void 0!==this.ea.ic&&
null!==this.ea.ic?this.ea.ic.allowEdits:!1,void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode)};d.prototype.JYe=function(){m.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.SJa?m.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.JX&&this.JX.length||(this.SJa=y.p(this.$.oa.xa,{FilterType:0},this.nLi,this.Zwf,null,null,null)):m.ULS.sendTraceTag(537155717,
0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};d.prototype.NCc=function(){this.tfb||(this.tfb=!0,this.ea.YD(this.E_))};d.prototype.s1b=function(){this.nu(this.jed);this.nu(this.SJa);this.SJa=this.jed=null};d.prototype.nu=function(N){N&&!N.isCompleted&&this.$.oa.xa.yeb(N.Ht)};d.MRh=function(N,H){if(!N||!N.length)return[];if(!H||!H.length){H=Array(N.length);for(var Q=0;Q<N.length;++Q)H[Q]=N[Q].IfmtIndex;return H}var ca=new K.a;N=ak(N);for(Q=
N.next();!Q.done;Q=N.next())Q=Q.value,ca.ia(Q.IfmtIndex,new e(Q));N=new z.a;Q={};H=ak(H);for(var X=H.next();!X.done;Q={Lfb:Q.Lfb,wPb:Q.wPb},X=H.next())Q.Lfb=X.value,Q.wPb=void 0,function(Z){return function(){var ea=ca.zc(Z.Lfb.IfmtIndex);Z.wPb=ea.value;return ea}}(Q)().returnValue&&Q.wPb.data.FormatString===Q.Lfb.FormatString||N.add(Q.Lfb.IfmtIndex);return N.toArray()};Af.Object.defineProperties(d.prototype,{xe:{configurable:!0,enumerable:!0,get:function(){return this.en?this.en.LocaleInformation:
null}},$xa:{configurable:!0,enumerable:!0,get:function(){return this.en?this.en.NumberFormats:[]}},dja:{configurable:!0,enumerable:!0,get:function(){this.JX&&this.JX.length||this.JYe();return this.JX}},bci:{configurable:!0,enumerable:!0,get:function(){return this.en&&void 0!==this.en.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.en.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.en.InstantaneousCalcWebWorkerPrecisionSamplingRate:d.kch}},eci:{configurable:!0,enumerable:!0,get:function(){return this.en&&
void 0!==this.en.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.en.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.en.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:d.och}},dci:{configurable:!0,enumerable:!0,get:function(){return this.en&&void 0!==this.en.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.en.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.en.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:d.nch}},cci:{configurable:!0,
enumerable:!0,get:function(){return this.en&&void 0!==this.en.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.en.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.en.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:d.mch}},C$e:{configurable:!0,enumerable:!0,get:function(){return this.en?this.en.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:d.lch}},pld:{configurable:!0,enumerable:!0,get:function(){return null!==this.UYc?this.UYc:this.en?this.en.InstantaneousCalcManualMode:
!1}}});d.Uxd="isim0";d.WZc="isim1";d.sbd="isim2";d.Fkf="isim3";d.N8e=100;d.UPd=1E3;d.mxd=3E5;d.kch=.001;d.och=.1;d.nch=.2;d.mch=.001;d.lch=50;Object(u.a)(d,"InstantaneousSupportInformationManager",v.a,[827,10]);var O=f.a;Rk(c,O);c.prototype.create=function(){this.$&&(m.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),this.pb(this.$.da.za(268)||new d(this.$.ea,this.$)))};c.ka=function(N){if(!N)throw Error.argumentNull("ewaControl");N.da.Ga(246,
new c(N))};Object(u.a)(c,"InstantaneousSupportInformationManagerFactory",f.a,[]);b.d(D,"a",function(){return a})},1426:function(u,D,b){function a(){O.a.Fa(c.ka)}function c(N){var H=J.call(this)||this;H.$=N;H.Eb();return H}function d(N,H){var Q=this;this.Xja=this.XTd=this.pmf=!1;this.E8=null;this.HDb=function(){Q.Xja=!1};this.Ec=N;this.gridView=E.g(N);this.calcManager=H;this.lji=x.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.xaf=x.EwaSettings.ma(693);this.pba=
M.a.pba(N);this.jka=x.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug");this.gridView.Wb.vm(this.HDb)}function e(N,H,Q,ca){this.oIj=N;this.r8f=H;this.nhc=void 0===ca?!1:ca;Q?(this.Pwa=Q.Pwa,this.PZ=Q.PZ,this.OZ=Q.OZ,this.H4=Q.H4,this.G4=Q.G4):n.ULS.shipAssertTag(524039642,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}function k(N){this.G4=this.H4=this.OZ=this.PZ=!1;this.Pwa=N}function l(N){if(N){var H=new k(N.IsRangeRef);H.PZ=N.IsAbsoluteFirstRow;H.OZ=N.IsAbsoluteFirstColumn;
H.H4=N.IsAbsoluteSecondRow;H.G4=N.IsAbsoluteSecondColumn;return H}}function m(N){var H;if(N){var Q=new k(0===N.kind);N=null===(H=null===N||void 0===N?void 0:N.rangeInfo)||void 0===H?void 0:H.positionKindInfo;if(!N)return Q;Q.PZ=0===N.firstRow;Q.OZ=0===N.firstColumn;Q.H4=0===N.secondRow;Q.G4=0===N.secondColumn;return Q}}u=b(0);var f=b(232),w=b(7),n=b(15),z=b(85),r=b(5),v=b(338);Object(u.a)(k,"MarqueeRangeData",null,[]);Object(u.a)(e,"MarqueeMetadata",null,[]);var A=b(45),B=b(144),y=b(34),x=b(1),C=
b(22),G=b(698),E=b(21),I=b(206),U=b(355),M=b(36),T=b(978),F=b(1188),K="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");d.prototype.vI=function(N,H){this.lji&&N.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.XTd||N.AH)return!1;var Q=void 0===H||null===H?N.text:H;if(this.calcManager&&1<Q.length&&I.f(Q)){var ca=this.zvb(),X=this.T_e(),
Z=this.Ec.workbookContext.WorkbookFileName,ea=!1,ka=.01>Math.random()?Object(z.a)(B.a,this.Ec.Fb.sc("LoadingUIShown","ColoredReferencesManager")):null;try{var Y=this.calcManager.extractReferences(Q,X,Z,!this.xaf);if(!Y)return n.ULS.sendTraceTag(524039689,0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;X=[];Z=[];for(var qa=[],fa=[],ha=0,ia=0,wa=new y.a(!1),Qa="",S=ak(Y.Items),da=S.next();!da.done;da=S.next()){var xa=da.value;ea=xa.IsStructRef||
ea;if(xa.IsBoolean||xa.IsNumber||xa.IsString){var ta=xa.IsBoolean?"rgba(0, 0, 255, 1)":xa.IsNumber?"rgba(9, 134, 88, 1)":"rgba(163, 21, 21, 1)";this.kY(Z,Q,ha,xa.Span.Start,null);this.kY(Z,Q,xa.Span.Start,xa.Span.End,ta);ha=xa.Span.End}else if(x.EwaSettings.ma(596)){if(xa.Range||xa.LetName&&0<=xa.LetNumber){Y=null;if(xa.Range){var ab=A.D(xa.Range);Y=this.GJa(ab,wa,1);X.push(new U.a(ab,ca))}else xa.LetName&&0<=xa.LetNumber&&(Y=Qa=this.yKh(xa.LetName,xa.LetNumber,wa,Qa),ia!==wa.count&&N.colors.add(xa.Span.Start+
"-"+xa.Span.End,K[(wa.count-1)%K.length]));this.kY(Z,Q,ha,xa.Span.Start,null);this.kY(Z,Q,xa.Span.Start,xa.Span.End,Y);ha=xa.Span.End;qa.push(xa.Span);var Na=Z.length-1;fa.push(new e(Na,Z[Na].text,l(xa)));ia=wa.count}}else if(xa.Range){var Ka=A.D(xa.Range),la=this.GJa(Ka,wa,1);this.kY(Z,Q,ha,xa.Span.Start,null);this.kY(Z,Q,xa.Span.Start,xa.Span.End,la);X.push(new U.a(Ka,ca));ha=xa.Span.End;qa.push(xa.Span);var Ea=Z.length-1;fa.push(new e(Ea,Z[Ea].text,l(xa)))}}this.kY(Z,Q,ha,Q.length,null);this.u_f(N,
Z,!!H);var ra=N.textBox.text;if(!C.a.equals(ra,Q,!1)){n.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",ra.length,Q.length);var na=N.textBox.caretPosition;N.textBox.text=Q;N.textBox.caretPosition=na;return!0}this.MM(X,wa,fa);x.EwaSettings.ma(596)&&0<X.length&&n.ULS.sendTraceTag(524039688,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");
x.EwaSettings.ma(596)&&0<N.colors.count&&n.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.Xja=!0}finally{ka&&ka.NAa(function(){ea&&n.ULS.sendTraceTag(524039686,0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",ka.qc)})}}else return this.MM(null,null),this.Xja&&(this.Xja=!1,ca=N.textBox.caretPosition,N.textBox.setPlainText(Q),N.textBox.caretPosition=Math.min(ca,Q.length),
H)?!0:!1};d.prototype.SWd=function(N,H,Q){if(this.XTd||N.AH)return!1;var ca=isNullOrUndefined(H)?N.text:H,X=[],Z=new y.a(!1);if(1<ca.length&&Object(T.b)(Q)){var ea=[],ka=[],Y=[],qa=0,fa=this.zvb();Q=ak(Q.formulaHighlights);for(var ha=Q.next();!ha.done;ha=Q.next()){ha=ha.value;this.kY(ea,ca,qa,ha.span.start,null);switch(ha.kind){case 0:case 1:case 2:qa=A.B(ha.rangeInfo.sharedRange);if(isNullOrUndefined(qa)){n.ULS.sendTraceTag(521211937,0,10,"ColoredReferencesManager.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:{0},",
ha.kind.toString());this.kY(ea,ca,ha.span.start,ha.span.end,null);break}var ia=this.GJa(qa,Z,1);this.kY(ea,ca,ha.span.start,ha.span.end,ia);X.push(new U.a(qa,fa));ka.push({Start:ha.span.start,End:ha.span.end});qa=ea.length-1;Y.push(new e(qa,ea[qa].text,m(ha)));break;case 3:this.kY(ea,ca,ha.span.start,ha.span.end,null,"rgba(229, 229, 229, 1)")}qa=ha.span.end}this.kY(ea,ca,qa,ca.length);this.u_f(N,ea,!!H);H=N.textBox.text;if(!C.a.equals(H,ca,!1))return n.ULS.shipAssertTag(521211936,0,!1,"ColoredReferencesManager.UpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",
H.length,ca.length),H=N.textBox.caretPosition,N.textBox.text=ca,N.textBox.caretPosition=H,!0;this.MM(X,Z,Y);return this.Xja=!0}this.MM(null,null);return this.Xja&&(this.Xja=!1,X=N.textBox.caretPosition,N.textBox.setPlainText(ca),N.textBox.caretPosition=Math.min(X,ca.length),H)?!0:!1};d.prototype.bqf=function(N,H,Q){if(!N||!H||!Q)return n.ULS.shipAssertTag(524039685,0,!!N,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),n.ULS.shipAssertTag(524039684,0,!!H,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),
n.ULS.shipAssertTag(524039683,0,!!Q,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var ca=Object(z.a)(e,H.metadata);if(!ca)return n.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var X=ca.oIj,Z=ca.r8f,ea=this.gridView.Ab.Ubf(Q)?Q.Dac(ca.OZ,ca.PZ):Q.Y3a(ca.OZ,ca.PZ,ca.G4,ca.H4);if(!ea)return n.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;var ka=Z.indexOf("!");-1!==ka&&
(ea=Z.substring(0,ka+1)+ea);if(!N.textBox.changeTextInExistingTextPart(X,Z,ea))return n.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;ca.r8f=ea;X=!0;for(Z=1;4>=Z;Z++)(ea=E.g(this.Ec).qb.fw(3,Z,H.v$))?(ea.range=Q,ea.metadata=ca):(n.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),X=!1);this.gridView.qb.update(!1,!1);this.gridView.sj&&(this.gridView.$b.textBox.text=N.text);this.gridView.$b.DGb(new v.a({Ayb:!0}));
return X};d.prototype.pji=function(N){if(3!==N.jr)return n.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;N=Object(z.a)(e,N.metadata);return N?N.Pwa&&!N.nhc:(n.ULS.shipAssertTag(524039650,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};d.prototype.Mdb=function(N,H){n.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(H?"suspending":"resuming")+
" colored references");H&&this.Xja&&(this.Xja=!1,this.MM(null,null),N.textBox.WXg());this.XTd=H};d.prototype.dispose=function(){this.gridView&&this.gridView.Wb&&this.gridView.Wb.Nl(this.HDb)};d.prototype.fjd=function(N){var H=this.formulaAssistanceTelemetryManager;H||this.pmf||(this.pmf=!0,n.ULS.sendTraceTag(521211935,0,50,"ColoredReferencesManager.highlightPreviewRanges: Failed to log highlightPreviewRanges measurement, FormulaAssistanceTelemetryManager unavailable"));null===H||void 0===H?void 0:
H.oO(["highlightPreviewRanges"]);this.pba?this.x6h(N):this.w6h(N);null===H||void 0===H?void 0:H.jQ(["highlightPreviewRanges"],!0)};d.prototype.x6h=function(N){var H=this.formulaAssistanceManager.Idd(N,F.a);if(isNullOrUndefined(H))this.jka&&this.MM(null,null);else{var Q=this.zvb(),ca=[],X=new y.a(!1),Z=[];H=ak(H.formulaHighlights);for(var ea=H.next();!ea.done;ea=H.next()){ea=ea.value;var ka=ea.kind;if(0===ka||2===ka||1===ka)ka=A.B(ea.rangeInfo.sharedRange),Object(T.b)(ka)&&(ca.push(new U.a(ka,Q)),
this.GJa(ka,X,1),Z.push(new e(ea.span.start,N.substring(ea.span.start,ea.span.end),m(ea),!0)))}this.MM(ca,X,Z)}};d.prototype.w6h=function(N){var H=this.zvb(),Q=this.T_e(),ca=this.Ec.workbookContext.WorkbookFileName,X=[],Z=new y.a(!1),ea=[];if(Q=this.calcManager.extractReferences(N,Q,ca,!this.xaf)){Q=ak(Q.Items);for(ca=Q.next();!ca.done;ca=Q.next())if(ca=ca.value,ca.Range){var ka=A.D(ca.Range);X.push(new U.a(ka,H));this.GJa(ka,Z,1);ea.push(new e(ca.Span.Start,N.substring(ca.Span.Start,ca.Span.End),
l(ca),!0))}this.MM(X,Z,ea)}else this.jka&&this.MM(null,null)};d.prototype.GJa=function(N,H,Q){var ca=H.getItem(N.toString());ca||(ca=K[H.count%K.length],H.add(N.toString(),ca));return String.format(ca,Q)};d.prototype.yKh=function(N,H,Q,ca){N="["+N+", "+H+"]";H=Q.getItem(N);H||(H=Q.count%K.length,H=K[H],ca===String.format(H,1)&&(Q.add("skip-"+N,H),H=Q.count%K.length,H=K[H]),Q.add(N,H));return String.format(H,1)};d.prototype.kY=function(N,H,Q,ca,X,Z){X=void 0===X?null:X;Z=void 0===Z?null:Z;n.ULS.shipAssertTag(524039648,
0,Q<=ca,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");Q<ca&&(H=H.substring(Q,ca),N.push(Object(w.a)(new G.a,{text:H,color:X,backgroundColor:Z})))};d.prototype.MM=function(N,H,Q){var ca=this;Q=void 0===Q?null:Q;N&&N.length?(n.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+N.length),N.reverse(),Q.reverse(),this.gridView.qb.Lw(N,[3],!0,function(X,Z){if(X&&X.range&&Z){n.ULS.shipAssertTag(524039643,0,H.kb(X.range.toString()),
"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",X.range.toString());var ea=ca.GJa(X.range,H,.1),ka=ca.GJa(X.range,H,1);ca.Ec.frame&&ca.Ec.frame.rH&&ca.Ec.frame.rH.tka||(Z.style.background=ea);Z.style.borderColor=ka;Q&&(Z.setAttribute(r.a.Axb,X.v$.toString()),X.metadata=Q[X.v$])}else n.ULS.shipAssertTag(524039646,0,!!X,"ColoredReferencesManager.HighlightRanges: state is null"),n.ULS.shipAssertTag(524039645,0,!!X.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),
n.ULS.shipAssertTag(524039644,0,!!Z,"ColoredReferencesManager.HighlightRanges: div is null")})):(N=this.Ec.Fb.sc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.qb.eh([3]),this.gridView.qb.scb(new U.a(null,this.zvb()),[3]),N.stop())};d.prototype.u_f=function(N,H,Q){var ca=N.textBox;ca.WJ=!0;var X=ca.selection,Z=X.index;X=Z+X.length;ca.setTextFromTextParts(H);H=ca.text.length;ca.selectRange(Math.min(Z,H),Math.min(X,H));Q&&N.DGb(new v.a);ca.WJ=!1};d.prototype.zvb=function(){return this.S_e().sheetId};
d.prototype.T_e=function(){return this.S_e().sheetName};d.prototype.S_e=function(){return this.gridView.it&&this.gridView.it.vK?this.gridView.it.vK:this.Ec.pa};Af.Object.defineProperties(d.prototype,{formulaAssistanceManager:{configurable:!0,enumerable:!0,get:function(){this.E8||(this.E8=this.Ec.da.za(464));return this.E8}},formulaAssistanceTelemetryManager:{configurable:!0,enumerable:!0,get:function(){this.nDa||(this.nDa=this.Ec.da.za(491));return this.nDa}}});Object(u.a)(d,"ColoredReferencesManager",
null,[516,10]);var J=f.a;Rk(c,J);c.prototype.create=function(){var N=this;this.$.da.Za(266,function(H){H=x.EwaSettings.xl()?N.$.da.za(281)||N.$.da.Ga(281,new d(N.$,H)):new d(N.$,H);N.pb(H)})};c.ka=function(N){N.da.Ga(282,new c(N))};Object(u.a)(c,"ColoredReferencesManagerFactory",f.a,[]);var O=b(11);b.d(D,"a",function(){return a})},1475:function(u,D,b){function a(){m.a.Fa(c.ka)}function c(f){var w=l.call(this)||this;w.$=f;w.Eb();return w}u=b(0);var d=b(232),e=b(1016),k=b(1),l=d.a;Rk(c,l);c.prototype.create=
function(){var f=this;this.$.da.Za(266,function(w){w=k.EwaSettings.xl()?f.$.da.za(294)||f.$.da.Ga(294,new e.RelativeAndAbsoluteReferencesManager(w)):new e.RelativeAndAbsoluteReferencesManager(w);f.pb(w)})};c.ka=function(f){f.da.Ga(295,new c(f))};Object(u.a)(c,"RelativeAndAbsoluteReferencesManagerFactory",d.a,[]);var m=b(11);b.d(D,"a",function(){return a})},1597:function(u,D,b){b.r(D);u=b(1411);D=b(1367);var a=b(1426);b=b(1475);Type.registerNamespace("_Ewa");Object(u.a)();Object(D.a)();Object(a.a)();
Object(b.a)()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.calc.js.map/0586fe2a05bb85325d56431c40ba77e1/EwaDS.calc.js.map